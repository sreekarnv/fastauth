{"config":{"lang":["en"],"separator":"[\\s\\-,:!=\\[\\]()\"/]+|(?!\\b)(?=[A-Z][a-z])|\\.(?!\\d)|&[lg]t;","pipeline":["stopWordFilter"],"fields":{"title":{"boost":1000.0},"text":{"boost":1.0},"tags":{"boost":1000000.0}}},"docs":[{"location":"","title":"FastAuth","text":"<p>Production-ready authentication for FastAPI applications</p> <p>FastAuth is a flexible, database-agnostic authentication library for FastAPI that provides secure user authentication, session management, and authorization out of the box.</p> <p> </p>"},{"location":"#features","title":"\u2728 Features","text":"<ul> <li>Complete Authentication - Registration, login, logout, token refresh</li> <li>Role-Based Access Control - Fine-grained permissions and roles</li> <li>Session Management - Multi-device session tracking</li> <li>OAuth Support - Social login (Google, GitHub, etc.)</li> <li>Email Verification - Secure email verification with tokens</li> <li>Password Reset - Self-service password reset</li> <li>Database Agnostic - Works with any database via adapters</li> <li>Type Safe - Full type hints and validation</li> </ul>"},{"location":"#quick-start","title":"Quick Start","text":""},{"location":"#install","title":"Install","text":"<pre><code>pip install sreekarnv-fastauth\n</code></pre>"},{"location":"#create-your-app","title":"Create Your App","text":"<pre><code>from fastapi import Depends, FastAPI\nfrom fastapi.security import HTTPAuthorizationCredentials, HTTPBearer\n\nfrom fastauth.api.auth import router as auth_router\nfrom fastauth.security.jwt import decode_access_token\n\napp = FastAPI()\napp.include_router(auth_router)\n\nsecurity = HTTPBearer()\n\n@app.get(\"/protected\")\ndef protected(credentials: HTTPAuthorizationCredentials = Depends(security)):\n    payload = decode_access_token(credentials.credentials)\n    return {\"user_id\": payload[\"sub\"]}\n</code></pre>"},{"location":"#run","title":"Run","text":"<pre><code>uvicorn main:app --reload\n</code></pre> <p>Visit <code>http://localhost:8000/docs</code> to see the auto-generated API documentation.</p>"},{"location":"#documentation","title":"Documentation","text":"<ul> <li>Getting Started - Install and setup in 5 minutes</li> <li>Guides - Authentication, RBAC, sessions, OAuth</li> <li>API Reference - Complete API documentation</li> <li>Examples - Working example applications</li> </ul>"},{"location":"#examples","title":"Examples","text":"<p>Check out complete working examples:</p> <ul> <li>OAuth with Google - Social login with PKCE</li> <li>RBAC Blog - Role-based access control</li> <li>Session Management - Multi-device tracking</li> <li>Basic App - Simple authentication</li> </ul>"},{"location":"#security","title":"Security","text":"<p>FastAuth follows security best practices:</p> <ul> <li>Argon2 password hashing (OWASP recommended)</li> <li>JWT tokens with configurable expiration</li> <li>Rate limiting for authentication endpoints</li> <li>Refresh token rotation</li> <li>Session tracking and revocation</li> </ul>"},{"location":"#architecture","title":"Architecture","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502         Your FastAPI App            \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502         FastAuth API Layer          \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502      Core Business Logic            \u2502  \u2190 Database-agnostic\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502      Adapter Interface              \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502   Database Implementation           \u2502  \u2190 SQLAlchemy, MongoDB, etc.\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre> <p>Key Principles: - Database-agnostic core - Adapter pattern for flexibility - Dependency injection - Full type safety</p>"},{"location":"#contributing","title":"Contributing","text":"<p>Contributions are welcome! See CONTRIBUTING.md for guidelines.</p> <pre><code># Setup development environment\ngit clone https://github.com/sreekarnv/fastauth.git\ncd fastauth\npoetry install\npoetry run pytest\n</code></pre>"},{"location":"#license","title":"License","text":"<p>MIT License - see LICENSE for details.</p>"},{"location":"#links","title":"Links","text":"<ul> <li>Changelog - Version history and release notes</li> <li>Code of Conduct - Community guidelines</li> <li>Contributing - How to contribute</li> </ul>"},{"location":"#acknowledgments","title":"Acknowledgments","text":"<p>Built with FastAPI, SQLModel, Argon2, and python-jose.</p> <p>Made with by Sreekar Nutulapati</p>"},{"location":"architecture/","title":"Architecture","text":"<p>FastAuth uses a clean, layered architecture that separates concerns and maintains database agnosticism.</p>"},{"location":"architecture/#design-principles","title":"Design Principles","text":""},{"location":"architecture/#1-database-agnostic-core","title":"1. Database Agnostic Core","text":"<p>The core business logic has no knowledge of the database layer. All database operations are abstracted through adapter interfaces.</p> <p>Benefits: - Swap databases without changing business logic - Easy to test with mock adapters - Clear separation of concerns</p>"},{"location":"architecture/#2-adapter-pattern","title":"2. Adapter Pattern","text":"<p>Database-specific code lives in adapters that implement abstract base classes.</p> <p>Flow: <pre><code>API Layer \u2192 Core Logic \u2192 Adapter Interface \u2192 Adapter Implementation \u2192 Database\n</code></pre></p>"},{"location":"architecture/#3-dependency-injection","title":"3. Dependency Injection","text":"<p>FastAPI's dependency injection system allows easy customization and testing.</p> <pre><code># Override dependencies\napp.dependency_overrides[get_session] = your_custom_session\n</code></pre>"},{"location":"architecture/#architecture-layers","title":"Architecture Layers","text":"<pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502         FastAPI Routes              \u2502  Your application\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502         FastAuth API Layer          \u2502  HTTP handlers\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502         Core Business Logic         \u2502  Database-agnostic\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502         Adapter Interface           \u2502  Abstract base classes\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502    Adapter Implementation           \u2502  SQLAlchemy, MongoDB, etc.\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"architecture/#layer-responsibilities","title":"Layer Responsibilities","text":"<p>FastAPI Routes (Your Application) - Include FastAuth router - Define custom routes - Override dependencies</p> <p>FastAuth API Layer - HTTP request/response handling - Input validation (Pydantic) - Error handling - Rate limiting</p> <p>Core Business Logic - Authentication logic - Authorization (RBAC) - Session management - Token management - Password hashing - Email verification - Password reset</p> <p>Adapter Interface - Abstract base classes - Define required methods - No implementation details</p> <p>Adapter Implementation - Database-specific code - CRUD operations - Query logic - No business logic</p>"},{"location":"architecture/#component-architecture","title":"Component Architecture","text":""},{"location":"architecture/#core-components","title":"Core Components","text":""},{"location":"architecture/#users-fastauthcoreuserspy","title":"Users (<code>fastauth/core/users.py</code>)","text":"<ul> <li>User creation</li> <li>Authentication</li> <li>Password verification</li> </ul>"},{"location":"architecture/#refresh-tokens-fastauthcorerefresh_tokenspy","title":"Refresh Tokens (<code>fastauth/core/refresh_tokens.py</code>)","text":"<ul> <li>Token generation</li> <li>Token validation</li> <li>Token rotation</li> </ul>"},{"location":"architecture/#password-reset-fastauthcorepassword_resetpy","title":"Password Reset (<code>fastauth/core/password_reset.py</code>)","text":"<ul> <li>Reset request</li> <li>Token validation</li> <li>Password update</li> </ul>"},{"location":"architecture/#email-verification-fastauthcoreemail_verificationpy","title":"Email Verification (<code>fastauth/core/email_verification.py</code>)","text":"<ul> <li>Verification request</li> <li>Token validation</li> <li>Email confirmation</li> </ul>"},{"location":"architecture/#roles-fastauthcorerolespy","title":"Roles (<code>fastauth/core/roles.py</code>)","text":"<ul> <li>Role creation and management</li> <li>Permission creation and assignment</li> <li>Role-to-user assignment</li> <li>Permission checking</li> <li>User authorization</li> </ul>"},{"location":"architecture/#sessions-fastauthcoresessionspy","title":"Sessions (<code>fastauth/core/sessions.py</code>)","text":"<ul> <li>Session creation and tracking</li> <li>Device fingerprinting</li> <li>Session activity tracking</li> <li>Session revocation</li> <li>Inactive session cleanup</li> </ul>"},{"location":"architecture/#oauth-fastauthcoreoauthpy","title":"OAuth (<code>fastauth/core/oauth.py</code>)","text":"<ul> <li>OAuth 2.0 provider integration</li> <li>Authorization flow initiation</li> <li>Code exchange and token validation</li> <li>User account creation and linking</li> <li>OAuth account management</li> <li>PKCE support for enhanced security</li> </ul>"},{"location":"architecture/#adapters","title":"Adapters","text":""},{"location":"architecture/#base-adapters-fastauthadaptersbase","title":"Base Adapters (<code>fastauth/adapters/base/</code>)","text":"<p>Abstract interfaces defining required methods.</p> <p>UserAdapter: <pre><code>class UserAdapter(ABC):\n    @abstractmethod\n    def get_by_email(self, email: str): ...\n\n    @abstractmethod\n    def create_user(self, *, email: str, hashed_password: str): ...\n</code></pre></p> <p>RoleAdapter: <pre><code>class RoleAdapter(ABC):\n    @abstractmethod\n    def create_role(self, *, name: str, description: str | None = None): ...\n\n    @abstractmethod\n    def assign_role_to_user(self, *, user_id: UUID, role_id: UUID): ...\n\n    @abstractmethod\n    def get_user_permissions(self, user_id: UUID): ...\n</code></pre></p> <p>SessionAdapter: <pre><code>class SessionAdapter(ABC):\n    @abstractmethod\n    def create_session(self, *, user_id: UUID, device: str | None = None,\n                      ip_address: str | None = None, user_agent: str | None = None): ...\n\n    @abstractmethod\n    def get_user_sessions(self, user_id: UUID): ...\n\n    @abstractmethod\n    def delete_session(self, session_id: UUID) -&gt; None: ...\n\n    @abstractmethod\n    def cleanup_inactive_sessions(self, inactive_days: int = 30) -&gt; None: ...\n</code></pre></p> <p>OAuthAccountAdapter: <pre><code>class OAuthAccountAdapter(ABC):\n    @abstractmethod\n    def create(self, *, user_id: UUID, provider: str, provider_user_id: str,\n              access_token: str, refresh_token: str | None = None, expires_at: datetime | None = None): ...\n\n    @abstractmethod\n    def get_by_provider_user_id(self, provider: str, provider_user_id: str): ...\n\n    @abstractmethod\n    def get_by_user_id(self, user_id: UUID): ...\n\n    @abstractmethod\n    def delete(self, account_id: UUID) -&gt; None: ...\n</code></pre></p> <p>OAuthStateAdapter: <pre><code>class OAuthStateAdapter(ABC):\n    @abstractmethod\n    def create(self, *, state_hash: str, provider: str, redirect_uri: str,\n              code_verifier: str | None = None, expires_at: datetime, state_data: dict | None = None): ...\n\n    @abstractmethod\n    def get_valid(self, state_hash: str): ...\n\n    @abstractmethod\n    def delete(self, state_hash: str) -&gt; None: ...\n</code></pre></p>"},{"location":"architecture/#sqlalchemy-implementation-fastauthadapterssqlalchemy","title":"SQLAlchemy Implementation (<code>fastauth/adapters/sqlalchemy/</code>)","text":"<p>Concrete implementation using SQLModel.</p> <pre><code>class SQLAlchemyUserAdapter(UserAdapter):\n    def __init__(self, session: Session):\n        self.session = session\n\n    def get_by_email(self, email: str):\n        return self.session.exec(\n            select(User).where(User.email == email)\n        ).first()\n</code></pre>"},{"location":"architecture/#api-layer","title":"API Layer","text":""},{"location":"architecture/#routes-fastauthapiauthpy","title":"Routes (<code>fastauth/api/auth.py</code>)","text":"<p>FastAPI router with authentication endpoints.</p> <pre><code>@router.post(\"/register\")\ndef register(payload: RegisterRequest, session: Session = Depends(get_session)):\n    users = SQLAlchemyUserAdapter(session)\n    return create_user(users=users, email=payload.email, password=payload.password)\n</code></pre>"},{"location":"architecture/#dependencies-fastauthapidependenciespy","title":"Dependencies (<code>fastauth/api/dependencies.py</code>)","text":"<p>Reusable dependencies for route protection.</p> <pre><code>def get_current_user(\n    credentials: HTTPAuthorizationCredentials = Depends(security),\n    session: Session = Depends(get_session)\n) -&gt; User:\n    # Validate token and return user\n</code></pre>"},{"location":"architecture/#security-components","title":"Security Components","text":""},{"location":"architecture/#jwt-fastauthsecurityjwtpy","title":"JWT (<code>fastauth/security/jwt.py</code>)","text":"<ul> <li>Token creation</li> <li>Token validation</li> <li>Expiration handling</li> </ul>"},{"location":"architecture/#password-hashing-fastauthcorehashingpy","title":"Password Hashing (<code>fastauth/core/hashing.py</code>)","text":"<ul> <li>Argon2 hashing</li> <li>Password verification</li> </ul>"},{"location":"architecture/#rate-limiting-fastauthsecurityrate_limitpy","title":"Rate Limiting (<code>fastauth/security/rate_limit.py</code>)","text":"<ul> <li>Attempt tracking</li> <li>Window-based limiting</li> <li>Automatic cleanup</li> </ul>"},{"location":"architecture/#email-components","title":"Email Components","text":""},{"location":"architecture/#email-factory-fastauthemailfactorypy","title":"Email Factory (<code>fastauth/email/factory.py</code>)","text":"<p>Selects appropriate email provider based on configuration.</p>"},{"location":"architecture/#providers","title":"Providers","text":"<ul> <li>Console (development)</li> <li>SMTP (production)</li> <li>SendGrid (planned)</li> <li>AWS SES (planned)</li> </ul>"},{"location":"architecture/#data-flow","title":"Data Flow","text":""},{"location":"architecture/#registration-flow","title":"Registration Flow","text":"<pre><code>1. User submits email/password\n   \u2193\n2. API validates input (Pydantic)\n   \u2193\n3. Core checks for existing user (via adapter)\n   \u2193\n4. Core hashes password\n   \u2193\n5. Core creates user (via adapter)\n   \u2193\n6. If email verification required:\n   - Generate token\n   - Send email\n   \u2193\n7. Return user object\n</code></pre>"},{"location":"architecture/#login-flow","title":"Login Flow","text":"<pre><code>1. User submits email/password\n   \u2193\n2. API validates input\n   \u2193\n3. Rate limiter checks attempts\n   \u2193\n4. Core retrieves user (via adapter)\n   \u2193\n5. Core verifies password\n   \u2193\n6. Core checks email verification\n   \u2193\n7. Create access token (JWT)\n   \u2193\n8. Create refresh token (via adapter)\n   \u2193\n9. Return tokens\n</code></pre>"},{"location":"architecture/#token-refresh-flow","title":"Token Refresh Flow","text":"<pre><code>1. User submits refresh token\n   \u2193\n2. Core validates token hash (via adapter)\n   \u2193\n3. Core checks expiration\n   \u2193\n4. Core revokes old token (via adapter)\n   \u2193\n5. Create new access token\n   \u2193\n6. Create new refresh token (via adapter)\n   \u2193\n7. Return new tokens\n</code></pre>"},{"location":"architecture/#authorization-flow-rbac","title":"Authorization Flow (RBAC)","text":"<pre><code>1. User requests protected resource\n   \u2193\n2. Validate access token (get user)\n   \u2193\n3. Check required role/permission (dependency)\n   \u2193\n4. Core retrieves user roles (via adapter)\n   \u2193\n5. Core retrieves role permissions (via adapter)\n   \u2193\n6. Core checks if user has required permission\n   \u2193\n7. If authorized \u2192 Execute route\n   If unauthorized \u2192 Return 403 Forbidden\n</code></pre>"},{"location":"architecture/#oauth-20-authentication-flow","title":"OAuth 2.0 Authentication Flow","text":"<pre><code>Authorization Initiation:\n1. User clicks \"Sign in with Google\"\n   \u2193\n2. Frontend: POST /oauth/google/authorize\n   \u2193\n3. Core generates state token (CSRF protection)\n   - Random token created\n   - Hashed and stored (via OAuthStateAdapter)\n   - Expires in 10 minutes\n   \u2193\n4. Core optionally generates PKCE challenge\n   - Code verifier (random string)\n   - Code challenge (SHA-256 hash of verifier)\n   \u2193\n5. Core builds authorization URL\n   - Includes client_id, redirect_uri, state\n   - Includes code_challenge if PKCE enabled\n   \u2193\n6. Return authorization URL to frontend\n   \u2193\n7. Frontend redirects user to authorization URL\n\nOAuth Callback:\n1. User authenticates with OAuth provider\n   \u2193\n2. User grants permissions\n   \u2193\n3. OAuth provider redirects to callback URL\n   - Includes authorization code\n   - Includes state token\n   \u2193\n4. Frontend: POST /oauth/google/callback\n   - Sends code and state\n   \u2193\n5. Core validates state token (via OAuthStateAdapter)\n   - Checks state exists and not expired\n   - Deletes state token (single-use)\n   \u2193\n6. Core exchanges code for access token\n   - Sends code + code_verifier (if PKCE)\n   - Receives access_token and refresh_token\n   \u2193\n7. Core fetches user info from OAuth provider\n   - Uses access_token\n   - Gets email, provider_user_id, name\n   \u2193\n8. Core creates or links user account\n   - If OAuth account exists \u2192 return existing user\n   - If email exists \u2192 link OAuth to existing user\n   - If new user \u2192 create user + OAuth account\n   \u2193\n9. Core encrypts and stores OAuth tokens (via OAuthAccountAdapter)\n   \u2193\n10. Create session and JWT tokens\n    \u2193\n11. Return JWT tokens to frontend\n</code></pre>"},{"location":"architecture/#session-management-flow","title":"Session Management Flow","text":"<pre><code>Login/Registration:\n1. User successfully authenticates\n   \u2193\n2. Extract device info from request\n   - IP address\n   - User agent\n   - Device identifier (optional)\n   \u2193\n3. Core creates session (via adapter)\n   \u2193\n4. Core updates user's last_login timestamp\n   \u2193\n5. Return tokens\n\nList Sessions:\n1. User requests /sessions\n   \u2193\n2. Validate access token (get user)\n   \u2193\n3. Core retrieves user sessions (via adapter)\n   \u2193\n4. Return session list with metadata\n\nRevoke Session:\n1. User requests DELETE /sessions/{session_id}\n   \u2193\n2. Validate access token (get user)\n   \u2193\n3. Core verifies session ownership\n   \u2193\n4. If owned \u2192 Delete session (via adapter)\n   If not owned \u2192 Return 404 Not Found\n   \u2193\n5. Return success\n\nCleanup Inactive Sessions:\n1. Scheduled job triggers (e.g., daily)\n   \u2193\n2. Core queries sessions (via adapter)\n   \u2193\n3. Core filters by last_active &lt; cutoff date\n   \u2193\n4. Core deletes inactive sessions (via adapter)\n</code></pre>"},{"location":"architecture/#security-architecture","title":"Security Architecture","text":""},{"location":"architecture/#password-security","title":"Password Security","text":"<p>Argon2 Hashing: - Industry-recommended algorithm - Memory-hard (resistant to GPU attacks) - Configurable cost parameters</p> <p>Flow: <pre><code>Plain Password \u2192 Argon2 Hash \u2192 Store in Database\n</code></pre></p>"},{"location":"architecture/#token-security","title":"Token Security","text":"<p>JWT Access Tokens: - Short-lived (30 minutes default) - Stateless - Signed with secret key</p> <p>Refresh Tokens: - Long-lived (7 days default) - Stored in database (can be revoked) - Hashed before storage - Rotated on use</p>"},{"location":"architecture/#rate-limiting","title":"Rate Limiting","text":"<p>Protection Against: - Brute force attacks - Credential stuffing - DoS attacks</p> <p>Implementation: <pre><code>limiter = RateLimiter(max_attempts=5, window_seconds=300)\nlimiter.hit(request.client.host)\n</code></pre></p>"},{"location":"architecture/#authorization-rbac","title":"Authorization (RBAC)","text":"<p>Role-Based Access Control: - Fine-grained authorization - Separation of authentication and authorization - Flexible permission model</p> <p>Architecture: <pre><code>User \u2192 [UserRole] \u2192 Role \u2192 [RolePermission] \u2192 Permission\n</code></pre></p> <p>Many-to-Many Relationships: - Users can have multiple roles - Roles can have multiple permissions - Users inherit all permissions from their roles</p> <p>Route Protection: <pre><code># Protect by role\n@app.get(\"/admin\", dependencies=[Depends(require_role(\"admin\"))])\n\n# Protect by permission\n@app.delete(\"/users/{id}\", dependencies=[Depends(require_permission(\"delete:users\"))])\n</code></pre></p> <p>Permission Check: <pre><code># Check permission programmatically\nhas_access = check_permission(\n    roles=role_adapter,\n    user_id=user.id,\n    permission_name=\"delete:users\"\n)\n</code></pre></p>"},{"location":"architecture/#sql-injection-protection","title":"SQL Injection Protection","text":"<p>All database operations use parameterized queries via SQLModel:</p> <pre><code># Safe - parameterized\nstatement = select(User).where(User.email == email)\n\n# Never do this - vulnerable\nquery = f\"SELECT * FROM users WHERE email = '{email}'\"\n</code></pre>"},{"location":"architecture/#extension-points","title":"Extension Points","text":""},{"location":"architecture/#custom-adapters","title":"Custom Adapters","text":"<p>Implement the adapter interface for any database:</p> <pre><code>from fastauth.adapters.base import UserAdapter\n\nclass MongoDBUserAdapter(UserAdapter):\n    def __init__(self, db):\n        self.db = db\n\n    def get_by_email(self, email: str):\n        return self.db.users.find_one({\"email\": email})\n</code></pre>"},{"location":"architecture/#custom-email-providers","title":"Custom Email Providers","text":"<p>Implement the email provider interface:</p> <pre><code>from fastauth.email.base import EmailProvider\n\nclass SendGridProvider(EmailProvider):\n    def send_verification_email(self, user, token):\n        # SendGrid implementation\n</code></pre>"},{"location":"architecture/#custom-routes","title":"Custom Routes","text":"<p>Add your own protected routes:</p> <pre><code>from fastauth.api.dependencies import get_current_user\n\n@app.get(\"/profile\")\ndef get_profile(current_user = Depends(get_current_user)):\n    return {\"email\": current_user.email}\n</code></pre>"},{"location":"architecture/#testing-architecture","title":"Testing Architecture","text":""},{"location":"architecture/#unit-tests","title":"Unit Tests","text":"<p>Test core logic with mock adapters:</p> <pre><code>class FakeUserAdapter(UserAdapter):\n    def __init__(self):\n        self.users = {}\n\n    def create_user(self, email, hashed_password):\n        user = User(email=email, hashed_password=hashed_password)\n        self.users[email] = user\n        return user\n</code></pre>"},{"location":"architecture/#integration-tests","title":"Integration Tests","text":"<p>Test with real database (SQLite in memory):</p> <pre><code>@pytest.fixture\ndef session():\n    engine = create_engine(\"sqlite:///:memory:\")\n    SQLModel.metadata.create_all(engine)\n    with Session(engine) as session:\n        yield session\n</code></pre>"},{"location":"architecture/#api-tests","title":"API Tests","text":"<p>Test HTTP endpoints with TestClient:</p> <pre><code>client = TestClient(app)\nresponse = client.post(\"/auth/register\", json={\n    \"email\": \"test@example.com\",\n    \"password\": \"password123\"\n})\n</code></pre>"},{"location":"architecture/#performance-considerations","title":"Performance Considerations","text":""},{"location":"architecture/#database","title":"Database","text":"<p>Connection Pooling: - SQLAlchemy manages connection pools - Configure pool size for your workload</p> <p>Indexes: - Email (unique) - Token hashes (unique) - User IDs (primary key)</p>"},{"location":"architecture/#caching","title":"Caching","text":"<p>Rate Limiter: - In-memory storage (defaultdict) - Automatic cleanup of old attempts</p> <p>Sessions: - Database-backed (can be moved to Redis)</p>"},{"location":"architecture/#token-generation","title":"Token Generation","text":"<p>Secure Random: - Uses <code>secrets</code> module - Cryptographically secure</p> <p>Hashing: - Argon2 is CPU-intensive (by design) - Balance security with performance</p>"},{"location":"architecture/#configuration","title":"Configuration","text":""},{"location":"architecture/#settings-management","title":"Settings Management","text":"<p>Pydantic settings with environment variables:</p> <pre><code>class Settings(BaseSettings):\n    jwt_secret_key: str\n    access_token_expire_minutes: int = 30\n\n    model_config = SettingsConfigDict(env_file=\".env\")\n</code></pre>"},{"location":"architecture/#environment-based","title":"Environment-Based","text":"<p>Different settings per environment:</p> <pre><code># Development\nEMAIL_PROVIDER=console\nREQUIRE_EMAIL_VERIFICATION=false\n\n# Production\nEMAIL_PROVIDER=smtp\nREQUIRE_EMAIL_VERIFICATION=true\n</code></pre>"},{"location":"architecture/#error-handling","title":"Error Handling","text":""},{"location":"architecture/#exception-hierarchy","title":"Exception Hierarchy","text":"<pre><code>Exception\n\u251c\u2500\u2500 UserAlreadyExistsError\n\u251c\u2500\u2500 InvalidCredentialsError\n\u251c\u2500\u2500 EmailNotVerifiedError\n\u251c\u2500\u2500 RefreshTokenError\n\u251c\u2500\u2500 PasswordResetError\n\u251c\u2500\u2500 EmailVerificationError\n\u251c\u2500\u2500 RoleNotFoundError\n\u251c\u2500\u2500 PermissionNotFoundError\n\u251c\u2500\u2500 RoleAlreadyExistsError\n\u251c\u2500\u2500 PermissionAlreadyExistsError\n\u251c\u2500\u2500 SessionNotFoundError\n\u251c\u2500\u2500 RateLimitExceeded\n\u2514\u2500\u2500 TokenError\n</code></pre>"},{"location":"architecture/#http-error-mapping","title":"HTTP Error Mapping","text":"<pre><code>try:\n    user = authenticate_user(...)\nexcept InvalidCredentialsError:\n    raise HTTPException(status_code=401, detail=\"Invalid credentials\")\nexcept EmailNotVerifiedError:\n    raise HTTPException(status_code=403, detail=\"Email not verified\")\n</code></pre>"},{"location":"architecture/#deployment-considerations","title":"Deployment Considerations","text":""},{"location":"architecture/#database-migrations","title":"Database Migrations","text":"<p>FastAuth doesn't include migrations. Use Alembic:</p> <pre><code>alembic init alembic\nalembic revision --autogenerate -m \"Add FastAuth models\"\nalembic upgrade head\n</code></pre>"},{"location":"architecture/#secret-management","title":"Secret Management","text":"<p>Never commit secrets:</p> <pre><code># Use environment variables\nexport JWT_SECRET_KEY=$(openssl rand -hex 32)\n\n# Or secret management service\n# AWS Secrets Manager, HashiCorp Vault, etc.\n</code></pre>"},{"location":"architecture/#scaling","title":"Scaling","text":"<p>Horizontal Scaling: - Stateless API (JWT tokens) - Database handles state - Load balancer distributes requests</p> <p>Database Scaling: - Read replicas for queries - Write to primary - Consider separate auth database</p>"},{"location":"architecture/#future-architecture","title":"Future Architecture","text":"<p>Completed: - \u2705 RBAC - Role-based access control with permissions - \u2705 Session Management - Track and manage user sessions across devices - \u2705 OAuth 2.0 - Third-party authentication with Google (PKCE support) - \u2705 Account Management - Password change, email change, account deletion</p> <p>Planned enhancements:</p> <p>Multi-Tenancy: - Organization context - Tenant isolation - Per-tenant settings</p> <p>Two-Factor Authentication: - TOTP support - Backup codes - Trusted devices</p> <p>Audit Logging: - All auth events - Suspicious activity detection - Compliance requirements</p>"},{"location":"configuration/","title":"Configuration","text":"<p>FastAuth is configured using environment variables and Pydantic settings.</p>"},{"location":"configuration/#environment-variables","title":"Environment Variables","text":"<p>Create a <code>.env</code> file in your project root:</p> <pre><code># JWT Configuration\nJWT_SECRET_KEY=your-secret-key-here\nJWT_ALGORITHM=HS256\nACCESS_TOKEN_EXPIRE_MINUTES=30\nREFRESH_TOKEN_EXPIRE_DAYS=7\n\n# Email\nEMAIL_PROVIDER=console\nREQUIRE_EMAIL_VERIFICATION=false\n\n# Database\nDATABASE_URL=sqlite:///./app.db\n</code></pre>"},{"location":"configuration/#settings-class","title":"Settings Class","text":"<pre><code>from fastauth import Settings\n\nsettings = Settings(\n    jwt_secret_key=\"your-secret-key\",\n    access_token_expire_minutes=30,\n    require_email_verification=True\n)\n</code></pre>"},{"location":"configuration/#available-settings","title":"Available Settings","text":"<p>See the Settings API Reference for all available configuration options.</p>"},{"location":"contributing/","title":"Contributing to FastAuth","text":"<p>Thank you for your interest in contributing to FastAuth!</p>"},{"location":"contributing/#development-setup","title":"Development Setup","text":""},{"location":"contributing/#prerequisites","title":"Prerequisites","text":"<ul> <li>Python 3.11+</li> <li>Poetry</li> <li>Git</li> </ul>"},{"location":"contributing/#setup","title":"Setup","text":"<pre><code># Clone repository\ngit clone https://github.com/sreekarnv/fastauth.git\ncd fastauth\n\n# Install dependencies\npoetry install\n\n# Install pre-commit hooks\npoetry run pre-commit install\n</code></pre>"},{"location":"contributing/#running-tests","title":"Running Tests","text":"<pre><code># All tests\npoetry run pytest\n\n# With coverage\npoetry run pytest --cov=fastauth --cov-report=html\n\n# Specific test\npoetry run pytest tests/core/test_users.py -v\n\n# Watch mode\npoetry run pytest-watch\n</code></pre>"},{"location":"contributing/#code-quality","title":"Code Quality","text":"<pre><code># Format code\npoetry run black .\n\n# Lint\npoetry run ruff check .\n\n# Fix linting issues\npoetry run ruff check --fix .\n\n# Run all checks\npoetry run pre-commit run --all-files\n</code></pre>"},{"location":"contributing/#commit-convention","title":"Commit Convention","text":"<p>We use Conventional Commits:</p> <pre><code>&lt;type&gt;(&lt;scope&gt;): &lt;description&gt;\n\n[optional body]\n\n[optional footer]\n</code></pre>"},{"location":"contributing/#types","title":"Types","text":"<ul> <li><code>feat</code>: New feature</li> <li><code>fix</code>: Bug fix</li> <li><code>docs</code>: Documentation changes</li> <li><code>test</code>: Test changes</li> <li><code>refactor</code>: Code refactoring</li> <li><code>perf</code>: Performance improvements</li> <li><code>chore</code>: Maintenance tasks</li> <li><code>ci</code>: CI/CD changes</li> <li><code>build</code>: Build system changes</li> </ul>"},{"location":"contributing/#scopes","title":"Scopes","text":"<ul> <li><code>core</code>: Core business logic</li> <li><code>adapters</code>: Database adapters</li> <li><code>api</code>: API routes and dependencies</li> <li><code>security</code>: Security features</li> <li><code>email</code>: Email providers</li> <li><code>tests</code>: Test suite</li> </ul>"},{"location":"contributing/#examples","title":"Examples","text":"<pre><code>feat(core): add user role management\nfix(api): correct token refresh endpoint\ndocs(readme): update installation instructions\ntest(adapters): add MongoDB adapter tests\n</code></pre>"},{"location":"contributing/#emoji-prefix-optional","title":"Emoji Prefix (Optional)","text":"<ul> <li>\u2728 <code>:sparkles:</code> - <code>feat</code></li> <li>\ud83d\udc1b <code>:bug:</code> - <code>fix</code></li> <li>\ud83d\udcdd <code>:memo:</code> - <code>docs</code></li> <li>\ud83e\uddea <code>:test_tube:</code> - <code>test</code></li> <li>\u267b\ufe0f <code>:recycle:</code> - <code>refactor</code></li> <li>\u26a1 <code>:zap:</code> - <code>perf</code></li> <li>\ud83d\udd27 <code>:wrench:</code> - <code>chore</code></li> <li>\ud83d\udd16 <code>:bookmark:</code> - Version tags</li> </ul>"},{"location":"contributing/#pull-request-process","title":"Pull Request Process","text":""},{"location":"contributing/#before-submitting","title":"Before Submitting","text":"<ol> <li>Create a feature branch from <code>main</code></li> <li>Write tests for new features</li> <li>Ensure all tests pass</li> <li>Update documentation</li> <li>Run pre-commit hooks</li> <li>Write clear commit messages</li> </ol>"},{"location":"contributing/#branch-naming","title":"Branch Naming","text":"<pre><code>feat/feature-name\nfix/bug-description\ndocs/documentation-update\nrefactor/code-improvement\n</code></pre>"},{"location":"contributing/#pr-checklist","title":"PR Checklist","text":"<ul> <li> Tests added/updated</li> <li> Documentation updated</li> <li> All tests passing</li> <li> Code formatted (Black)</li> <li> Linting passing (Ruff)</li> <li> No breaking changes (or documented)</li> <li> CHANGELOG.md updated</li> </ul>"},{"location":"contributing/#pr-title","title":"PR Title","text":"<p>Use conventional commit format:</p> <pre><code>feat(core): add two-factor authentication\nfix(api): resolve token expiration issue\ndocs(examples): add OAuth2 example\n</code></pre>"},{"location":"contributing/#pr-description","title":"PR Description","text":"<p>Use the provided template. Include:</p> <ul> <li>What changed</li> <li>Why it changed</li> <li>How to test</li> <li>Breaking changes (if any)</li> </ul>"},{"location":"contributing/#code-guidelines","title":"Code Guidelines","text":""},{"location":"contributing/#architecture","title":"Architecture","text":"<ul> <li>Core logic must be database-agnostic</li> <li>Business logic goes in <code>fastauth/core/</code></li> <li>Database code goes in adapters</li> <li>No business logic in adapters</li> <li>Use dependency injection</li> </ul>"},{"location":"contributing/#testing","title":"Testing","text":"<ul> <li>Write tests for all new features</li> <li>Maintain &gt;90% code coverage</li> <li>Use fixtures for common setup</li> <li>Test edge cases and errors</li> <li>Keep tests isolated</li> </ul>"},{"location":"contributing/#documentation","title":"Documentation","text":"<ul> <li>Add docstrings to public APIs</li> <li>Update README for new features</li> <li>Add examples when helpful</li> <li>Keep docs up to date</li> </ul>"},{"location":"contributing/#security","title":"Security","text":"<ul> <li>Never commit secrets</li> <li>Follow OWASP guidelines</li> <li>Use parameterized queries</li> <li>Validate all inputs</li> <li>Hash sensitive data</li> </ul>"},{"location":"contributing/#project-structure","title":"Project Structure","text":"<pre><code>fastauth/\n\u251c\u2500\u2500 fastauth/           # Main package\n\u2502   \u251c\u2500\u2500 core/          # Business logic (DB-agnostic)\n\u2502   \u251c\u2500\u2500 adapters/      # Database adapters\n\u2502   \u251c\u2500\u2500 api/           # FastAPI routes\n\u2502   \u251c\u2500\u2500 security/      # Security utilities\n\u2502   \u2514\u2500\u2500 email/         # Email providers\n\u251c\u2500\u2500 tests/             # Test suite\n\u251c\u2500\u2500 examples/          # Example applications\n\u2514\u2500\u2500 docs/             # Documentation\n</code></pre>"},{"location":"contributing/#need-help","title":"Need Help?","text":"<ul> <li>Check existing issues and PRs</li> <li>Ask questions in Discussions</li> <li>Read the documentation</li> <li>Look at examples</li> </ul>"},{"location":"contributing/#additional-resources","title":"Additional Resources","text":"<ul> <li>Code of Conduct - Community guidelines</li> <li>Changelog - Version history and changes</li> </ul>"},{"location":"contributing/#license","title":"License","text":"<p>By contributing, you agree that your contributions will be licensed under the MIT License.</p>"},{"location":"deployment/","title":"Deployment Guide","text":"<p>This guide covers deploying FastAuth applications to production environments with best practices for security, scalability, and reliability.</p>"},{"location":"deployment/#table-of-contents","title":"Table of Contents","text":"<ul> <li>Production Checklist</li> <li>Environment Configuration</li> <li>Database Setup</li> <li>Deployment Platforms</li> <li>Security Hardening</li> <li>Monitoring and Logging</li> <li>Performance Optimization</li> </ul>"},{"location":"deployment/#production-checklist","title":"Production Checklist","text":"<p>Before deploying to production, ensure you've completed these steps:</p>"},{"location":"deployment/#security","title":"Security","text":"<ul> <li> Generate strong JWT secret key (32+ bytes)</li> <li> Enable HTTPS/TLS for all connections</li> <li> Configure CORS properly</li> <li> Enable email verification</li> <li> Set up secure password reset flow</li> <li> Configure rate limiting</li> <li> Use environment variables for secrets</li> <li> Enable security headers</li> <li> Review and test authentication flows</li> </ul>"},{"location":"deployment/#database","title":"Database","text":"<ul> <li> Use production database (PostgreSQL/MySQL)</li> <li> Set up database backups</li> <li> Configure connection pooling</li> <li> Run database migrations</li> <li> Set up database monitoring</li> <li> Configure read replicas (if needed)</li> </ul>"},{"location":"deployment/#email","title":"Email","text":"<ul> <li> Configure production email provider (SMTP/SendGrid/SES)</li> <li> Test email delivery</li> <li> Set up email templates</li> <li> Configure SPF/DKIM/DMARC records</li> </ul>"},{"location":"deployment/#monitoring","title":"Monitoring","text":"<ul> <li> Set up application logging</li> <li> Configure error tracking (Sentry)</li> <li> Set up uptime monitoring</li> <li> Configure performance monitoring (APM)</li> <li> Set up alerts for critical issues</li> </ul>"},{"location":"deployment/#testing","title":"Testing","text":"<ul> <li> All tests passing (85%+ coverage)</li> <li> Load testing completed</li> <li> Security audit passed</li> <li> OAuth flows tested end-to-end</li> </ul>"},{"location":"deployment/#environment-configuration","title":"Environment Configuration","text":""},{"location":"deployment/#production-environment-variables","title":"Production Environment Variables","text":"<p>Create a production <code>.env</code> file or configure environment variables:</p> <pre><code># Application\nENV=production\nDEBUG=false\n\n# Database\nDATABASE_URL=postgresql://user:password@host:5432/dbname\n\n# JWT Configuration\nJWT_SECRET_KEY=$(openssl rand -hex 32)\nJWT_ALGORITHM=HS256\nACCESS_TOKEN_EXPIRE_MINUTES=30\nREFRESH_TOKEN_EXPIRE_DAYS=7\n\n# Email Configuration\nEMAIL_PROVIDER=smtp\nSMTP_HOST=smtp.gmail.com\nSMTP_PORT=587\nSMTP_USERNAME=your-email@gmail.com\nSMTP_PASSWORD=your-app-password\nSMTP_FROM_EMAIL=noreply@yourdomain.com\nSMTP_FROM_NAME=Your App Name\n\n# Email Verification\nREQUIRE_EMAIL_VERIFICATION=true\nEMAIL_VERIFICATION_EXPIRE_MINUTES=1440\n\n# OAuth (if using)\nOAUTH_GOOGLE_CLIENT_ID=your-client-id.apps.googleusercontent.com\nOAUTH_GOOGLE_CLIENT_SECRET=your-client-secret\nOAUTH_GOOGLE_REDIRECT_URI=https://yourdomain.com/auth/oauth/google/callback\n\n# CORS\nCORS_ORIGINS=https://yourdomain.com,https://www.yourdomain.com\n\n# Security\nALLOWED_HOSTS=yourdomain.com,www.yourdomain.com\nSECURE_COOKIES=true\nSESSION_COOKIE_SECURE=true\nSESSION_COOKIE_HTTPONLY=true\nSESSION_COOKIE_SAMESITE=lax\n</code></pre>"},{"location":"deployment/#secrets-management","title":"Secrets Management","text":"<p>Never commit secrets to version control.</p>"},{"location":"deployment/#aws-secrets-manager","title":"AWS Secrets Manager","text":"<pre><code>import boto3\nimport json\n\ndef get_secret(secret_name):\n    client = boto3.client('secretsmanager', region_name='us-east-1')\n    response = client.get_secret_value(SecretId=secret_name)\n    return json.loads(response['SecretString'])\n\nsecrets = get_secret('prod/fastauth')\nJWT_SECRET_KEY = secrets['JWT_SECRET_KEY']\n</code></pre>"},{"location":"deployment/#hashicorp-vault","title":"HashiCorp Vault","text":"<pre><code>import hvac\n\nclient = hvac.Client(url='https://vault.example.com')\nclient.token = os.getenv('VAULT_TOKEN')\nsecrets = client.secrets.kv.v2.read_secret_version(path='prod/fastauth')\nJWT_SECRET_KEY = secrets['data']['data']['JWT_SECRET_KEY']\n</code></pre>"},{"location":"deployment/#docker-secrets","title":"Docker Secrets","text":"<pre><code># docker-compose.yml\nservices:\n  app:\n    secrets:\n      - jwt_secret_key\n      - db_password\n\nsecrets:\n  jwt_secret_key:\n    external: true\n  db_password:\n    external: true\n</code></pre>"},{"location":"deployment/#database-setup","title":"Database Setup","text":""},{"location":"deployment/#postgresql-recommended","title":"PostgreSQL (Recommended)","text":""},{"location":"deployment/#installation","title":"Installation","text":"<pre><code># Ubuntu/Debian\nsudo apt-get install postgresql postgresql-contrib\n\n# macOS\nbrew install postgresql\n</code></pre>"},{"location":"deployment/#configuration","title":"Configuration","text":"<pre><code># Create database and user\nsudo -u postgres psql\n\npostgres=# CREATE DATABASE fastauth_prod;\npostgres=# CREATE USER fastauth_user WITH ENCRYPTED PASSWORD 'strong_password';\npostgres=# GRANT ALL PRIVILEGES ON DATABASE fastauth_prod TO fastauth_user;\npostgres=# \\q\n</code></pre>"},{"location":"deployment/#connection-string","title":"Connection String","text":"<pre><code>DATABASE_URL=postgresql://fastauth_user:strong_password@localhost:5432/fastauth_prod\n</code></pre>"},{"location":"deployment/#database-migrations","title":"Database Migrations","text":"<p>Use Alembic for database migrations:</p> <pre><code># Install Alembic\npip install alembic\n\n# Initialize Alembic\nalembic init alembic\n\n# Configure alembic.ini\nsqlalchemy.url = postgresql://user:password@localhost/dbname\n\n# Create migration\nalembic revision --autogenerate -m \"Add FastAuth models\"\n\n# Apply migration\nalembic upgrade head\n</code></pre>"},{"location":"deployment/#connection-pooling","title":"Connection Pooling","text":"<p>Configure SQLAlchemy connection pool:</p> <pre><code>from sqlmodel import create_engine\n\nengine = create_engine(\n    DATABASE_URL,\n    pool_size=20,          # Max connections in pool\n    max_overflow=10,       # Extra connections when pool full\n    pool_timeout=30,       # Seconds to wait for connection\n    pool_recycle=3600,     # Recycle connections after 1 hour\n    pool_pre_ping=True,    # Test connections before using\n)\n</code></pre>"},{"location":"deployment/#backups","title":"Backups","text":"<p>Automated PostgreSQL Backups:</p> <pre><code>#!/bin/bash\n# backup.sh\n\nBACKUP_DIR=\"/backups/postgres\"\nTIMESTAMP=$(date +%Y%m%d_%H%M%S)\nBACKUP_FILE=\"$BACKUP_DIR/fastauth_$TIMESTAMP.sql.gz\"\n\n# Create backup\npg_dump -U fastauth_user fastauth_prod | gzip &gt; $BACKUP_FILE\n\n# Keep only last 7 days\nfind $BACKUP_DIR -name \"fastauth_*.sql.gz\" -mtime +7 -delete\n\n# Upload to S3 (optional)\naws s3 cp $BACKUP_FILE s3://your-backup-bucket/postgres/\n</code></pre> <p>Cron job:</p> <pre><code># Run daily at 2 AM\n0 2 * * * /path/to/backup.sh\n</code></pre>"},{"location":"deployment/#deployment-platforms","title":"Deployment Platforms","text":""},{"location":"deployment/#docker","title":"Docker","text":""},{"location":"deployment/#dockerfile","title":"Dockerfile","text":"<pre><code>FROM python:3.11-slim\n\nWORKDIR /app\n\n# Install dependencies\nCOPY pyproject.toml poetry.lock ./\nRUN pip install poetry &amp;&amp; \\\n    poetry config virtualenvs.create false &amp;&amp; \\\n    poetry install --no-dev --no-interaction --no-ansi\n\n# Copy application\nCOPY . .\n\n# Expose port\nEXPOSE 8000\n\n# Run with Gunicorn\nCMD [\"gunicorn\", \"main:app\", \\\n     \"--workers\", \"4\", \\\n     \"--worker-class\", \"uvicorn.workers.UvicornWorker\", \\\n     \"--bind\", \"0.0.0.0:8000\", \\\n     \"--access-logfile\", \"-\", \\\n     \"--error-logfile\", \"-\"]\n</code></pre>"},{"location":"deployment/#docker-composeyml","title":"docker-compose.yml","text":"<pre><code>version: '3.8'\n\nservices:\n  app:\n    build: .\n    ports:\n      - \"8000:8000\"\n    environment:\n      - DATABASE_URL=postgresql://user:password@db:5432/fastauth\n      - JWT_SECRET_KEY=${JWT_SECRET_KEY}\n    depends_on:\n      - db\n    restart: unless-stopped\n\n  db:\n    image: postgres:15\n    environment:\n      - POSTGRES_DB=fastauth\n      - POSTGRES_USER=user\n      - POSTGRES_PASSWORD=password\n    volumes:\n      - postgres_data:/var/lib/postgresql/data\n    restart: unless-stopped\n\n  nginx:\n    image: nginx:alpine\n    ports:\n      - \"80:80\"\n      - \"443:443\"\n    volumes:\n      - ./nginx.conf:/etc/nginx/nginx.conf\n      - ./ssl:/etc/nginx/ssl\n    depends_on:\n      - app\n    restart: unless-stopped\n\nvolumes:\n  postgres_data:\n</code></pre>"},{"location":"deployment/#aws-ec2","title":"AWS EC2","text":""},{"location":"deployment/#deploy-with-gunicorn","title":"Deploy with Gunicorn","text":"<pre><code># Install dependencies\nsudo apt-get update\nsudo apt-get install python3-pip python3-venv nginx\n\n# Clone repository\ngit clone https://github.com/yourusername/your-app.git\ncd your-app\n\n# Create virtual environment\npython3 -m venv venv\nsource venv/bin/activate\n\n# Install application\npip install poetry\npoetry install --no-dev\n\n# Create systemd service\nsudo nano /etc/systemd/system/fastauth.service\n</code></pre> <p>fastauth.service:</p> <pre><code>[Unit]\nDescription=FastAuth Application\nAfter=network.target\n\n[Service]\nUser=ubuntu\nWorkingDirectory=/home/ubuntu/your-app\nEnvironment=\"PATH=/home/ubuntu/your-app/venv/bin\"\nEnvironmentFile=/home/ubuntu/your-app/.env\nExecStart=/home/ubuntu/your-app/venv/bin/gunicorn \\\n    -w 4 \\\n    -k uvicorn.workers.UvicornWorker \\\n    -b 0.0.0.0:8000 \\\n    main:app\n\nRestart=always\n\n[Install]\nWantedBy=multi-user.target\n</code></pre> <pre><code># Start service\nsudo systemctl daemon-reload\nsudo systemctl start fastauth\nsudo systemctl enable fastauth\n</code></pre>"},{"location":"deployment/#aws-ecsfargate","title":"AWS ECS/Fargate","text":"<pre><code>{\n  \"family\": \"fastauth\",\n  \"taskRoleArn\": \"arn:aws:iam::123456789:role/ecsTaskRole\",\n  \"networkMode\": \"awsvpc\",\n  \"containerDefinitions\": [\n    {\n      \"name\": \"fastauth-app\",\n      \"image\": \"your-ecr-repo/fastauth:latest\",\n      \"portMappings\": [\n        {\n          \"containerPort\": 8000,\n          \"protocol\": \"tcp\"\n        }\n      ],\n      \"environment\": [\n        {\n          \"name\": \"DATABASE_URL\",\n          \"value\": \"postgresql://...\"\n        }\n      ],\n      \"secrets\": [\n        {\n          \"name\": \"JWT_SECRET_KEY\",\n          \"valueFrom\": \"arn:aws:secretsmanager:us-east-1:123456789:secret:jwt-key\"\n        }\n      ],\n      \"logConfiguration\": {\n        \"logDriver\": \"awslogs\",\n        \"options\": {\n          \"awslogs-group\": \"/ecs/fastauth\",\n          \"awslogs-region\": \"us-east-1\",\n          \"awslogs-stream-prefix\": \"ecs\"\n        }\n      }\n    }\n  ],\n  \"requiresCompatibilities\": [\"FARGATE\"],\n  \"cpu\": \"256\",\n  \"memory\": \"512\"\n}\n</code></pre>"},{"location":"deployment/#heroku","title":"Heroku","text":"<pre><code># Install Heroku CLI\ncurl https://cli-assets.heroku.com/install.sh | sh\n\n# Login\nheroku login\n\n# Create app\nheroku create your-app-name\n\n# Add PostgreSQL\nheroku addons:create heroku-postgresql:hobby-dev\n\n# Set environment variables\nheroku config:set JWT_SECRET_KEY=$(openssl rand -hex 32)\nheroku config:set REQUIRE_EMAIL_VERIFICATION=true\n\n# Deploy\ngit push heroku main\n\n# Run migrations\nheroku run alembic upgrade head\n</code></pre> <p>Procfile:</p> <pre><code>web: gunicorn -w 4 -k uvicorn.workers.UvicornWorker main:app\n</code></pre>"},{"location":"deployment/#vercelrailway","title":"Vercel/Railway","text":"<p>These platforms work well with FastAPI but require serverless-friendly configurations.</p>"},{"location":"deployment/#security-hardening","title":"Security Hardening","text":""},{"location":"deployment/#httpstls","title":"HTTPS/TLS","text":"<p>Always use HTTPS in production.</p>"},{"location":"deployment/#lets-encrypt-with-nginx","title":"Let's Encrypt with Nginx","text":"<pre><code># Install Certbot\nsudo apt-get install certbot python3-certbot-nginx\n\n# Obtain certificate\nsudo certbot --nginx -d yourdomain.com -d www.yourdomain.com\n\n# Auto-renewal (cron)\nsudo certbot renew --dry-run\n</code></pre>"},{"location":"deployment/#nginx-ssl-configuration","title":"Nginx SSL Configuration","text":"<pre><code>server {\n    listen 443 ssl http2;\n    server_name yourdomain.com;\n\n    ssl_certificate /etc/letsencrypt/live/yourdomain.com/fullchain.pem;\n    ssl_certificate_key /etc/letsencrypt/live/yourdomain.com/privkey.pem;\n\n    ssl_protocols TLSv1.2 TLSv1.3;\n    ssl_ciphers HIGH:!aNULL:!MD5;\n    ssl_prefer_server_ciphers on;\n\n    # Security headers\n    add_header Strict-Transport-Security \"max-age=31536000; includeSubDomains\" always;\n    add_header X-Frame-Options \"SAMEORIGIN\" always;\n    add_header X-Content-Type-Options \"nosniff\" always;\n    add_header X-XSS-Protection \"1; mode=block\" always;\n\n    location / {\n        proxy_pass http://localhost:8000;\n        proxy_set_header Host $host;\n        proxy_set_header X-Real-IP $remote_addr;\n        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;\n        proxy_set_header X-Forwarded-Proto $scheme;\n    }\n}\n\n# Redirect HTTP to HTTPS\nserver {\n    listen 80;\n    server_name yourdomain.com;\n    return 301 https://$server_name$request_uri;\n}\n</code></pre>"},{"location":"deployment/#cors-configuration","title":"CORS Configuration","text":"<pre><code>from fastapi.middleware.cors import CORSMiddleware\n\napp.add_middleware(\n    CORSMiddleware,\n    allow_origins=[\n        \"https://yourdomain.com\",\n        \"https://www.yourdomain.com\"\n    ],\n    allow_credentials=True,\n    allow_methods=[\"GET\", \"POST\", \"PUT\", \"DELETE\"],\n    allow_headers=[\"*\"],\n    max_age=3600,\n)\n</code></pre>"},{"location":"deployment/#rate-limiting","title":"Rate Limiting","text":"<p>FastAuth includes built-in rate limiting, but consider additional layers:</p> <p>Nginx rate limiting:</p> <pre><code># Define rate limit zone\nlimit_req_zone $binary_remote_addr zone=auth:10m rate=10r/s;\n\nlocation /auth {\n    limit_req zone=auth burst=20 nodelay;\n    proxy_pass http://localhost:8000;\n}\n</code></pre> <p>CloudFlare: Configure rate limiting rules in CloudFlare dashboard.</p>"},{"location":"deployment/#security-headers","title":"Security Headers","text":"<pre><code>from fastapi import FastAPI\nfrom starlette.middleware.trustedhost import TrustedHostMiddleware\n\napp = FastAPI()\n\n# Trusted host middleware\napp.add_middleware(\n    TrustedHostMiddleware,\n    allowed_hosts=[\"yourdomain.com\", \"www.yourdomain.com\"]\n)\n\n@app.middleware(\"http\")\nasync def add_security_headers(request, call_next):\n    response = await call_next(request)\n    response.headers[\"X-Content-Type-Options\"] = \"nosniff\"\n    response.headers[\"X-Frame-Options\"] = \"DENY\"\n    response.headers[\"X-XSS-Protection\"] = \"1; mode=block\"\n    response.headers[\"Strict-Transport-Security\"] = \"max-age=31536000; includeSubDomains\"\n    return response\n</code></pre>"},{"location":"deployment/#monitoring-and-logging","title":"Monitoring and Logging","text":""},{"location":"deployment/#application-logging","title":"Application Logging","text":"<pre><code>import logging\nfrom logging.handlers import RotatingFileHandler\n\n# Configure logging\nlogging.basicConfig(\n    level=logging.INFO,\n    format='%(asctime)s - %(name)s - %(levelname)s - %(message)s',\n    handlers=[\n        RotatingFileHandler(\n            'app.log',\n            maxBytes=10485760,  # 10MB\n            backupCount=10\n        ),\n        logging.StreamHandler()\n    ]\n)\n\nlogger = logging.getLogger(__name__)\n\n# Log authentication events\n@app.post(\"/auth/login\")\ndef login(payload: LoginRequest):\n    try:\n        result = authenticate_user(...)\n        logger.info(f\"User login successful: {payload.email}\")\n        return result\n    except InvalidCredentialsError:\n        logger.warning(f\"Failed login attempt: {payload.email}\")\n        raise\n</code></pre>"},{"location":"deployment/#error-tracking-with-sentry","title":"Error Tracking with Sentry","text":"<pre><code>pip install sentry-sdk[fastapi]\n</code></pre> <pre><code>import sentry_sdk\nfrom sentry_sdk.integrations.fastapi import FastApiIntegration\n\nsentry_sdk.init(\n    dsn=\"https://your-dsn@sentry.io/project-id\",\n    integrations=[FastApiIntegration()],\n    environment=\"production\",\n    traces_sample_rate=0.1,  # 10% of transactions\n)\n</code></pre>"},{"location":"deployment/#health-checks","title":"Health Checks","text":"<pre><code>@app.get(\"/health\")\ndef health_check():\n    # Check database connection\n    try:\n        with Session(engine) as session:\n            session.exec(select(1))\n        db_status = \"healthy\"\n    except Exception as e:\n        db_status = f\"unhealthy: {str(e)}\"\n\n    return {\n        \"status\": \"healthy\" if db_status == \"healthy\" else \"degraded\",\n        \"database\": db_status,\n        \"version\": \"1.0.0\"\n    }\n</code></pre>"},{"location":"deployment/#monitoring-with-prometheus","title":"Monitoring with Prometheus","text":"<pre><code>pip install prometheus-fastapi-instrumentator\n</code></pre> <pre><code>from prometheus_fastapi_instrumentator import Instrumentator\n\napp = FastAPI()\nInstrumentator().instrument(app).expose(app)\n</code></pre>"},{"location":"deployment/#performance-optimization","title":"Performance Optimization","text":""},{"location":"deployment/#caching","title":"Caching","text":"<p>Redis caching for sessions:</p> <pre><code>from redis import asyncio as aioredis\n\nredis = await aioredis.from_url(\"redis://localhost\")\n\n# Cache user sessions\nawait redis.setex(f\"session:{session_id}\", 3600, user_data)\ncached = await redis.get(f\"session:{session_id}\")\n</code></pre>"},{"location":"deployment/#database-optimization","title":"Database Optimization","text":"<p>Indexes:</p> <pre><code>from sqlmodel import Field, Index\n\nclass User(SQLModel, table=True):\n    email: str = Field(index=True, unique=True)\n    created_at: datetime = Field(index=True)\n\n    __table_args__ = (\n        Index('idx_user_email_active', 'email', 'is_active'),\n    )\n</code></pre> <p>Query optimization:</p> <pre><code># Use select() for efficient querying\nfrom sqlmodel import select\n\n# Good - only fetch needed columns\nstatement = select(User.id, User.email).where(User.is_active == True)\n\n# Avoid - fetches all columns\nusers = session.exec(select(User)).all()\n</code></pre>"},{"location":"deployment/#load-balancing","title":"Load Balancing","text":"<p>Nginx upstream:</p> <pre><code>upstream fastauth_backend {\n    server 127.0.0.1:8000;\n    server 127.0.0.1:8001;\n    server 127.0.0.1:8002;\n    server 127.0.0.1:8003;\n}\n\nserver {\n    location / {\n        proxy_pass http://fastauth_backend;\n    }\n}\n</code></pre>"},{"location":"deployment/#gunicorn-workers","title":"Gunicorn Workers","text":"<pre><code># Calculate workers: (2 x CPU cores) + 1\ngunicorn -w 9 -k uvicorn.workers.UvicornWorker main:app\n</code></pre>"},{"location":"deployment/#continuous-deployment","title":"Continuous Deployment","text":""},{"location":"deployment/#github-actions","title":"GitHub Actions","text":"<pre><code>name: Deploy to Production\n\non:\n  push:\n    branches: [main]\n\njobs:\n  deploy:\n    runs-on: ubuntu-latest\n    steps:\n      - uses: actions/checkout@v3\n\n      - name: Deploy to EC2\n        env:\n          SSH_PRIVATE_KEY: ${{ secrets.SSH_PRIVATE_KEY }}\n        run: |\n          echo \"$SSH_PRIVATE_KEY\" &gt; key.pem\n          chmod 600 key.pem\n          ssh -i key.pem ubuntu@your-server.com &lt;&lt; 'EOF'\n            cd /app\n            git pull origin main\n            source venv/bin/activate\n            pip install -r requirements.txt\n            sudo systemctl restart fastauth\n          EOF\n</code></pre>"},{"location":"deployment/#troubleshooting","title":"Troubleshooting","text":""},{"location":"deployment/#common-production-issues","title":"Common Production Issues","text":"<p>High memory usage: - Reduce Gunicorn workers - Enable connection pooling - Add caching layer</p> <p>Slow database queries: - Add database indexes - Use connection pooling - Enable query logging - Consider read replicas</p> <p>OAuth redirect errors: - Verify redirect URIs match exactly - Ensure HTTPS is configured - Check CORS settings</p>"},{"location":"deployment/#checklist-before-going-live","title":"Checklist Before Going Live","text":"<ul> <li> All secrets in environment variables/secrets manager</li> <li> HTTPS enabled with valid certificate</li> <li> Database backups automated</li> <li> Monitoring and alerting configured</li> <li> Error tracking (Sentry) set up</li> <li> Load testing completed</li> <li> Security audit passed</li> <li> Documentation updated</li> <li> Rollback plan documented</li> <li> Team trained on deployment process</li> </ul> <p>Your FastAuth application is now production-ready! \ud83d\ude80</p>"},{"location":"testing/","title":"Testing Guide","text":"<p>This guide covers testing practices, running tests, and understanding test coverage for FastAuth.</p>"},{"location":"testing/#quick-reference","title":"Quick Reference","text":""},{"location":"testing/#run-all-tests","title":"Run All Tests","text":"<pre><code># Basic test run\npoetry run pytest\n\n# With coverage (recommended)\npoetry run test-cov\n\n# Quiet mode\npoetry run test-cov -q\n\n# Verbose mode\npoetry run pytest -v\n</code></pre>"},{"location":"testing/#run-specific-tests","title":"Run Specific Tests","text":"<pre><code># Single test file\npoetry run pytest tests/core/test_oauth.py\n\n# Single test function\npoetry run pytest tests/core/test_oauth.py::test_initiate_oauth_flow_basic\n\n# Test pattern matching\npoetry run pytest -k \"oauth\"\n\n# Test by marker\npoetry run pytest -m \"slow\"\n</code></pre>"},{"location":"testing/#test-organization","title":"Test Organization","text":""},{"location":"testing/#directory-structure","title":"Directory Structure","text":"<pre><code>tests/\n\u251c\u2500\u2500 adapters/\n\u2502   \u2514\u2500\u2500 sqlalchemy/         # SQLAlchemy adapter tests\n\u2502       \u251c\u2500\u2500 test_user_adapter.py\n\u2502       \u251c\u2500\u2500 test_oauth_accounts.py\n\u2502       \u2514\u2500\u2500 conftest.py     # Shared fixtures\n\u251c\u2500\u2500 api/                    # API endpoint tests\n\u2502   \u251c\u2500\u2500 test_auth_flow.py\n\u2502   \u251c\u2500\u2500 test_oauth.py\n\u2502   \u2514\u2500\u2500 conftest.py\n\u251c\u2500\u2500 core/                   # Core business logic tests\n\u2502   \u251c\u2500\u2500 test_users.py\n\u2502   \u251c\u2500\u2500 test_oauth.py\n\u2502   \u2514\u2500\u2500 test_roles.py\n\u251c\u2500\u2500 security/               # Security module tests\n\u2502   \u251c\u2500\u2500 test_jwt.py\n\u2502   \u251c\u2500\u2500 test_oauth_security.py\n\u2502   \u2514\u2500\u2500 test_rate_limit.py\n\u2514\u2500\u2500 fakes/                  # Fake/mock adapters for testing\n    \u251c\u2500\u2500 oauth_accounts.py\n    \u2514\u2500\u2500 oauth_states.py\n</code></pre>"},{"location":"testing/#test-categories","title":"Test Categories","text":"<p>Unit Tests (<code>tests/core/</code>) - Test business logic in isolation - Use fake adapters to avoid database - Fast execution - Example: <code>tests/core/test_users.py</code></p> <p>Integration Tests (<code>tests/adapters/</code>) - Test adapter implementations - Use in-memory SQLite database - Verify database operations - Example: <code>tests/adapters/sqlalchemy/test_user_adapter.py</code></p> <p>API Tests (<code>tests/api/</code>) - Test HTTP endpoints end-to-end - Use FastAPI TestClient - Verify request/response handling - Example: <code>tests/api/test_auth_flow.py</code></p>"},{"location":"testing/#test-reports","title":"Test Reports","text":""},{"location":"testing/#report-structure","title":"Report Structure","text":"<p>All test reports are automatically generated in timestamped folders:</p> <pre><code>test-results/\n\u2514\u2500\u2500 YYYYMMDD_HHMMSS/\n    \u251c\u2500\u2500 report.html          # Interactive HTML test report\n    \u251c\u2500\u2500 junit.xml            # JUnit XML (for CI/CD)\n    \u251c\u2500\u2500 pytest.log           # Detailed test execution log\n    \u251c\u2500\u2500 coverage.xml         # Machine-readable coverage\n    \u251c\u2500\u2500 .coverage            # Coverage database file\n    \u2514\u2500\u2500 htmlcov/             # Interactive HTML coverage browser\n        \u2514\u2500\u2500 index.html\n</code></pre>"},{"location":"testing/#viewing-reports","title":"Viewing Reports","text":"<p>Test Results: <pre><code># Open latest HTML test report\nopen test-results/$(ls -t test-results | head -1)/report.html\n\n# On Windows\nstart test-results/YYYYMMDD_HHMMSS/report.html\n</code></pre></p> <p>Coverage: <pre><code># Open interactive coverage browser\nopen test-results/$(ls -t test-results | head -1)/htmlcov/index.html\n\n# On Windows\nstart test-results/YYYYMMDD_HHMMSS/htmlcov/index.html\n</code></pre></p>"},{"location":"testing/#cicd-integration","title":"CI/CD Integration","text":"<p>The <code>junit.xml</code> file can be used in CI/CD pipelines:</p> <pre><code># GitHub Actions example\n- name: Run tests\n  run: poetry run test-cov\n\n- name: Upload test results\n  uses: actions/upload-artifact@v3\n  with:\n    name: test-results\n    path: test-results/*/junit.xml\n</code></pre>"},{"location":"testing/#coverage","title":"Coverage","text":""},{"location":"testing/#current-coverage","title":"Current Coverage","text":"<ul> <li>Total Coverage: 85%</li> <li>Total Tests: 195</li> <li>All Tests Passing: \u2705</li> </ul>"},{"location":"testing/#coverage-goals","title":"Coverage Goals","text":"<ul> <li>Minimum: 80% (\u2705 Achieved)</li> <li>Target: 85% (\u2705 Achieved)</li> <li>Stretch: 90%</li> </ul>"},{"location":"testing/#viewing-coverage","title":"Viewing Coverage","text":"<p>Terminal Summary: <pre><code>poetry run test-cov\n# Coverage summary appears at the end\n</code></pre></p> <p>HTML Report (Recommended): <pre><code>poetry run test-cov\n# Open the latest htmlcov/index.html in your browser\n</code></pre></p> <p>The HTML coverage report shows: - Line-by-line coverage visualization - Branch coverage - Missing lines highlighted in red - Partial coverage in yellow</p>"},{"location":"testing/#coverage-by-module","title":"Coverage by Module","text":"<p>100% Coverage (38 files): - All core authentication flows - All test fixtures and fakes - Session management - Account management - RBAC functions</p> <p>85%+ Coverage: - Core OAuth flows (82%) - API dependencies (85%) - Account API (92%) - Email verification (89%)</p> <p>Areas for Improvement (&lt;40%): - OAuth API endpoints (32%) - OAuth adapters (33-39%) - Email providers (38-70%) - Google OAuth provider (39%)</p>"},{"location":"testing/#writing-tests","title":"Writing Tests","text":""},{"location":"testing/#test-structure","title":"Test Structure","text":"<p>Follow the Arrange-Act-Assert pattern:</p> <pre><code>def test_create_user_success():\n    # Arrange\n    users = FakeUserAdapter()\n    email = \"test@example.com\"\n    password = \"password123\"\n\n    # Act\n    user = create_user(users=users, email=email, password=password)\n\n    # Assert\n    assert user.email == email\n    assert user.hashed_password != password  # Password should be hashed\n    assert user.is_active is True\n</code></pre>"},{"location":"testing/#using-fixtures","title":"Using Fixtures","text":"<p>Session Fixture (database tests): <pre><code>def test_user_adapter(session):\n    # session is an in-memory SQLite database\n    adapter = SQLAlchemyUserAdapter(session)\n    user = adapter.create_user(\n        email=\"test@example.com\",\n        hashed_password=\"hashed...\"\n    )\n    assert user.id is not None\n</code></pre></p> <p>Client Fixture (API tests): <pre><code>def test_register_endpoint(client):\n    # client is a FastAPI TestClient\n    response = client.post(\"/auth/register\", json={\n        \"email\": \"test@example.com\",\n        \"password\": \"password123\"\n    })\n    assert response.status_code == 201\n</code></pre></p>"},{"location":"testing/#testing-async-code","title":"Testing Async Code","text":"<p>For async OAuth flows:</p> <pre><code>import pytest\n\n@pytest.mark.asyncio\nasync def test_complete_oauth_flow_new_user(session):\n    # Test async OAuth completion\n    user, is_new = await complete_oauth_flow(...)\n    assert is_new is True\n</code></pre>"},{"location":"testing/#testing-error-cases","title":"Testing Error Cases","text":"<p>Always test both success and failure paths:</p> <pre><code>def test_create_user_duplicate_email():\n    users = FakeUserAdapter()\n    email = \"test@example.com\"\n\n    # Create first user\n    create_user(users=users, email=email, password=\"pass1\")\n\n    # Attempt to create duplicate\n    with pytest.raises(UserAlreadyExistsError):\n        create_user(users=users, email=email, password=\"pass2\")\n</code></pre>"},{"location":"testing/#best-practices","title":"Best Practices","text":""},{"location":"testing/#1-test-independence","title":"1. Test Independence","text":"<p>Each test should be independent:</p> <pre><code># Good - independent\ndef test_user_creation():\n    users = FakeUserAdapter()  # Fresh adapter\n    user = create_user(users=users, email=\"test@example.com\", password=\"pass\")\n    assert user is not None\n\n# Bad - depends on previous state\nuser_adapter = FakeUserAdapter()  # Shared state\n\ndef test_first():\n    create_user(users=user_adapter, ...)  # Modifies shared state\n\ndef test_second():\n    # Assumes test_first ran first\n    user = user_adapter.get_by_email(...)\n</code></pre>"},{"location":"testing/#2-descriptive-test-names","title":"2. Descriptive Test Names","text":"<p>Use clear, descriptive names:</p> <pre><code># Good\ndef test_login_fails_if_email_not_verified():\n    ...\n\ndef test_refresh_token_rotation_on_use():\n    ...\n\n# Bad\ndef test_login():\n    ...\n\ndef test_token():\n    ...\n</code></pre>"},{"location":"testing/#3-test-one-thing","title":"3. Test One Thing","text":"<p>Each test should verify one specific behavior:</p> <pre><code># Good - tests one thing\ndef test_password_is_hashed_on_user_creation():\n    users = FakeUserAdapter()\n    password = \"plaintext\"\n    user = create_user(users=users, email=\"test@example.com\", password=password)\n    assert user.hashed_password != password\n\n# Bad - tests multiple things\ndef test_user_creation_and_login_and_token_refresh():\n    # Too much in one test\n    ...\n</code></pre>"},{"location":"testing/#4-use-fake-adapters-for-unit-tests","title":"4. Use Fake Adapters for Unit Tests","text":"<p>For core logic tests, use fake adapters:</p> <pre><code># tests/fakes/users.py\nclass FakeUserAdapter(UserAdapter):\n    def __init__(self):\n        self.users = {}\n\n    def create_user(self, email, hashed_password):\n        user = User(email=email, hashed_password=hashed_password)\n        self.users[email] = user\n        return user\n</code></pre> <p>Benefits: - No database required - Faster test execution - Easier to control test scenarios - True unit testing</p>"},{"location":"testing/#5-use-real-database-for-integration-tests","title":"5. Use Real Database for Integration Tests","text":"<p>For adapter tests, use real database:</p> <pre><code>@pytest.fixture\ndef session():\n    engine = create_engine(\n        \"sqlite:///:memory:\",\n        connect_args={\"check_same_thread\": False}\n    )\n    SQLModel.metadata.create_all(engine)\n    with Session(engine) as session:\n        yield session\n    engine.dispose()  # Clean up\n</code></pre>"},{"location":"testing/#continuous-integration","title":"Continuous Integration","text":"<p>FastAuth uses GitHub Actions for CI/CD:</p> <pre><code># .github/workflows/ci.yml\ntest:\n  runs-on: ubuntu-latest\n  strategy:\n    matrix:\n      python-version: [\"3.11\", \"3.12\", \"3.13\"]\n  steps:\n    - uses: actions/checkout@v3\n    - name: Set up Python\n      uses: actions/setup-python@v4\n      with:\n        python-version: ${{ matrix.python-version }}\n    - name: Install dependencies\n      run: |\n        pip install poetry\n        poetry install\n    - name: Run tests\n      run: poetry run pytest --cov=fastauth --cov-report=xml\n    - name: Upload coverage\n      uses: codecov/codecov-action@v3\n</code></pre>"},{"location":"testing/#ci-test-results","title":"CI Test Results","text":"<ul> <li>Tests run on every push and PR</li> <li>Matrix testing across Python 3.11, 3.12, 3.13</li> <li>Coverage reports uploaded to Codecov</li> <li>Status badges in README</li> </ul>"},{"location":"testing/#troubleshooting","title":"Troubleshooting","text":""},{"location":"testing/#resourcewarnings","title":"ResourceWarnings","text":"<p>If you see ResourceWarnings about unclosed database connections:</p> <pre><code># Ensure engine disposal in fixtures\n@pytest.fixture\ndef session():\n    engine = create_engine(\"sqlite:///:memory:\")\n    SQLModel.metadata.create_all(engine)\n    with Session(engine) as session:\n        yield session\n\n    # Important: Dispose engine to close connections\n    engine.dispose()\n</code></pre>"},{"location":"testing/#test-isolation-issues","title":"Test Isolation Issues","text":"<p>If tests pass individually but fail when run together:</p> <pre><code># Use fresh fixtures for each test\n@pytest.fixture\ndef users():\n    return FakeUserAdapter()  # New instance each time\n\n# Not this\nusers = FakeUserAdapter()  # Shared across tests\n</code></pre>"},{"location":"testing/#slow-tests","title":"Slow Tests","text":"<p>For slow tests (e.g., OAuth network requests):</p> <pre><code># Mark slow tests\n@pytest.mark.slow\ndef test_real_oauth_provider():\n    ...\n\n# Skip slow tests by default\npytest -m \"not slow\"\n\n# Run only slow tests\npytest -m \"slow\"\n</code></pre>"},{"location":"testing/#coverage-not-updated","title":"Coverage Not Updated","text":"<p>If coverage isn't updating:</p> <pre><code># Clear coverage cache\nrm -rf .coverage htmlcov/\n\n# Run tests fresh\npoetry run test-cov\n</code></pre>"},{"location":"testing/#additional-resources","title":"Additional Resources","text":"<ul> <li>pytest Documentation</li> <li>Coverage.py Documentation</li> <li>FastAPI Testing Guide</li> <li>Testing Best Practices</li> </ul>"},{"location":"getting-started/core-concepts/","title":"Core Concepts","text":"<p>Understanding how FastAuth works.</p>"},{"location":"getting-started/core-concepts/#database-agnostic-architecture","title":"Database Agnostic Architecture","text":"<p>FastAuth's core business logic has zero dependencies on any specific database. All database operations go through adapter interfaces.</p> <pre><code>\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502         Your FastAPI App            \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502         FastAuth API Layer          \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502      Core Business Logic            \u2502  \u2190 Database-agnostic\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502      Adapter Interface              \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502   Database Implementation           \u2502  \u2190 SQLAlchemy, MongoDB, etc.\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n</code></pre>"},{"location":"getting-started/core-concepts/#using-sqlalchemy-default","title":"Using SQLAlchemy (Default)","text":"<pre><code>from fastauth.adapters.sqlalchemy import SQLAlchemyUserAdapter\nfrom sqlmodel import Session\n\ndef get_user_by_email(email: str, session: Session):\n    user_adapter = SQLAlchemyUserAdapter(session)\n    return user_adapter.get_by_email(email)\n</code></pre>"},{"location":"getting-started/core-concepts/#implementing-custom-adapters","title":"Implementing Custom Adapters","text":"<pre><code>from fastauth.adapters.base import UserAdapter\n\nclass MongoDBUserAdapter(UserAdapter):\n    def get_by_email(self, email: str):\n        return self.collection.find_one({\"email\": email})\n</code></pre>"},{"location":"getting-started/core-concepts/#dependency-injection","title":"Dependency Injection","text":"<p>FastAuth uses FastAPI's dependency injection system for flexibility. Override dependencies to customize behavior.</p> <pre><code>from fastauth.api import dependencies\n\n# Override session dependency\napp.dependency_overrides[dependencies.get_session] = get_session\n</code></pre>"},{"location":"getting-started/core-concepts/#jwt-authentication","title":"JWT Authentication","text":"<p>FastAuth uses JWT tokens for authentication:</p> <ul> <li>Access Token: Short-lived (default: 30 min), used for API requests</li> <li>Refresh Token: Long-lived (default: 7 days), used to get new access tokens</li> </ul> <pre><code>from fastauth.security.jwt import create_access_token, decode_access_token\n\n# Create token\ntoken = create_access_token(subject=str(user_id))\n\n# Decode token\npayload = decode_access_token(token)\nuser_id = payload[\"sub\"]\n</code></pre>"},{"location":"getting-started/core-concepts/#password-security","title":"Password Security","text":"<p>FastAuth uses Argon2 for password hashing (OWASP recommended):</p> <pre><code>from fastauth.security.password import hash_password, verify_password\n\n# Hash password\nhashed = hash_password(\"my-password\")\n\n# Verify password\nis_valid = verify_password(\"my-password\", hashed)\n</code></pre>"},{"location":"getting-started/core-concepts/#role-based-access-control-rbac","title":"Role-Based Access Control (RBAC)","text":"<p>FastAuth provides built-in RBAC with roles and permissions:</p> <pre><code>from fastauth.api.dependencies import require_role, require_permission\n\n# Require specific role\n@app.get(\"/admin\", dependencies=[Depends(require_role(\"admin\"))])\ndef admin_route():\n    return {\"message\": \"Admin only\"}\n\n# Require specific permission\n@app.delete(\"/users/{id}\", dependencies=[Depends(require_permission(\"delete:users\"))])\ndef delete_user(id: str):\n    return {\"message\": \"User deleted\"}\n</code></pre>"},{"location":"getting-started/core-concepts/#session-management","title":"Session Management","text":"<p>Track user sessions across multiple devices:</p> <pre><code>from fastauth.api.sessions import router as sessions_router\n\napp.include_router(sessions_router)\n</code></pre> <p>Users can: - List all active sessions - Revoke specific sessions - Revoke all sessions (logout everywhere)</p>"},{"location":"getting-started/core-concepts/#oauth-20-integration","title":"OAuth 2.0 Integration","text":"<p>FastAuth supports OAuth providers (Google, GitHub, etc.):</p> <pre><code>from fastauth.providers.google import GoogleOAuthProvider\nfrom fastauth.core.oauth import initiate_oauth_flow, complete_oauth_flow\n\n# Initialize provider\nprovider = GoogleOAuthProvider(\n    client_id=\"your-client-id\",\n    client_secret=\"your-client-secret\",\n)\n\n# Start OAuth flow\nauth_url, state, verifier = initiate_oauth_flow(\n    states=state_adapter,\n    provider=provider,\n    redirect_uri=\"http://localhost:8000/callback\",\n)\n\n# Complete OAuth flow\nuser, is_new = await complete_oauth_flow(\n    states=state_adapter,\n    oauth_accounts=oauth_adapter,\n    users=user_adapter,\n    provider=provider,\n    code=code,\n    state=state,\n    code_verifier=verifier,\n)\n</code></pre>"},{"location":"getting-started/core-concepts/#configuration","title":"Configuration","text":"<p>FastAuth uses environment variables for configuration:</p> <pre><code># JWT Settings\nJWT_SECRET_KEY=your-secret-key\nJWT_ALGORITHM=HS256\nACCESS_TOKEN_EXPIRE_MINUTES=30\nREFRESH_TOKEN_EXPIRE_DAYS=7\n\n# Email Settings\nEMAIL_PROVIDER=console  # or smtp\nREQUIRE_EMAIL_VERIFICATION=false\n\n# Database\nDATABASE_URL=sqlite:///./app.db\n</code></pre> <p>Generate secure keys:</p> <pre><code>python -c \"import secrets; print(secrets.token_urlsafe(32))\"\n</code></pre>"},{"location":"getting-started/core-concepts/#type-safety","title":"Type Safety","text":"<p>FastAuth provides full type hints throughout:</p> <pre><code>from fastauth.api.schemas import RegisterRequest, LoginResponse\nfrom fastauth.adapters.sqlalchemy.models import User\n\n@app.post(\"/register\", response_model=LoginResponse)\ndef register(payload: RegisterRequest) -&gt; LoginResponse:\n    # All types are validated by Pydantic\n    ...\n</code></pre>"},{"location":"getting-started/core-concepts/#next-steps","title":"Next Steps","text":"<ul> <li>Authentication Guide - Registration, login, password reset</li> <li>Protecting Routes - Secure your endpoints</li> <li>RBAC Guide - Roles and permissions</li> <li>OAuth Guide - Social login integration</li> <li>Examples - Working example projects</li> </ul>"},{"location":"getting-started/installation/","title":"Installation","text":"<p>FastAuth can be installed via pip or Poetry.</p>"},{"location":"getting-started/installation/#requirements","title":"Requirements","text":"<ul> <li>Python 3.11 or higher</li> <li>FastAPI 0.125.0 or higher</li> </ul>"},{"location":"getting-started/installation/#install-from-pypi","title":"Install from PyPI","text":"<pre><code>pip install sreekarnv-fastauth\n</code></pre>"},{"location":"getting-started/installation/#install-with-poetry","title":"Install with Poetry","text":"<pre><code>poetry add sreekarnv-fastauth\n</code></pre>"},{"location":"getting-started/installation/#verify-installation","title":"Verify Installation","text":"<pre><code>import fastauth\nprint(fastauth.__version__)\n</code></pre>"},{"location":"getting-started/installation/#next-steps","title":"Next Steps","text":"<ul> <li>Quick Start - Build your first app in 5 minutes</li> <li>Core Concepts - Understand how FastAuth works</li> </ul>"},{"location":"getting-started/quickstart/","title":"Quick Start","text":"<p>Get a working authentication system in 5 minutes.</p>"},{"location":"getting-started/quickstart/#step-1-install","title":"Step 1: Install","text":"<pre><code>pip install sreekarnv-fastauth\n</code></pre>"},{"location":"getting-started/quickstart/#step-2-create-your-app","title":"Step 2: Create Your App","text":"<p>Create <code>main.py</code>:</p> <pre><code>from fastapi import Depends, FastAPI\nfrom fastapi.security import HTTPAuthorizationCredentials, HTTPBearer\nfrom sqlmodel import Session, SQLModel, create_engine\n\nfrom fastauth.api import dependencies\nfrom fastauth.api.auth import router as auth_router\nfrom fastauth.security.jwt import decode_access_token\n\n# Database setup\nDATABASE_URL = \"sqlite:///./app.db\"\nengine = create_engine(DATABASE_URL)\n\ndef init_db():\n    SQLModel.metadata.create_all(engine)\n\ndef get_session():\n    with Session(engine) as session:\n        yield session\n\n# Create app\napp = FastAPI(title=\"My Auth App\")\n\ninit_db()\n\n# Include auth router\napp.include_router(auth_router)\n\n# Override session dependency\napp.dependency_overrides[dependencies.get_session] = get_session\n\n# Protected route\nsecurity = HTTPBearer()\n\n@app.get(\"/protected\")\ndef protected(credentials: HTTPAuthorizationCredentials = Depends(security)):\n    payload = decode_access_token(credentials.credentials)\n    return {\n        \"message\": \"You are authenticated\",\n        \"user_id\": payload[\"sub\"],\n    }\n</code></pre>"},{"location":"getting-started/quickstart/#step-3-configure-environment","title":"Step 3: Configure Environment","text":"<p>Create <code>.env</code>:</p> <pre><code>JWT_SECRET_KEY=your-super-secret-key-change-this\nREQUIRE_EMAIL_VERIFICATION=false\nEMAIL_PROVIDER=console\n</code></pre> <p>Generate a secure secret key:</p> <pre><code>python -c \"import secrets; print(secrets.token_urlsafe(32))\"\n</code></pre>"},{"location":"getting-started/quickstart/#step-4-run","title":"Step 4: Run","text":"<pre><code>uvicorn main:app --reload\n</code></pre> <p>Visit http://localhost:8000/docs for interactive API documentation.</p>"},{"location":"getting-started/quickstart/#try-it-out","title":"Try It Out","text":""},{"location":"getting-started/quickstart/#register-a-user","title":"Register a User","text":"<pre><code>curl -X POST \"http://localhost:8000/auth/register\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"email\": \"user@example.com\", \"password\": \"securepass123\"}'\n</code></pre>"},{"location":"getting-started/quickstart/#login","title":"Login","text":"<pre><code>curl -X POST \"http://localhost:8000/auth/login\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"email\": \"user@example.com\", \"password\": \"securepass123\"}'\n</code></pre> <p>Response includes <code>access_token</code> and <code>refresh_token</code>.</p>"},{"location":"getting-started/quickstart/#access-protected-route","title":"Access Protected Route","text":"<pre><code>curl -X GET \"http://localhost:8000/protected\" \\\n  -H \"Authorization: Bearer YOUR_ACCESS_TOKEN\"\n</code></pre>"},{"location":"getting-started/quickstart/#whats-next","title":"What's Next?","text":"<ul> <li>Core Concepts - Understand how FastAuth works</li> <li>Authentication Guide - Login, logout, tokens, password reset</li> <li>Protecting Routes - Secure your endpoints</li> <li>RBAC Guide - Roles and permissions</li> <li>OAuth Guide - Social login with Google, GitHub</li> <li>Examples - Working example projects</li> </ul>"},{"location":"guides/authentication/","title":"Authentication Guide","text":"<p>Complete guide to user authentication with FastAuth.</p>"},{"location":"guides/authentication/#setup","title":"Setup","text":"<p>Include the auth router in your app:</p> <pre><code>from fastauth.api.auth import router as auth_router\n\napp.include_router(auth_router)\n</code></pre> <p>This adds all authentication endpoints: - <code>POST /auth/register</code> - Register new user - <code>POST /auth/login</code> - Login user - <code>POST /auth/refresh</code> - Refresh access token - <code>POST /auth/logout</code> - Logout user - <code>POST /auth/password-reset/request</code> - Request password reset - <code>POST /auth/password-reset/confirm</code> - Confirm password reset - <code>POST /auth/email-verification/resend</code> - Resend verification email - <code>POST /auth/email-verification/confirm</code> - Confirm email</p>"},{"location":"guides/authentication/#registration","title":"Registration","text":""},{"location":"guides/authentication/#basic-registration","title":"Basic Registration","text":"<pre><code>curl -X POST \"http://localhost:8000/auth/register\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"email\": \"user@example.com\",\n    \"password\": \"securepassword123\"\n  }'\n</code></pre> <p>Response:</p> <pre><code>{\n  \"access_token\": \"eyJhbGc...\",\n  \"refresh_token\": \"eyJhbGc...\",\n  \"token_type\": \"bearer\"\n}\n</code></pre>"},{"location":"guides/authentication/#in-python","title":"In Python","text":"<pre><code>from fastauth.core.users import create_user\nfrom fastauth.adapters.sqlalchemy import SQLAlchemyUserAdapter\n\nuser = create_user(\n    users=SQLAlchemyUserAdapter(session),\n    email=\"user@example.com\",\n    password=\"securepassword123\",\n)\n</code></pre>"},{"location":"guides/authentication/#login","title":"Login","text":""},{"location":"guides/authentication/#basic-login","title":"Basic Login","text":"<pre><code>curl -X POST \"http://localhost:8000/auth/login\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"email\": \"user@example.com\",\n    \"password\": \"securepassword123\"\n  }'\n</code></pre> <p>Response:</p> <pre><code>{\n  \"access_token\": \"eyJhbGc...\",\n  \"refresh_token\": \"eyJhbGc...\",\n  \"token_type\": \"bearer\"\n}\n</code></pre>"},{"location":"guides/authentication/#in-python_1","title":"In Python","text":"<pre><code>from fastauth.core.users import authenticate_user\nfrom fastauth.adapters.sqlalchemy import SQLAlchemyUserAdapter\nfrom fastauth.security.jwt import create_access_token\n\nuser = authenticate_user(\n    users=SQLAlchemyUserAdapter(session),\n    email=\"user@example.com\",\n    password=\"securepassword123\",\n)\n\naccess_token = create_access_token(subject=str(user.id))\n</code></pre>"},{"location":"guides/authentication/#token-refresh","title":"Token Refresh","text":"<p>Access tokens expire after 30 minutes (configurable). Use the refresh token to get a new access token:</p> <pre><code>curl -X POST \"http://localhost:8000/auth/refresh\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"refresh_token\": \"YOUR_REFRESH_TOKEN\"\n  }'\n</code></pre> <p>Response:</p> <pre><code>{\n  \"access_token\": \"eyJhbGc...\",\n  \"refresh_token\": \"eyJhbGc...\",\n  \"token_type\": \"bearer\"\n}\n</code></pre>"},{"location":"guides/authentication/#logout","title":"Logout","text":"<p>Revoke the refresh token:</p> <pre><code>curl -X POST \"http://localhost:8000/auth/logout\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"refresh_token\": \"YOUR_REFRESH_TOKEN\"\n  }'\n</code></pre>"},{"location":"guides/authentication/#password-reset","title":"Password Reset","text":""},{"location":"guides/authentication/#step-1-request-reset","title":"Step 1: Request Reset","text":"<pre><code>curl -X POST \"http://localhost:8000/auth/password-reset/request\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"email\": \"user@example.com\"\n  }'\n</code></pre> <p>This sends a password reset email with a token.</p>"},{"location":"guides/authentication/#step-2-confirm-reset","title":"Step 2: Confirm Reset","text":"<pre><code>curl -X POST \"http://localhost:8000/auth/password-reset/confirm\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"token\": \"RESET_TOKEN_FROM_EMAIL\",\n    \"new_password\": \"newpassword456\"\n  }'\n</code></pre>"},{"location":"guides/authentication/#email-verification","title":"Email Verification","text":"<p>Enable email verification in <code>.env</code>:</p> <pre><code>REQUIRE_EMAIL_VERIFICATION=true\nEMAIL_PROVIDER=console  # or smtp\n</code></pre>"},{"location":"guides/authentication/#resend-verification-email","title":"Resend Verification Email","text":"<pre><code>curl -X POST \"http://localhost:8000/auth/email-verification/resend\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"email\": \"user@example.com\"\n  }'\n</code></pre>"},{"location":"guides/authentication/#confirm-email","title":"Confirm Email","text":"<pre><code>curl -X POST \"http://localhost:8000/auth/email-verification/confirm\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"token\": \"VERIFICATION_TOKEN_FROM_EMAIL\"\n  }'\n</code></pre>"},{"location":"guides/authentication/#error-handling","title":"Error Handling","text":"<pre><code>from fastauth.core.users import (\n    UserAlreadyExistsError,\n    InvalidCredentialsError,\n    EmailNotVerifiedError,\n)\n\ntry:\n    user = create_user(users=user_adapter, email=email, password=password)\nexcept UserAlreadyExistsError:\n    # Handle duplicate email\n    pass\n</code></pre> <p>Common errors: - <code>UserAlreadyExistsError</code> - Email already registered - <code>InvalidCredentialsError</code> - Wrong email or password - <code>EmailNotVerifiedError</code> - Email not verified (when verification required) - <code>TokenExpiredError</code> - Verification/reset token expired</p>"},{"location":"guides/authentication/#next-steps","title":"Next Steps","text":"<ul> <li>Protecting Routes - Secure your endpoints</li> <li>Sessions - Track user sessions</li> <li>Email Configuration - Configure email provider</li> </ul>"},{"location":"guides/email/","title":"Email Configuration","text":"<p>Configure email providers for verification and password reset.</p>"},{"location":"guides/email/#overview","title":"Overview","text":"<p>FastAuth supports email for: - Email verification after registration - Password reset requests - Email change confirmation</p> <p>Supported providers: - Console - Prints to console (development) - SMTP - Send via SMTP server (production)</p>"},{"location":"guides/email/#console-provider-development","title":"Console Provider (Development)","text":"<p>For development, use the console provider to see emails in your terminal:</p>"},{"location":"guides/email/#configuration","title":"Configuration","text":"<pre><code># .env\nEMAIL_PROVIDER=console\nREQUIRE_EMAIL_VERIFICATION=false  # or true to test verification flow\n</code></pre>"},{"location":"guides/email/#example-output","title":"Example Output","text":"<p>When a verification email is sent:</p> <pre><code>========================================\nEmail sent via Console Provider\n========================================\nTo: user@example.com\nSubject: Verify your email address\n\nHi user@example.com,\n\nPlease verify your email address by clicking the link below:\n\nhttp://localhost:8000/auth/email-verification/confirm?token=abc123...\n\nThis link expires in 24 hours.\n\n========================================\n</code></pre>"},{"location":"guides/email/#smtp-provider-production","title":"SMTP Provider (Production)","text":"<p>For production, configure an SMTP server to send real emails:</p>"},{"location":"guides/email/#configuration_1","title":"Configuration","text":"<pre><code># .env\nEMAIL_PROVIDER=smtp\nREQUIRE_EMAIL_VERIFICATION=true\n\n# SMTP Settings\nSMTP_HOST=smtp.gmail.com\nSMTP_PORT=587\nSMTP_USERNAME=your-email@gmail.com\nSMTP_PASSWORD=your-app-password\nSMTP_FROM_EMAIL=noreply@yourdomain.com\nSMTP_FROM_NAME=Your App Name\n\n# Email templates\nEMAIL_VERIFICATION_URL=https://yourdomain.com/verify-email?token={token}\nPASSWORD_RESET_URL=https://yourdomain.com/reset-password?token={token}\n</code></pre>"},{"location":"guides/email/#gmail-setup","title":"Gmail Setup","text":"<ol> <li>Enable 2-Factor Authentication on your Google account</li> <li>Generate an App Password:</li> <li>Go to Google Account \u2192 Security</li> <li>Click \"2-Step Verification\"</li> <li>Scroll to \"App passwords\"</li> <li>Generate password for \"Mail\"</li> <li>Use the app password in <code>SMTP_PASSWORD</code></li> </ol>"},{"location":"guides/email/#sendgrid-setup","title":"SendGrid Setup","text":"<pre><code>SMTP_HOST=smtp.sendgrid.net\nSMTP_PORT=587\nSMTP_USERNAME=apikey\nSMTP_PASSWORD=your-sendgrid-api-key\nSMTP_FROM_EMAIL=noreply@yourdomain.com\n</code></pre>"},{"location":"guides/email/#aws-ses-setup","title":"AWS SES Setup","text":"<pre><code>SMTP_HOST=email-smtp.us-east-1.amazonaws.com\nSMTP_PORT=587\nSMTP_USERNAME=your-ses-smtp-username\nSMTP_PASSWORD=your-ses-smtp-password\nSMTP_FROM_EMAIL=noreply@yourdomain.com\n</code></pre>"},{"location":"guides/email/#email-verification","title":"Email Verification","text":""},{"location":"guides/email/#enable-email-verification","title":"Enable Email Verification","text":"<pre><code># .env\nREQUIRE_EMAIL_VERIFICATION=true\nEMAIL_VERIFICATION_EXPIRE_HOURS=24\n</code></pre>"},{"location":"guides/email/#verification-flow","title":"Verification Flow","text":"<ol> <li>User registers \u2192 Unverified user created</li> <li>Verification email sent automatically</li> <li>User clicks link \u2192 Email verified</li> <li>User can now access protected routes</li> </ol>"},{"location":"guides/email/#resend-verification-email","title":"Resend Verification Email","text":"<pre><code>curl -X POST \"http://localhost:8000/auth/email-verification/resend\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"email\": \"user@example.com\"}'\n</code></pre>"},{"location":"guides/email/#verify-email","title":"Verify Email","text":"<pre><code>curl -X POST \"http://localhost:8000/auth/email-verification/confirm\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"token\": \"TOKEN_FROM_EMAIL\"}'\n</code></pre>"},{"location":"guides/email/#check-verification-status","title":"Check Verification Status","text":"<pre><code>from fastapi import Depends\nfrom fastauth.api.dependencies import get_verified_user\n\n@app.get(\"/verified-only\")\ndef verified_route(current_user: User = Depends(get_verified_user)):\n    return {\"message\": f\"Hello verified user {current_user.email}\"}\n</code></pre>"},{"location":"guides/email/#password-reset","title":"Password Reset","text":""},{"location":"guides/email/#request-password-reset","title":"Request Password Reset","text":"<pre><code>curl -X POST \"http://localhost:8000/auth/password-reset/request\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\"email\": \"user@example.com\"}'\n</code></pre> <p>User receives an email with a reset link.</p>"},{"location":"guides/email/#confirm-password-reset","title":"Confirm Password Reset","text":"<pre><code>curl -X POST \"http://localhost:8000/auth/password-reset/confirm\" \\\n  -H \"Content-Type: application/json\" \\\n  -d '{\n    \"token\": \"TOKEN_FROM_EMAIL\",\n    \"new_password\": \"newpassword456\"\n  }'\n</code></pre>"},{"location":"guides/email/#configure-reset-expiration","title":"Configure Reset Expiration","text":"<pre><code># .env\nPASSWORD_RESET_EXPIRE_HOURS=1\n</code></pre>"},{"location":"guides/email/#custom-email-templates","title":"Custom Email Templates","text":""},{"location":"guides/email/#override-email-content","title":"Override Email Content","text":"<p>Create custom email provider:</p> <pre><code>from fastauth.email.base import EmailProvider\n\nclass CustomEmailProvider(EmailProvider):\n    def send_verification_email(self, to_email: str, token: str):\n        \"\"\"Send custom verification email.\"\"\"\n        subject = \"Welcome! Verify your email\"\n        verification_url = f\"https://yourdomain.com/verify?token={token}\"\n\n        body = f\"\"\"\n        &lt;!DOCTYPE html&gt;\n        &lt;html&gt;\n        &lt;body&gt;\n            &lt;h1&gt;Welcome to Our App!&lt;/h1&gt;\n            &lt;p&gt;Click the button below to verify your email:&lt;/p&gt;\n            &lt;a href=\"{verification_url}\" style=\"background: blue; color: white; padding: 10px;\"&gt;\n                Verify Email\n            &lt;/a&gt;\n            &lt;p&gt;Or copy this link: {verification_url}&lt;/p&gt;\n        &lt;/body&gt;\n        &lt;/html&gt;\n        \"\"\"\n\n        self._send_email(to_email, subject, body, is_html=True)\n\n    def send_password_reset_email(self, to_email: str, token: str):\n        \"\"\"Send custom password reset email.\"\"\"\n        subject = \"Reset your password\"\n        reset_url = f\"https://yourdomain.com/reset?token={token}\"\n\n        body = f\"\"\"\n        &lt;!DOCTYPE html&gt;\n        &lt;html&gt;\n        &lt;body&gt;\n            &lt;h1&gt;Password Reset Request&lt;/h1&gt;\n            &lt;p&gt;Click below to reset your password:&lt;/p&gt;\n            &lt;a href=\"{reset_url}\"&gt;Reset Password&lt;/a&gt;\n            &lt;p&gt;This link expires in 1 hour.&lt;/p&gt;\n        &lt;/body&gt;\n        &lt;/html&gt;\n        \"\"\"\n\n        self._send_email(to_email, subject, body, is_html=True)\n\n    def _send_email(self, to_email: str, subject: str, body: str, is_html: bool = False):\n        \"\"\"Send email via SMTP.\"\"\"\n        # Implement SMTP sending logic\n        pass\n</code></pre>"},{"location":"guides/email/#use-custom-provider","title":"Use Custom Provider","text":"<pre><code>from fastapi import FastAPI\nfrom fastauth import Settings as FastAuthSettings\n\napp = FastAPI()\n\n# Override email provider\ncustom_provider = CustomEmailProvider()\nfastauth_settings = FastAuthSettings(\n    email_provider_instance=custom_provider\n)\n</code></pre>"},{"location":"guides/email/#frontend-integration","title":"Frontend Integration","text":""},{"location":"guides/email/#verification-page","title":"Verification Page","text":"<pre><code>// Extract token from URL\nconst urlParams = new URLSearchParams(window.location.search);\nconst token = urlParams.get('token');\n\n// Verify email\nasync function verifyEmail(token) {\n  const response = await fetch('http://localhost:8000/auth/email-verification/confirm', {\n    method: 'POST',\n    headers: { 'Content-Type': 'application/json' },\n    body: JSON.stringify({ token })\n  });\n\n  if (response.ok) {\n    alert('Email verified successfully!');\n    window.location.href = '/login';\n  } else {\n    alert('Verification failed. Token may be expired.');\n  }\n}\n\nif (token) {\n  verifyEmail(token);\n}\n</code></pre>"},{"location":"guides/email/#password-reset-page","title":"Password Reset Page","text":"<pre><code>const urlParams = new URLSearchParams(window.location.search);\nconst token = urlParams.get('token');\n\nasync function resetPassword(token, newPassword) {\n  const response = await fetch('http://localhost:8000/auth/password-reset/confirm', {\n    method: 'POST',\n    headers: { 'Content-Type': 'application/json' },\n    body: JSON.stringify({ token, new_password: newPassword })\n  });\n\n  if (response.ok) {\n    alert('Password reset successfully!');\n    window.location.href = '/login';\n  } else {\n    alert('Reset failed. Token may be expired.');\n  }\n}\n</code></pre>"},{"location":"guides/email/#testing-emails","title":"Testing Emails","text":""},{"location":"guides/email/#manual-testing","title":"Manual Testing","text":"<ol> <li>Set <code>EMAIL_PROVIDER=console</code></li> <li>Register a user</li> <li>Check terminal for verification email</li> <li>Copy token from console output</li> <li>Call verification endpoint with token</li> </ol>"},{"location":"guides/email/#automated-testing","title":"Automated Testing","text":"<pre><code>import pytest\nfrom fastauth.email.console import ConsoleEmailProvider\n\ndef test_verification_email(client):\n    # Register user\n    response = client.post(\"/auth/register\", json={\n        \"email\": \"test@example.com\",\n        \"password\": \"password123\"\n    })\n    assert response.status_code == 200\n\n    # In tests, you can capture console output or mock the email provider\n    # to verify emails are sent correctly\n</code></pre>"},{"location":"guides/email/#mock-email-provider","title":"Mock Email Provider","text":"<pre><code>class MockEmailProvider(EmailProvider):\n    def __init__(self):\n        self.sent_emails = []\n\n    def send_verification_email(self, to_email: str, token: str):\n        self.sent_emails.append({\n            \"type\": \"verification\",\n            \"to\": to_email,\n            \"token\": token\n        })\n\n    def send_password_reset_email(self, to_email: str, token: str):\n        self.sent_emails.append({\n            \"type\": \"password_reset\",\n            \"to\": to_email,\n            \"token\": token\n        })\n\n# Use in tests\nmock_provider = MockEmailProvider()\n# ... configure FastAuth to use mock_provider\n# ... assert emails were sent correctly\nassert len(mock_provider.sent_emails) == 1\nassert mock_provider.sent_emails[0][\"type\"] == \"verification\"\n</code></pre>"},{"location":"guides/email/#common-issues","title":"Common Issues","text":""},{"location":"guides/email/#email-not-sent","title":"\"Email not sent\"","text":"<p>Cause: SMTP credentials incorrect or provider blocking.</p> <p>Solution: - Verify SMTP credentials - Check spam folder - Enable \"Less secure app access\" (Gmail) - Use app-specific password</p>"},{"location":"guides/email/#token-expired","title":"\"Token expired\"","text":"<p>Cause: Verification token expired (default: 24 hours).</p> <p>Solution: Request new verification email: <pre><code>POST /auth/email-verification/resend\n</code></pre></p>"},{"location":"guides/email/#email-already-verified","title":"\"Email already verified\"","text":"<p>Cause: User already verified their email.</p> <p>Solution: This is expected behavior. User can proceed to login.</p>"},{"location":"guides/email/#environment-variables-reference","title":"Environment Variables Reference","text":"<pre><code># Email Provider\nEMAIL_PROVIDER=console  # or smtp\n\n# Email Requirements\nREQUIRE_EMAIL_VERIFICATION=false  # or true\n\n# SMTP Settings (for smtp provider)\nSMTP_HOST=smtp.gmail.com\nSMTP_PORT=587\nSMTP_USERNAME=your-email@gmail.com\nSMTP_PASSWORD=your-password\nSMTP_FROM_EMAIL=noreply@yourdomain.com\nSMTP_FROM_NAME=Your App Name\nSMTP_TLS=true\n\n# Token Expiration\nEMAIL_VERIFICATION_EXPIRE_HOURS=24\nPASSWORD_RESET_EXPIRE_HOURS=1\n\n# Frontend URLs (for email links)\nEMAIL_VERIFICATION_URL=https://yourdomain.com/verify-email?token={token}\nPASSWORD_RESET_URL=https://yourdomain.com/reset-password?token={token}\n</code></pre>"},{"location":"guides/email/#next-steps","title":"Next Steps","text":"<ul> <li>Authentication - Registration and login</li> <li>Configuration - All environment variables</li> <li>Testing - Test your email flows</li> </ul>"},{"location":"guides/oauth/","title":"OAuth Guide","text":"<p>Integrate social login with Google, GitHub, and other OAuth providers.</p>"},{"location":"guides/oauth/#overview","title":"Overview","text":"<p>FastAuth supports OAuth 2.0 authentication with PKCE for enhanced security. Users can: - Sign in with existing accounts (Google, GitHub, etc.) - Link multiple OAuth accounts to one user - Manage connected accounts</p>"},{"location":"guides/oauth/#supported-providers","title":"Supported Providers","text":"<ul> <li>Google \u2705 (with PKCE support)</li> <li>GitHub (coming soon)</li> <li>Microsoft (coming soon)</li> </ul>"},{"location":"guides/oauth/#google-oauth-setup","title":"Google OAuth Setup","text":""},{"location":"guides/oauth/#step-1-get-google-credentials","title":"Step 1: Get Google Credentials","text":"<ol> <li>Go to Google Cloud Console</li> <li>Create a new project</li> <li>Navigate to \"APIs &amp; Services\" \u2192 \"Credentials\"</li> <li>Click \"Create Credentials\" \u2192 \"OAuth 2.0 Client ID\"</li> <li>Application type: \"Web application\"</li> <li>Authorized redirect URIs:    <pre><code>http://localhost:8000/oauth/google/callback\n</code></pre></li> <li>Copy your Client ID and Client Secret</li> </ol>"},{"location":"guides/oauth/#step-2-configure-environment","title":"Step 2: Configure Environment","text":"<p>Add to <code>.env</code>:</p> <pre><code>OAUTH_GOOGLE_CLIENT_ID=your-client-id.apps.googleusercontent.com\nOAUTH_GOOGLE_CLIENT_SECRET=your-client-secret\nOAUTH_GOOGLE_REDIRECT_URI=http://localhost:8000/oauth/google/callback\n</code></pre>"},{"location":"guides/oauth/#step-3-setup-application","title":"Step 3: Setup Application","text":"<pre><code>from fastapi import FastAPI, Depends, Request\nfrom fastapi.responses import RedirectResponse\nfrom sqlmodel import Session\nfrom starlette.middleware.sessions import SessionMiddleware\n\nfrom fastauth.providers.google import GoogleOAuthProvider\nfrom fastauth.core.oauth import initiate_oauth_flow, complete_oauth_flow\nfrom fastauth.adapters.sqlalchemy import (\n    SQLAlchemyUserAdapter,\n    SQLAlchemyOAuthAccountAdapter,\n    SQLAlchemyOAuthStateAdapter,\n    SQLAlchemyRefreshTokenAdapter,\n)\nfrom fastauth.core.refresh_tokens import create_refresh_token\nfrom fastauth.security.jwt import create_access_token\n\napp = FastAPI()\n\n# Required for storing PKCE code_verifier\napp.add_middleware(\n    SessionMiddleware,\n    secret_key=\"your-secret-key\",\n)\n\n# Initialize Google provider\ngoogle_provider = GoogleOAuthProvider(\n    client_id=\"your-client-id\",\n    client_secret=\"your-client-secret\",\n)\n\n@app.get(\"/oauth/google/authorize\")\nasync def google_authorize(\n    request: Request,\n    session: Session = Depends(get_session),\n):\n    \"\"\"Initiate Google OAuth flow.\"\"\"\n    oauth_state_adapter = SQLAlchemyOAuthStateAdapter(session)\n\n    authorization_url, state_token, code_verifier = initiate_oauth_flow(\n        states=oauth_state_adapter,\n        provider=google_provider,\n        redirect_uri=\"http://localhost:8000/oauth/google/callback\",\n    )\n\n    # Store code_verifier in session for PKCE\n    request.session[\"oauth_code_verifier\"] = code_verifier\n    request.session[\"oauth_state\"] = state_token\n\n    return RedirectResponse(url=authorization_url)\n\n\n@app.get(\"/oauth/google/callback\")\nasync def google_callback(\n    request: Request,\n    code: str,\n    state: str,\n    session: Session = Depends(get_session),\n):\n    \"\"\"Handle Google OAuth callback.\"\"\"\n    user_adapter = SQLAlchemyUserAdapter(session)\n    oauth_account_adapter = SQLAlchemyOAuthAccountAdapter(session)\n    oauth_state_adapter = SQLAlchemyOAuthStateAdapter(session)\n    refresh_token_adapter = SQLAlchemyRefreshTokenAdapter(session)\n\n    code_verifier = request.session.get(\"oauth_code_verifier\")\n\n    user, is_new_user = await complete_oauth_flow(\n        states=oauth_state_adapter,\n        oauth_accounts=oauth_account_adapter,\n        users=user_adapter,\n        provider=google_provider,\n        code=code,\n        state=state,\n        code_verifier=code_verifier,\n    )\n\n    # Clean up session\n    request.session.pop(\"oauth_code_verifier\", None)\n    request.session.pop(\"oauth_state\", None)\n\n    # Generate tokens\n    access_token = create_access_token(subject=str(user.id))\n    refresh_token = create_refresh_token(\n        refresh_tokens=refresh_token_adapter,\n        user_id=user.id,\n    )\n\n    return {\n        \"access_token\": access_token,\n        \"refresh_token\": refresh_token,\n        \"is_new_user\": is_new_user,\n    }\n</code></pre>"},{"location":"guides/oauth/#step-4-test","title":"Step 4: Test","text":"<ol> <li>Start your app: <code>uvicorn main:app --reload</code></li> <li>Visit <code>http://localhost:8000/oauth/google/authorize</code></li> <li>Complete Google sign-in</li> <li>You'll be redirected with tokens</li> </ol>"},{"location":"guides/oauth/#oauth-flow","title":"OAuth Flow","text":"<pre><code>1. User \u2192 GET /oauth/google/authorize\n   \u2193\n2. Backend generates state &amp; PKCE verifier\n   Backend stores state in DB, verifier in session\n   Backend returns Google authorization URL\n   \u2193\n3. User redirected to Google consent screen\n   \u2193\n4. User approves access\n   \u2193\n5. Google \u2192 GET /oauth/google/callback?code=...&amp;state=...\n   \u2193\n6. Backend validates state\n   Backend exchanges code + verifier for access token\n   Backend fetches user info from Google\n   Backend creates/links user account\n   \u2193\n7. Backend returns JWT tokens\n</code></pre>"},{"location":"guides/oauth/#managing-oauth-accounts","title":"Managing OAuth Accounts","text":""},{"location":"guides/oauth/#list-linked-accounts","title":"List Linked Accounts","text":"<pre><code>from fastauth.core.oauth import get_linked_accounts\n\n@app.get(\"/oauth-accounts\")\ndef list_oauth_accounts(\n    current_user: User = Depends(get_current_user),\n    session: Session = Depends(get_session),\n):\n    oauth_account_adapter = SQLAlchemyOAuthAccountAdapter(session)\n    accounts = get_linked_accounts(\n        oauth_accounts=oauth_account_adapter,\n        user_id=current_user.id,\n    )\n    return {\"accounts\": accounts}\n</code></pre>"},{"location":"guides/oauth/#unlink-account","title":"Unlink Account","text":"<pre><code>from fastauth.core.oauth import unlink_oauth_account\n\n@app.delete(\"/oauth-accounts/{account_id}\")\ndef unlink_account(\n    account_id: str,\n    current_user: User = Depends(get_current_user),\n    session: Session = Depends(get_session),\n):\n    oauth_account_adapter = SQLAlchemyOAuthAccountAdapter(session)\n\n    unlink_oauth_account(\n        oauth_accounts=oauth_account_adapter,\n        user_id=current_user.id,\n        account_id=account_id,\n    )\n\n    return {\"message\": \"Account unlinked\"}\n</code></pre>"},{"location":"guides/oauth/#security-pkce","title":"Security: PKCE","text":"<p>FastAuth uses PKCE (Proof Key for Code Exchange) for enhanced security:</p> <ol> <li>Code Verifier: Random string stored in session</li> <li>Code Challenge: SHA-256 hash of verifier, sent to OAuth provider</li> <li>Validation: Provider validates challenge when exchanging code for token</li> </ol> <p>This prevents authorization code interception attacks.</p>"},{"location":"guides/oauth/#frontend-integration","title":"Frontend Integration","text":""},{"location":"guides/oauth/#react-example","title":"React Example","text":"<pre><code>// Trigger OAuth flow\nconst handleGoogleLogin = () =&gt; {\n  window.location.href = 'http://localhost:8000/oauth/google/authorize';\n};\n\n// Handle callback (on redirect page)\nuseEffect(() =&gt; {\n  const params = new URLSearchParams(window.location.search);\n  const accessToken = params.get('access_token');\n  const refreshToken = params.get('refresh_token');\n\n  if (accessToken) {\n    localStorage.setItem('access_token', accessToken);\n    localStorage.setItem('refresh_token', refreshToken);\n    // Redirect to dashboard\n  }\n}, []);\n</code></pre>"},{"location":"guides/oauth/#production-considerations","title":"Production Considerations","text":""},{"location":"guides/oauth/#redirect-uri","title":"Redirect URI","text":"<p>Update your <code>.env</code> for production:</p> <pre><code>OAUTH_GOOGLE_REDIRECT_URI=https://yourdomain.com/oauth/google/callback\n</code></pre> <p>Add to Google Cloud Console authorized redirect URIs: <pre><code>https://yourdomain.com/oauth/google/callback\n</code></pre></p>"},{"location":"guides/oauth/#session-security","title":"Session Security","text":"<p>Use a strong secret key:</p> <pre><code>import secrets\n\napp.add_middleware(\n    SessionMiddleware,\n    secret_key=secrets.token_urlsafe(32),  # Generate and store securely\n    https_only=True,  # Production only\n    same_site=\"lax\",\n)\n</code></pre>"},{"location":"guides/oauth/#error-handling","title":"Error Handling","text":"<pre><code>from fastapi import HTTPException\n\n@app.get(\"/oauth/google/callback\")\nasync def google_callback(code: str, state: str, session: Session):\n    try:\n        user, is_new = await complete_oauth_flow(...)\n        return {\"access_token\": ..., \"refresh_token\": ...}\n    except ValueError as e:\n        raise HTTPException(status_code=400, detail=str(e))\n    except Exception as e:\n        raise HTTPException(status_code=500, detail=\"OAuth flow failed\")\n</code></pre>"},{"location":"guides/oauth/#common-issues","title":"Common Issues","text":""},{"location":"guides/oauth/#invalid-redirect_uri","title":"\"Invalid redirect_uri\"","text":"<p>Cause: Redirect URI mismatch between code and Google Console.</p> <p>Solution: Ensure <code>.env</code> redirect URI matches Google Console exactly.</p>"},{"location":"guides/oauth/#missing-code_verifier","title":"\"Missing code_verifier\"","text":"<p>Cause: Session lost between authorize and callback.</p> <p>Solution: Ensure <code>SessionMiddleware</code> is configured and cookies are enabled.</p>"},{"location":"guides/oauth/#state-token-not-found","title":"\"State token not found\"","text":"<p>Cause: State token expired or database issue.</p> <p>Solution: Check <code>OAUTH_STATE_EXPIRE_MINUTES</code> setting (default: 10 minutes).</p>"},{"location":"guides/oauth/#complete-example","title":"Complete Example","text":"<p>See the OAuth Google Example for a full working implementation with: - Google OAuth integration - PKCE flow - Account linking/unlinking - HTML templates - Complete setup instructions</p>"},{"location":"guides/oauth/#next-steps","title":"Next Steps","text":"<ul> <li>Authentication - Traditional email/password auth</li> <li>Sessions - Track user sessions</li> <li>OAuth Example - Complete working example</li> </ul>"},{"location":"guides/protecting-routes/","title":"Protecting Routes","text":"<p>Secure your FastAPI endpoints with authentication.</p>"},{"location":"guides/protecting-routes/#using-http-bearer","title":"Using HTTP Bearer","text":"<p>The simplest way to protect routes:</p> <pre><code>from fastapi import Depends, FastAPI\nfrom fastapi.security import HTTPAuthorizationCredentials, HTTPBearer\n\nfrom fastauth.security.jwt import decode_access_token\n\napp = FastAPI()\nsecurity = HTTPBearer()\n\n@app.get(\"/protected\")\ndef protected_route(credentials: HTTPAuthorizationCredentials = Depends(security)):\n    payload = decode_access_token(credentials.credentials)\n    user_id = payload[\"sub\"]\n    return {\"message\": f\"Hello user {user_id}\"}\n</code></pre>"},{"location":"guides/protecting-routes/#making-requests","title":"Making Requests","text":"<pre><code>curl -X GET \"http://localhost:8000/protected\" \\\n  -H \"Authorization: Bearer YOUR_ACCESS_TOKEN\"\n</code></pre>"},{"location":"guides/protecting-routes/#using-get_current_user","title":"Using get_current_user","text":"<p>Get the full user object:</p> <pre><code>from fastapi import Depends\nfrom fastauth.api.dependencies import get_current_user\nfrom fastauth.adapters.sqlalchemy.models import User\n\n@app.get(\"/profile\")\ndef get_profile(current_user: User = Depends(get_current_user)):\n    return {\n        \"id\": str(current_user.id),\n        \"email\": current_user.email,\n        \"is_verified\": current_user.is_verified,\n    }\n</code></pre>"},{"location":"guides/protecting-routes/#optional-authentication","title":"Optional Authentication","text":"<p>Make authentication optional:</p> <pre><code>from typing import Optional\nfrom fastauth.api.dependencies import get_current_user_optional\n\n@app.get(\"/posts\")\ndef list_posts(current_user: Optional[User] = Depends(get_current_user_optional)):\n    if current_user:\n        # Show personalized content\n        return {\"posts\": [...], \"user_id\": str(current_user.id)}\n    else:\n        # Show public content\n        return {\"posts\": [...]}\n</code></pre>"},{"location":"guides/protecting-routes/#require-email-verification","title":"Require Email Verification","text":"<p>Ensure user has verified their email:</p> <pre><code>from fastauth.api.dependencies import get_verified_user\n\n@app.get(\"/verified-only\")\ndef verified_route(current_user: User = Depends(get_verified_user)):\n    return {\"message\": f\"Hello verified user {current_user.email}\"}\n</code></pre>"},{"location":"guides/protecting-routes/#custom-dependency","title":"Custom Dependency","text":"<p>Create your own authentication dependency:</p> <pre><code>from fastapi import Depends, HTTPException\nfrom fastapi.security import HTTPBearer\nfrom fastauth.security.jwt import decode_access_token\nfrom fastauth.adapters.sqlalchemy import SQLAlchemyUserAdapter\n\nsecurity = HTTPBearer()\n\ndef get_active_user(\n    credentials: HTTPAuthorizationCredentials = Depends(security),\n    session: Session = Depends(get_session),\n):\n    payload = decode_access_token(credentials.credentials)\n    user_id = payload[\"sub\"]\n\n    user_adapter = SQLAlchemyUserAdapter(session)\n    user = user_adapter.get_by_id(user_id)\n\n    if not user or not user.is_active:\n        raise HTTPException(status_code=403, detail=\"User is inactive\")\n\n    return user\n\n@app.get(\"/active-only\")\ndef active_route(user: User = Depends(get_active_user)):\n    return {\"message\": f\"Hello {user.email}\"}\n</code></pre>"},{"location":"guides/protecting-routes/#protecting-all-routes","title":"Protecting All Routes","text":"<p>Apply authentication globally:</p> <pre><code>from fastapi import FastAPI, Depends\nfrom fastauth.api.dependencies import get_current_user\n\napp = FastAPI(dependencies=[Depends(get_current_user)])\n\n# All routes now require authentication\n@app.get(\"/route1\")\ndef route1():\n    return {\"message\": \"Protected\"}\n\n@app.get(\"/route2\")\ndef route2():\n    return {\"message\": \"Also protected\"}\n</code></pre> <p>Exclude specific routes:</p> <pre><code>from fastapi import FastAPI, Depends, Request\nfrom fastauth.api.dependencies import get_current_user\n\napp = FastAPI()\n\nPUBLIC_ROUTES = {\"/\", \"/health\", \"/docs\", \"/openapi.json\"}\n\n@app.middleware(\"http\")\nasync def require_auth_middleware(request: Request, call_next):\n    if request.url.path not in PUBLIC_ROUTES:\n        # Require authentication\n        credentials = await security(request)\n        decode_access_token(credentials.credentials)\n\n    response = await call_next(request)\n    return response\n</code></pre>"},{"location":"guides/protecting-routes/#error-handling","title":"Error Handling","text":"<p>Handle authentication errors:</p> <pre><code>from fastapi import FastAPI, Request, status\nfrom fastapi.responses import JSONResponse\nfrom jose.exceptions import JWTError\n\napp = FastAPI()\n\n@app.exception_handler(JWTError)\nasync def jwt_exception_handler(request: Request, exc: JWTError):\n    return JSONResponse(\n        status_code=status.HTTP_401_UNAUTHORIZED,\n        content={\"detail\": \"Invalid or expired token\"},\n    )\n</code></pre>"},{"location":"guides/protecting-routes/#testing-protected-routes","title":"Testing Protected Routes","text":""},{"location":"guides/protecting-routes/#with-pytest","title":"With pytest","text":"<pre><code>def test_protected_route_without_token(client):\n    response = client.get(\"/protected\")\n    assert response.status_code == 403\n\ndef test_protected_route_with_token(client, access_token):\n    headers = {\"Authorization\": f\"Bearer {access_token}\"}\n    response = client.get(\"/protected\", headers=headers)\n    assert response.status_code == 200\n</code></pre>"},{"location":"guides/protecting-routes/#create-test-token","title":"Create Test Token","text":"<pre><code>from fastauth.security.jwt import create_access_token\n\ndef get_test_token(user_id: str) -&gt; str:\n    return create_access_token(subject=user_id)\n</code></pre>"},{"location":"guides/protecting-routes/#next-steps","title":"Next Steps","text":"<ul> <li>RBAC Guide - Role-based access control</li> <li>Sessions - Track and manage user sessions</li> <li>Authentication - Login and registration</li> </ul>"},{"location":"guides/rbac/","title":"Role-Based Access Control (RBAC)","text":"<p>Implement fine-grained access control with roles and permissions.</p>"},{"location":"guides/rbac/#overview","title":"Overview","text":"<p>FastAuth provides built-in RBAC with: - Roles: Groups of permissions (e.g., \"admin\", \"editor\", \"viewer\") - Permissions: Specific actions (e.g., \"create:post\", \"delete:user\") - User-Role Assignment: Assign roles to users - Role-Permission Assignment: Assign permissions to roles</p>"},{"location":"guides/rbac/#setup","title":"Setup","text":""},{"location":"guides/rbac/#step-1-create-permissions","title":"Step 1: Create Permissions","text":"<pre><code>from sqlmodel import Session\nfrom fastauth.adapters.sqlalchemy import SQLAlchemyRoleAdapter\nfrom fastauth.core.roles import create_permission\n\nwith Session(engine) as session:\n    role_adapter = SQLAlchemyRoleAdapter(session)\n\n    create_permission(\n        roles=role_adapter,\n        name=\"create_post\",\n        description=\"Create new blog posts\",\n    )\n\n    create_permission(\n        roles=role_adapter,\n        name=\"delete_post\",\n        description=\"Delete blog posts\",\n    )\n\n    session.commit()\n</code></pre>"},{"location":"guides/rbac/#step-2-create-roles","title":"Step 2: Create Roles","text":"<pre><code>from fastauth.core.roles import create_role\n\nwith Session(engine) as session:\n    role_adapter = SQLAlchemyRoleAdapter(session)\n\n    create_role(\n        roles=role_adapter,\n        name=\"editor\",\n        description=\"Can create and edit posts\",\n    )\n\n    create_role(\n        roles=role_adapter,\n        name=\"admin\",\n        description=\"Full access to all features\",\n    )\n\n    session.commit()\n</code></pre>"},{"location":"guides/rbac/#step-3-assign-permissions-to-roles","title":"Step 3: Assign Permissions to Roles","text":"<pre><code>from fastauth.core.roles import assign_permission_to_role\n\nwith Session(engine) as session:\n    role_adapter = SQLAlchemyRoleAdapter(session)\n\n    # Editor can create and edit\n    assign_permission_to_role(\n        roles=role_adapter,\n        role_name=\"editor\",\n        permission_name=\"create_post\",\n    )\n\n    # Admin can create, edit, and delete\n    assign_permission_to_role(\n        roles=role_adapter,\n        role_name=\"admin\",\n        permission_name=\"create_post\",\n    )\n\n    assign_permission_to_role(\n        roles=role_adapter,\n        role_name=\"admin\",\n        permission_name=\"delete_post\",\n    )\n\n    session.commit()\n</code></pre>"},{"location":"guides/rbac/#step-4-assign-roles-to-users","title":"Step 4: Assign Roles to Users","text":"<pre><code>from fastauth.core.roles import assign_role\n\nwith Session(engine) as session:\n    role_adapter = SQLAlchemyRoleAdapter(session)\n\n    assign_role(\n        roles=role_adapter,\n        user_id=user.id,\n        role_name=\"editor\",\n    )\n\n    session.commit()\n</code></pre>"},{"location":"guides/rbac/#protecting-routes","title":"Protecting Routes","text":""},{"location":"guides/rbac/#require-specific-role","title":"Require Specific Role","text":"<pre><code>from fastapi import Depends\nfrom fastauth.api.dependencies import require_role\n\n@app.get(\"/admin/dashboard\", dependencies=[Depends(require_role(\"admin\"))])\ndef admin_dashboard():\n    return {\"message\": \"Admin dashboard\"}\n</code></pre>"},{"location":"guides/rbac/#require-specific-permission","title":"Require Specific Permission","text":"<pre><code>from fastauth.api.dependencies import require_permission\n\n@app.delete(\"/posts/{post_id}\", dependencies=[Depends(require_permission(\"delete_post\"))])\ndef delete_post(post_id: str):\n    return {\"message\": f\"Post {post_id} deleted\"}\n</code></pre>"},{"location":"guides/rbac/#multiple-permissions-and","title":"Multiple Permissions (AND)","text":"<pre><code>from fastapi import Depends\n\n@app.post(\n    \"/posts/{post_id}/publish\",\n    dependencies=[\n        Depends(require_permission(\"edit_post\")),\n        Depends(require_permission(\"publish_post\")),\n    ],\n)\ndef publish_post(post_id: str):\n    return {\"message\": f\"Post {post_id} published\"}\n</code></pre>"},{"location":"guides/rbac/#check-permissions-manually","title":"Check Permissions Manually","text":"<pre><code>from fastapi import Depends, HTTPException\nfrom fastauth.api.dependencies import get_current_user\nfrom fastauth.core.roles import check_permission\nfrom fastauth.adapters.sqlalchemy import SQLAlchemyRoleAdapter\n\n@app.post(\"/posts\")\ndef create_post(\n    current_user: User = Depends(get_current_user),\n    session: Session = Depends(get_session),\n):\n    role_adapter = SQLAlchemyRoleAdapter(session)\n\n    can_create = check_permission(\n        roles=role_adapter,\n        user_id=current_user.id,\n        permission_name=\"create_post\",\n    )\n\n    if not can_create:\n        raise HTTPException(\n            status_code=403,\n            detail=\"You don't have permission to create posts\",\n        )\n\n    # Create post logic\n    return {\"message\": \"Post created\"}\n</code></pre>"},{"location":"guides/rbac/#checking-user-roles-and-permissions","title":"Checking User Roles and Permissions","text":""},{"location":"guides/rbac/#get-user-roles","title":"Get User Roles","text":"<pre><code>from fastauth.core.roles import get_user_roles\n\nwith Session(engine) as session:\n    role_adapter = SQLAlchemyRoleAdapter(session)\n\n    user_roles = get_user_roles(\n        roles=role_adapter,\n        user_id=user.id,\n    )\n\n    role_names = [role.name for role in user_roles]\n    # ['editor', 'viewer']\n</code></pre>"},{"location":"guides/rbac/#get-user-permissions","title":"Get User Permissions","text":"<pre><code>from fastauth.core.roles import get_user_permissions\n\nwith Session(engine) as session:\n    role_adapter = SQLAlchemyRoleAdapter(session)\n\n    user_permissions = get_user_permissions(\n        roles=role_adapter,\n        user_id=user.id,\n    )\n\n    permission_names = [perm.name for perm in user_permissions]\n    # ['create_post', 'edit_post']\n</code></pre>"},{"location":"guides/rbac/#removing-roles-and-permissions","title":"Removing Roles and Permissions","text":""},{"location":"guides/rbac/#remove-role-from-user","title":"Remove Role from User","text":"<pre><code>from fastauth.core.roles import unassign_role\n\nwith Session(engine) as session:\n    role_adapter = SQLAlchemyRoleAdapter(session)\n\n    unassign_role(\n        roles=role_adapter,\n        user_id=user.id,\n        role_name=\"editor\",\n    )\n\n    session.commit()\n</code></pre>"},{"location":"guides/rbac/#remove-permission-from-role","title":"Remove Permission from Role","text":"<pre><code>from fastauth.core.roles import unassign_permission_from_role\n\nwith Session(engine) as session:\n    role_adapter = SQLAlchemyRoleAdapter(session)\n\n    unassign_permission_from_role(\n        roles=role_adapter,\n        role_name=\"editor\",\n        permission_name=\"delete_post\",\n    )\n\n    session.commit()\n</code></pre>"},{"location":"guides/rbac/#example-blog-with-rbac","title":"Example: Blog with RBAC","text":"<p>Complete example with three roles:</p> <pre><code>from fastapi import FastAPI, Depends\nfrom sqlmodel import Session\nfrom fastauth.adapters.sqlalchemy import SQLAlchemyRoleAdapter\nfrom fastauth.api.dependencies import require_permission, get_current_user\nfrom fastauth.core.roles import (\n    create_permission,\n    create_role,\n    assign_permission_to_role,\n)\n\napp = FastAPI()\n\n@app.on_event(\"startup\")\ndef setup_rbac():\n    with Session(engine) as session:\n        role_adapter = SQLAlchemyRoleAdapter(session)\n\n        # Create permissions\n        permissions = [\n            (\"create_post\", \"Create posts\"),\n            (\"edit_post\", \"Edit posts\"),\n            (\"publish_post\", \"Publish posts\"),\n            (\"delete_post\", \"Delete posts\"),\n        ]\n\n        for name, desc in permissions:\n            create_permission(roles=role_adapter, name=name, description=desc)\n\n        # Create roles\n        create_role(roles=role_adapter, name=\"viewer\", description=\"View only\")\n        create_role(roles=role_adapter, name=\"editor\", description=\"Create and edit\")\n        create_role(roles=role_adapter, name=\"admin\", description=\"Full access\")\n\n        # Assign permissions to roles\n        # Editor: create and edit\n        assign_permission_to_role(role_adapter, \"editor\", \"create_post\")\n        assign_permission_to_role(role_adapter, \"editor\", \"edit_post\")\n\n        # Admin: all permissions\n        for perm in [\"create_post\", \"edit_post\", \"publish_post\", \"delete_post\"]:\n            assign_permission_to_role(role_adapter, \"admin\", perm)\n\n        session.commit()\n\n# Routes\n@app.get(\"/posts\")\ndef list_posts(current_user: User = Depends(get_current_user)):\n    # All authenticated users can view\n    return {\"posts\": [...]}\n\n@app.post(\"/posts\", dependencies=[Depends(require_permission(\"create_post\"))])\ndef create_post():\n    # Only editors and admins\n    return {\"message\": \"Post created\"}\n\n@app.delete(\"/posts/{id}\", dependencies=[Depends(require_permission(\"delete_post\"))])\ndef delete_post(id: str):\n    # Only admins\n    return {\"message\": f\"Post {id} deleted\"}\n</code></pre>"},{"location":"guides/rbac/#best-practices","title":"Best Practices","text":""},{"location":"guides/rbac/#permission-naming","title":"Permission Naming","text":"<p>Use consistent naming conventions:</p> <pre><code># Resource-based\n\"create:post\"\n\"read:post\"\n\"update:post\"\n\"delete:post\"\n\n# Or action-based\n\"post.create\"\n\"post.read\"\n\"post.update\"\n\"post.delete\"\n</code></pre>"},{"location":"guides/rbac/#default-roles","title":"Default Roles","text":"<p>Assign a default role to new users:</p> <pre><code>from fastauth.core.users import create_user\nfrom fastauth.core.roles import assign_role\n\nuser = create_user(users=user_adapter, email=email, password=password)\n\n# Assign default \"viewer\" role\nassign_role(roles=role_adapter, user_id=user.id, role_name=\"viewer\")\nsession.commit()\n</code></pre>"},{"location":"guides/rbac/#hierarchical-roles","title":"Hierarchical Roles","text":"<p>Implement role hierarchy by assigning permissions:</p> <pre><code># Basic role\nassign_permission_to_role(role_adapter, \"user\", \"read:own_profile\")\n\n# Moderator inherits user permissions + more\nassign_permission_to_role(role_adapter, \"moderator\", \"read:own_profile\")\nassign_permission_to_role(role_adapter, \"moderator\", \"moderate:posts\")\n\n# Admin gets all permissions\nassign_permission_to_role(role_adapter, \"admin\", \"read:own_profile\")\nassign_permission_to_role(role_adapter, \"admin\", \"moderate:posts\")\nassign_permission_to_role(role_adapter, \"admin\", \"delete:users\")\n</code></pre>"},{"location":"guides/rbac/#complete-example","title":"Complete Example","text":"<p>See the RBAC Blog Example for a full working implementation with: - Three roles (viewer, editor, admin) - Four permissions (create, edit, publish, delete) - Protected routes - Seed script for setup</p>"},{"location":"guides/rbac/#next-steps","title":"Next Steps","text":"<ul> <li>Authentication - User registration and login</li> <li>Protecting Routes - Secure endpoints</li> <li>RBAC Blog Example - Complete working example</li> </ul>"},{"location":"guides/sessions/","title":"Session Management","text":"<p>Track and manage user sessions across multiple devices.</p>"},{"location":"guides/sessions/#overview","title":"Overview","text":"<p>FastAuth provides session management to: - Track user logins across multiple devices - Monitor session activity (IP, device, last active) - Allow users to revoke specific sessions - Sign out from all devices remotely</p>"},{"location":"guides/sessions/#basic-setup","title":"Basic Setup","text":""},{"location":"guides/sessions/#step-1-include-session-router","title":"Step 1: Include Session Router","text":"<pre><code>from fastapi import FastAPI\nfrom fastauth.api.sessions import router as sessions_router\n\napp = FastAPI()\napp.include_router(sessions_router)\n</code></pre> <p>This adds session management endpoints: - <code>GET /sessions</code> - List all active sessions - <code>DELETE /sessions/{session_id}</code> - Revoke specific session - <code>DELETE /sessions/all</code> - Revoke all sessions</p>"},{"location":"guides/sessions/#step-2-create-sessions-on-login","title":"Step 2: Create Sessions on Login","text":"<p>Sessions are automatically created when using the built-in auth router. For custom login:</p> <pre><code>from fastapi import Depends, Request\nfrom fastauth.core.sessions import create_session\nfrom fastauth.adapters.sqlalchemy import SQLAlchemySessionAdapter, SQLAlchemyUserAdapter\nfrom fastauth.security.jwt import create_access_token\n\n@app.post(\"/login\")\ndef login(\n    request: Request,\n    email: str,\n    password: str,\n    session: Session = Depends(get_session),\n):\n    user_adapter = SQLAlchemyUserAdapter(session)\n    session_adapter = SQLAlchemySessionAdapter(session)\n\n    # Authenticate user\n    user = authenticate_user(users=user_adapter, email=email, password=password)\n\n    # Create session with device info\n    user_session = create_session(\n        sessions=session_adapter,\n        users=user_adapter,\n        user_id=user.id,\n        ip_address=request.client.host if request.client else None,\n        user_agent=request.headers.get(\"user-agent\"),\n        device=\"Web Browser\",  # Can parse from user-agent\n    )\n\n    # Include session_id in token\n    access_token = create_access_token(\n        subject=str(user.id),\n        extra_claims={\"session_id\": str(user_session.id)},\n    )\n\n    return {\"access_token\": access_token}\n</code></pre>"},{"location":"guides/sessions/#session-operations","title":"Session Operations","text":""},{"location":"guides/sessions/#list-active-sessions","title":"List Active Sessions","text":"<pre><code>from fastauth.core.sessions import get_user_sessions\n\n@app.get(\"/sessions\")\ndef list_sessions(\n    current_user: User = Depends(get_current_user),\n    session: Session = Depends(get_session),\n):\n    session_adapter = SQLAlchemySessionAdapter(session)\n\n    user_sessions = get_user_sessions(\n        sessions=session_adapter,\n        user_id=current_user.id,\n    )\n\n    return {\n        \"sessions\": [\n            {\n                \"id\": str(s.id),\n                \"device\": s.device,\n                \"ip_address\": s.ip_address,\n                \"last_active\": s.last_active,\n                \"created_at\": s.created_at,\n            }\n            for s in user_sessions\n        ]\n    }\n</code></pre>"},{"location":"guides/sessions/#revoke-specific-session","title":"Revoke Specific Session","text":"<pre><code>from fastauth.core.sessions import delete_session\n\n@app.delete(\"/sessions/{session_id}\")\ndef revoke_session(\n    session_id: str,\n    current_user: User = Depends(get_current_user),\n    session: Session = Depends(get_session),\n):\n    session_adapter = SQLAlchemySessionAdapter(session)\n\n    delete_session(\n        sessions=session_adapter,\n        session_id=uuid.UUID(session_id),\n        user_id=current_user.id,\n    )\n\n    return {\"message\": \"Session revoked\"}\n</code></pre>"},{"location":"guides/sessions/#revoke-all-sessions","title":"Revoke All Sessions","text":"<pre><code>from fastauth.core.sessions import delete_all_user_sessions\n\n@app.post(\"/sessions/revoke-all\")\ndef revoke_all_sessions(\n    keep_current: bool = True,\n    current_user: User = Depends(get_current_user),\n    session: Session = Depends(get_session),\n):\n    session_adapter = SQLAlchemySessionAdapter(session)\n\n    # Get current session ID from token if keeping current\n    current_session_id = None\n    if keep_current:\n        # Extract from JWT token claims\n        current_session_id = get_current_session_id()  # Implement this\n\n    delete_all_user_sessions(\n        sessions=session_adapter,\n        user_id=current_user.id,\n        except_session_id=current_session_id,\n    )\n\n    return {\"message\": \"All other sessions revoked\"}\n</code></pre>"},{"location":"guides/sessions/#device-tracking","title":"Device Tracking","text":"<p>Parse user agent to get device information:</p> <pre><code>def parse_user_agent(user_agent: str) -&gt; str:\n    \"\"\"Parse user agent string to get device type.\"\"\"\n    if not user_agent:\n        return \"Unknown Device\"\n\n    ua_lower = user_agent.lower()\n\n    # Mobile devices\n    if \"mobile\" in ua_lower or \"android\" in ua_lower:\n        if \"android\" in ua_lower:\n            return \"Android Device\"\n        if \"iphone\" in ua_lower:\n            return \"iPhone\"\n        if \"ipad\" in ua_lower:\n            return \"iPad\"\n        return \"Mobile Device\"\n\n    # Desktop browsers\n    if \"chrome\" in ua_lower:\n        return \"Chrome Browser\"\n    if \"firefox\" in ua_lower:\n        return \"Firefox Browser\"\n    if \"safari\" in ua_lower:\n        return \"Safari Browser\"\n    if \"edge\" in ua_lower:\n        return \"Edge Browser\"\n\n    return \"Web Browser\"\n\n@app.post(\"/login\")\ndef login(request: Request, ...):\n    device = parse_user_agent(request.headers.get(\"user-agent\"))\n\n    user_session = create_session(\n        sessions=session_adapter,\n        users=user_adapter,\n        user_id=user.id,\n        device=device,\n        ip_address=request.client.host,\n        user_agent=request.headers.get(\"user-agent\"),\n    )\n    ...\n</code></pre>"},{"location":"guides/sessions/#session-metadata","title":"Session Metadata","text":"<p>Session objects include:</p> <pre><code>class Session:\n    id: UUID\n    user_id: UUID\n    device: str              # \"Chrome Browser\", \"iPhone\", etc.\n    ip_address: str          # \"192.168.1.1\"\n    user_agent: str          # Full user agent string\n    last_active: datetime    # Auto-updated\n    created_at: datetime     # Session creation time\n</code></pre>"},{"location":"guides/sessions/#frontend-integration","title":"Frontend Integration","text":""},{"location":"guides/sessions/#list-sessions-ui","title":"List Sessions UI","text":"<pre><code>// Fetch active sessions\nasync function fetchSessions() {\n  const response = await fetch('http://localhost:8000/sessions', {\n    headers: {\n      'Authorization': `Bearer ${accessToken}`\n    }\n  });\n  const data = await response.json();\n  return data.sessions;\n}\n\n// Display sessions\nsessions.forEach(session =&gt; {\n  console.log(`${session.device} - Last active: ${session.last_active}`);\n});\n</code></pre>"},{"location":"guides/sessions/#revoke-session","title":"Revoke Session","text":"<pre><code>async function revokeSession(sessionId) {\n  await fetch(`http://localhost:8000/sessions/${sessionId}`, {\n    method: 'DELETE',\n    headers: {\n      'Authorization': `Bearer ${accessToken}`\n    }\n  });\n}\n</code></pre>"},{"location":"guides/sessions/#sign-out-all-devices","title":"Sign Out All Devices","text":"<pre><code>async function signOutAllDevices() {\n  await fetch('http://localhost:8000/sessions/revoke-all', {\n    method: 'POST',\n    headers: {\n      'Authorization': `Bearer ${accessToken}`,\n      'Content-Type': 'application/json'\n    },\n    body: JSON.stringify({ keep_current: true })\n  });\n}\n</code></pre>"},{"location":"guides/sessions/#using-built-in-session-router","title":"Using Built-in Session Router","text":"<p>The easiest way to add session management:</p> <pre><code>from fastapi import FastAPI\nfrom fastauth.api.sessions import router as sessions_router\nfrom fastauth.api.auth import router as auth_router\n\napp = FastAPI()\n\n# Sessions are automatically created on login\napp.include_router(auth_router)\napp.include_router(sessions_router)\n</code></pre> <p>Built-in endpoints: - <code>GET /sessions</code> - List user's active sessions - <code>DELETE /sessions/{session_id}</code> - Revoke specific session - <code>DELETE /sessions/all</code> - Revoke all sessions (keeps current by default)</p>"},{"location":"guides/sessions/#session-security","title":"Session Security","text":""},{"location":"guides/sessions/#update-last-active","title":"Update Last Active","text":"<p>Sessions should track last activity:</p> <pre><code>from fastauth.core.sessions import update_session_last_active\n\n@app.middleware(\"http\")\nasync def update_session_activity(request: Request, call_next):\n    # Extract session_id from JWT token\n    session_id = get_session_id_from_request(request)\n\n    if session_id:\n        with Session(engine) as session:\n            session_adapter = SQLAlchemySessionAdapter(session)\n            update_session_last_active(\n                sessions=session_adapter,\n                session_id=session_id,\n            )\n\n    response = await call_next(request)\n    return response\n</code></pre>"},{"location":"guides/sessions/#session-expiration","title":"Session Expiration","text":"<p>Configure session lifetime:</p> <pre><code># .env\nSESSION_EXPIRE_DAYS=30\n</code></pre> <p>Clean up expired sessions periodically:</p> <pre><code>from datetime import datetime, timedelta\n\ndef cleanup_expired_sessions():\n    \"\"\"Remove sessions older than 30 days.\"\"\"\n    with Session(engine) as session:\n        session_adapter = SQLAlchemySessionAdapter(session)\n        cutoff = datetime.utcnow() - timedelta(days=30)\n\n        # Implement in adapter\n        session_adapter.delete_inactive_since(cutoff)\n</code></pre>"},{"location":"guides/sessions/#example-session-dashboard","title":"Example: Session Dashboard","text":"<pre><code>@app.get(\"/me/sessions\")\ndef get_session_dashboard(\n    request: Request,\n    current_user: User = Depends(get_current_user),\n    session: Session = Depends(get_session),\n):\n    session_adapter = SQLAlchemySessionAdapter(session)\n    user_sessions = get_user_sessions(\n        sessions=session_adapter,\n        user_id=current_user.id,\n    )\n\n    # Get current session ID from token\n    current_session_id = get_session_id_from_token(\n        request.headers.get(\"authorization\", \"\").replace(\"Bearer \", \"\")\n    )\n\n    sessions_data = []\n    for s in user_sessions:\n        sessions_data.append({\n            \"id\": str(s.id),\n            \"device\": s.device,\n            \"ip_address\": s.ip_address,\n            \"location\": get_location_from_ip(s.ip_address),  # Optional\n            \"last_active\": s.last_active,\n            \"is_current\": s.id == current_session_id,\n        })\n\n    # Sort by last active\n    sessions_data.sort(key=lambda x: x[\"last_active\"], reverse=True)\n\n    return {\n        \"total_sessions\": len(sessions_data),\n        \"sessions\": sessions_data,\n    }\n</code></pre>"},{"location":"guides/sessions/#complete-example","title":"Complete Example","text":"<p>See the Session Devices Example for a full implementation with: - Session creation on login/register - Device detection from user agent - Session listing with current session indicator - Individual and bulk session revocation - HTML/JavaScript frontend</p>"},{"location":"guides/sessions/#next-steps","title":"Next Steps","text":"<ul> <li>Authentication - User login and registration</li> <li>Protecting Routes - Secure endpoints</li> <li>Session Example - Complete working example</li> </ul>"},{"location":"reference/","title":"API Reference","text":"<p>Welcome to the FastAuth API reference documentation. This section provides detailed documentation for all FastAuth modules, classes, and functions.</p>"},{"location":"reference/#core-modules","title":"Core Modules","text":"<p>The core modules provide the main authentication and authorization functionality:</p> <ul> <li>Users: User management and authentication</li> <li>OAuth: OAuth 2.0 provider integration</li> <li>Sessions: Session management</li> <li>Roles: Role-based access control</li> <li>Account: Account management (email changes, password changes)</li> <li>Email Verification: Email verification functionality</li> <li>Password Reset: Password reset functionality</li> <li>Refresh Tokens: JWT refresh token management</li> <li>Hashing: Password hashing utilities</li> </ul>"},{"location":"reference/#adapters","title":"Adapters","text":"<p>Adapters provide database integration:</p>"},{"location":"reference/#base-adapters","title":"Base Adapters","text":"<p>Abstract base classes for implementing custom database adapters.</p>"},{"location":"reference/#sqlalchemy-adapters","title":"SQLAlchemy Adapters","text":"<p>Pre-built SQLAlchemy implementations of all adapters.</p>"},{"location":"reference/#api-routes","title":"API Routes","text":"<p>FastAPI router implementations for authentication endpoints:</p> <ul> <li>Auth Routes: Registration, login, logout</li> <li>OAuth Routes: OAuth provider authentication</li> <li>Account Routes: Account management</li> <li>Session Routes: Session management</li> </ul>"},{"location":"reference/#security","title":"Security","text":"<p>Security utilities and middleware:</p> <ul> <li>JWT: JSON Web Token generation and validation</li> <li>OAuth Security: OAuth-specific security utilities</li> <li>Rate Limiting: Rate limiting middleware</li> <li>Email Verification Security: Email verification token management</li> <li>Password Reset Security: Password reset token management</li> <li>Refresh Token Security: Refresh token validation</li> </ul>"},{"location":"reference/#email","title":"Email","text":"<p>Email sending capabilities:</p> <ul> <li>Base Email: Abstract email provider interface</li> <li>Console Provider: Development email provider (prints to console)</li> <li>SMTP Provider: Production SMTP email provider</li> <li>Email Factory: Factory for creating email providers</li> </ul>"},{"location":"reference/#oauth-providers","title":"OAuth Providers","text":"<p>OAuth provider implementations:</p> <ul> <li>Base Provider: Abstract OAuth provider interface</li> <li>Google: Google OAuth provider</li> </ul>"},{"location":"reference/#settings","title":"Settings","text":"<p>Configuration management for FastAuth.</p>"},{"location":"reference/settings/","title":"Settings","text":""},{"location":"reference/settings/#fastauth.settings","title":"settings","text":""},{"location":"reference/adapters/base/email_change/","title":"Email Change","text":""},{"location":"reference/adapters/base/email_change/#fastauth.adapters.base.email_change","title":"email_change","text":""},{"location":"reference/adapters/base/email_change/#fastauth.adapters.base.email_change-classes","title":"Classes","text":""},{"location":"reference/adapters/base/email_change/#fastauth.adapters.base.email_change.EmailChangeAdapter","title":"EmailChangeAdapter","text":"<p>             Bases: <code>ABC</code></p> <p>Abstract base class for email change token database operations.</p>"},{"location":"reference/adapters/base/email_change/#fastauth.adapters.base.email_change.EmailChangeAdapter-functions","title":"Functions","text":""},{"location":"reference/adapters/base/email_change/#fastauth.adapters.base.email_change.EmailChangeAdapter.create","title":"create  <code>abstractmethod</code>","text":"<pre><code>create(\n    *, user_id: UUID, new_email: str, token_hash: str, expires_at: datetime\n) -&gt; Any\n</code></pre> <p>Create an email change request with a token.</p> <p>Parameters:</p> Name Type Description Default <code>user_id</code> <code>UUID</code> <p>User's unique identifier</p> required <code>new_email</code> <code>str</code> <p>The new email address to change to</p> required <code>token_hash</code> <code>str</code> <p>Hashed verification token</p> required <code>expires_at</code> <code>datetime</code> <p>Token expiration datetime</p> required Source code in <code>fastauth/adapters/base/email_change.py</code> <pre><code>@abstractmethod\ndef create(\n    self,\n    *,\n    user_id: uuid.UUID,\n    new_email: str,\n    token_hash: str,\n    expires_at: datetime,\n) -&gt; Any:\n    \"\"\"\n    Create an email change request with a token.\n\n    Args:\n        user_id: User's unique identifier\n        new_email: The new email address to change to\n        token_hash: Hashed verification token\n        expires_at: Token expiration datetime\n    \"\"\"\n    ...\n</code></pre>"},{"location":"reference/adapters/base/email_change/#fastauth.adapters.base.email_change.EmailChangeAdapter.get_valid","title":"get_valid  <code>abstractmethod</code>","text":"<pre><code>get_valid(*, token_hash: str) -&gt; Any\n</code></pre> <p>Get a valid (not used) email change record by token hash.</p> <p>Parameters:</p> Name Type Description Default <code>token_hash</code> <code>str</code> <p>Hashed token to look up</p> required <p>Returns:</p> Type Description <code>Any</code> <p>EmailChange record if found and not used, None otherwise</p> Source code in <code>fastauth/adapters/base/email_change.py</code> <pre><code>@abstractmethod\ndef get_valid(self, *, token_hash: str) -&gt; Any:\n    \"\"\"\n    Get a valid (not used) email change record by token hash.\n\n    Args:\n        token_hash: Hashed token to look up\n\n    Returns:\n        EmailChange record if found and not used, None otherwise\n    \"\"\"\n    ...\n</code></pre>"},{"location":"reference/adapters/base/email_change/#fastauth.adapters.base.email_change.EmailChangeAdapter.mark_used","title":"mark_used  <code>abstractmethod</code>","text":"<pre><code>mark_used(*, token_hash: str) -&gt; None\n</code></pre> <p>Mark an email change token as used.</p> <p>Parameters:</p> Name Type Description Default <code>token_hash</code> <code>str</code> <p>Hashed token to mark as used</p> required Source code in <code>fastauth/adapters/base/email_change.py</code> <pre><code>@abstractmethod\ndef mark_used(self, *, token_hash: str) -&gt; None:\n    \"\"\"\n    Mark an email change token as used.\n\n    Args:\n        token_hash: Hashed token to mark as used\n    \"\"\"\n    ...\n</code></pre>"},{"location":"reference/adapters/base/email_verification/","title":"Email Verification","text":""},{"location":"reference/adapters/base/email_verification/#fastauth.adapters.base.email_verification","title":"email_verification","text":""},{"location":"reference/adapters/base/oauth_accounts/","title":"Oauth Accounts","text":""},{"location":"reference/adapters/base/oauth_accounts/#fastauth.adapters.base.oauth_accounts","title":"oauth_accounts","text":""},{"location":"reference/adapters/base/oauth_accounts/#fastauth.adapters.base.oauth_accounts-classes","title":"Classes","text":""},{"location":"reference/adapters/base/oauth_accounts/#fastauth.adapters.base.oauth_accounts.OAuthAccountAdapter","title":"OAuthAccountAdapter","text":"<p>             Bases: <code>ABC</code></p> <p>Abstract base class for OAuth account database operations.</p> <p>Implementations must provide database-specific logic for OAuth account management. The core business logic remains database-agnostic.</p>"},{"location":"reference/adapters/base/oauth_accounts/#fastauth.adapters.base.oauth_accounts.OAuthAccountAdapter-functions","title":"Functions","text":""},{"location":"reference/adapters/base/oauth_accounts/#fastauth.adapters.base.oauth_accounts.OAuthAccountAdapter.create","title":"create  <code>abstractmethod</code>","text":"<pre><code>create(\n    *,\n    user_id: UUID,\n    provider: str,\n    provider_user_id: str,\n    access_token_hash: str,\n    refresh_token_hash: str | None = None,\n    expires_at: datetime | None = None,\n    email: str | None = None,\n    name: str | None = None,\n    avatar_url: str | None = None\n) -&gt; Any\n</code></pre> <p>Create a new OAuth account link.</p> <p>Parameters:</p> Name Type Description Default <code>user_id</code> <code>UUID</code> <p>Internal user ID</p> required <code>provider</code> <code>str</code> <p>OAuth provider name (google, github, etc.)</p> required <code>provider_user_id</code> <code>str</code> <p>User ID from OAuth provider</p> required <code>access_token_hash</code> <code>str</code> <p>Hashed OAuth access token</p> required <code>refresh_token_hash</code> <code>str | None</code> <p>Optional hashed OAuth refresh token</p> <code>None</code> <code>expires_at</code> <code>datetime | None</code> <p>Token expiration time</p> <code>None</code> <code>email</code> <code>str | None</code> <p>Email from provider (for reference)</p> <code>None</code> <code>name</code> <code>str | None</code> <p>Display name from provider</p> <code>None</code> <code>avatar_url</code> <code>str | None</code> <p>Profile picture URL</p> <code>None</code> <p>Returns:</p> Type Description <code>Any</code> <p>Created OAuth account object</p> Source code in <code>fastauth/adapters/base/oauth_accounts.py</code> <pre><code>@abstractmethod\ndef create(\n    self,\n    *,\n    user_id: uuid.UUID,\n    provider: str,\n    provider_user_id: str,\n    access_token_hash: str,\n    refresh_token_hash: str | None = None,\n    expires_at: datetime | None = None,\n    email: str | None = None,\n    name: str | None = None,\n    avatar_url: str | None = None,\n) -&gt; Any:\n    \"\"\"\n    Create a new OAuth account link.\n\n    Args:\n        user_id: Internal user ID\n        provider: OAuth provider name (google, github, etc.)\n        provider_user_id: User ID from OAuth provider\n        access_token_hash: Hashed OAuth access token\n        refresh_token_hash: Optional hashed OAuth refresh token\n        expires_at: Token expiration time\n        email: Email from provider (for reference)\n        name: Display name from provider\n        avatar_url: Profile picture URL\n\n    Returns:\n        Created OAuth account object\n    \"\"\"\n    ...\n</code></pre>"},{"location":"reference/adapters/base/oauth_accounts/#fastauth.adapters.base.oauth_accounts.OAuthAccountAdapter.get_by_provider_user_id","title":"get_by_provider_user_id  <code>abstractmethod</code>","text":"<pre><code>get_by_provider_user_id(*, provider: str, provider_user_id: str) -&gt; Any\n</code></pre> <p>Get OAuth account by provider and provider user ID.</p> <p>Parameters:</p> Name Type Description Default <code>provider</code> <code>str</code> <p>OAuth provider name</p> required <code>provider_user_id</code> <code>str</code> <p>User ID from OAuth provider</p> required <p>Returns:</p> Type Description <code>Any</code> <p>OAuth account if found, None otherwise</p> Source code in <code>fastauth/adapters/base/oauth_accounts.py</code> <pre><code>@abstractmethod\ndef get_by_provider_user_id(self, *, provider: str, provider_user_id: str) -&gt; Any:\n    \"\"\"\n    Get OAuth account by provider and provider user ID.\n\n    Args:\n        provider: OAuth provider name\n        provider_user_id: User ID from OAuth provider\n\n    Returns:\n        OAuth account if found, None otherwise\n    \"\"\"\n    ...\n</code></pre>"},{"location":"reference/adapters/base/oauth_accounts/#fastauth.adapters.base.oauth_accounts.OAuthAccountAdapter.get_by_user_id","title":"get_by_user_id  <code>abstractmethod</code>","text":"<pre><code>get_by_user_id(*, user_id: UUID, provider: str | None = None) -&gt; list[Any]\n</code></pre> <p>Get OAuth accounts for a user, optionally filtered by provider.</p> <p>Parameters:</p> Name Type Description Default <code>user_id</code> <code>UUID</code> <p>User's unique identifier</p> required <code>provider</code> <code>str | None</code> <p>Optional provider name to filter by</p> <code>None</code> <p>Returns:</p> Type Description <code>list[Any]</code> <p>List of OAuth account objects</p> Source code in <code>fastauth/adapters/base/oauth_accounts.py</code> <pre><code>@abstractmethod\ndef get_by_user_id(\n    self, *, user_id: uuid.UUID, provider: str | None = None\n) -&gt; list[Any]:\n    \"\"\"\n    Get OAuth accounts for a user, optionally filtered by provider.\n\n    Args:\n        user_id: User's unique identifier\n        provider: Optional provider name to filter by\n\n    Returns:\n        List of OAuth account objects\n    \"\"\"\n    ...\n</code></pre>"},{"location":"reference/adapters/base/oauth_accounts/#fastauth.adapters.base.oauth_accounts.OAuthAccountAdapter.update_tokens","title":"update_tokens  <code>abstractmethod</code>","text":"<pre><code>update_tokens(\n    *,\n    account_id: UUID,\n    access_token_hash: str,\n    refresh_token_hash: str | None = None,\n    expires_at: datetime | None = None\n) -&gt; None\n</code></pre> <p>Update OAuth tokens for an account.</p> <p>Parameters:</p> Name Type Description Default <code>account_id</code> <code>UUID</code> <p>OAuth account ID</p> required <code>access_token_hash</code> <code>str</code> <p>New hashed access token</p> required <code>refresh_token_hash</code> <code>str | None</code> <p>New hashed refresh token (if applicable)</p> <code>None</code> <code>expires_at</code> <code>datetime | None</code> <p>New expiration time</p> <code>None</code> Source code in <code>fastauth/adapters/base/oauth_accounts.py</code> <pre><code>@abstractmethod\ndef update_tokens(\n    self,\n    *,\n    account_id: uuid.UUID,\n    access_token_hash: str,\n    refresh_token_hash: str | None = None,\n    expires_at: datetime | None = None,\n) -&gt; None:\n    \"\"\"\n    Update OAuth tokens for an account.\n\n    Args:\n        account_id: OAuth account ID\n        access_token_hash: New hashed access token\n        refresh_token_hash: New hashed refresh token (if applicable)\n        expires_at: New expiration time\n    \"\"\"\n    ...\n</code></pre>"},{"location":"reference/adapters/base/oauth_accounts/#fastauth.adapters.base.oauth_accounts.OAuthAccountAdapter.delete","title":"delete  <code>abstractmethod</code>","text":"<pre><code>delete(*, account_id: UUID) -&gt; None\n</code></pre> <p>Remove OAuth account link.</p> <p>Parameters:</p> Name Type Description Default <code>account_id</code> <code>UUID</code> <p>OAuth account ID to delete</p> required Source code in <code>fastauth/adapters/base/oauth_accounts.py</code> <pre><code>@abstractmethod\ndef delete(self, *, account_id: uuid.UUID) -&gt; None:\n    \"\"\"\n    Remove OAuth account link.\n\n    Args:\n        account_id: OAuth account ID to delete\n    \"\"\"\n    ...\n</code></pre>"},{"location":"reference/adapters/base/oauth_states/","title":"Oauth States","text":""},{"location":"reference/adapters/base/oauth_states/#fastauth.adapters.base.oauth_states","title":"oauth_states","text":""},{"location":"reference/adapters/base/oauth_states/#fastauth.adapters.base.oauth_states-classes","title":"Classes","text":""},{"location":"reference/adapters/base/oauth_states/#fastauth.adapters.base.oauth_states.OAuthStateAdapter","title":"OAuthStateAdapter","text":"<p>             Bases: <code>ABC</code></p> <p>Abstract base class for OAuth state token operations.</p> <p>State tokens prevent CSRF attacks in OAuth flows.</p>"},{"location":"reference/adapters/base/oauth_states/#fastauth.adapters.base.oauth_states.OAuthStateAdapter-functions","title":"Functions","text":""},{"location":"reference/adapters/base/oauth_states/#fastauth.adapters.base.oauth_states.OAuthStateAdapter.create","title":"create  <code>abstractmethod</code>","text":"<pre><code>create(\n    *,\n    state_hash: str,\n    provider: str,\n    redirect_uri: str,\n    code_challenge: str | None = None,\n    code_challenge_method: str | None = None,\n    user_id: UUID | None = None,\n    expires_at: datetime\n) -&gt; Any\n</code></pre> <p>Create a new OAuth state token.</p> <p>Parameters:</p> Name Type Description Default <code>state_hash</code> <code>str</code> <p>Hashed state token</p> required <code>provider</code> <code>str</code> <p>OAuth provider name</p> required <code>redirect_uri</code> <code>str</code> <p>Callback URL after OAuth</p> required <code>code_challenge</code> <code>str | None</code> <p>Optional PKCE code challenge</p> <code>None</code> <code>code_challenge_method</code> <code>str | None</code> <p>PKCE challenge method (e.g., 'S256')</p> <code>None</code> <code>user_id</code> <code>UUID | None</code> <p>Optional user ID for linking existing account</p> <code>None</code> <code>expires_at</code> <code>datetime</code> <p>State token expiration datetime</p> required <p>Returns:</p> Type Description <code>Any</code> <p>Created OAuth state object</p> Source code in <code>fastauth/adapters/base/oauth_states.py</code> <pre><code>@abstractmethod\ndef create(\n    self,\n    *,\n    state_hash: str,\n    provider: str,\n    redirect_uri: str,\n    code_challenge: str | None = None,\n    code_challenge_method: str | None = None,\n    user_id: uuid.UUID | None = None,\n    expires_at: datetime,\n) -&gt; Any:\n    \"\"\"\n    Create a new OAuth state token.\n\n    Args:\n        state_hash: Hashed state token\n        provider: OAuth provider name\n        redirect_uri: Callback URL after OAuth\n        code_challenge: Optional PKCE code challenge\n        code_challenge_method: PKCE challenge method (e.g., 'S256')\n        user_id: Optional user ID for linking existing account\n        expires_at: State token expiration datetime\n\n    Returns:\n        Created OAuth state object\n    \"\"\"\n    ...\n</code></pre>"},{"location":"reference/adapters/base/oauth_states/#fastauth.adapters.base.oauth_states.OAuthStateAdapter.get_valid","title":"get_valid  <code>abstractmethod</code>","text":"<pre><code>get_valid(*, state_hash: str) -&gt; Any\n</code></pre> <p>Get a valid (unused, non-expired) state token.</p> <p>Parameters:</p> Name Type Description Default <code>state_hash</code> <code>str</code> <p>Hashed state token to look up</p> required <p>Returns:</p> Type Description <code>Any</code> <p>OAuth state record if found and not used, None otherwise</p> Source code in <code>fastauth/adapters/base/oauth_states.py</code> <pre><code>@abstractmethod\ndef get_valid(self, *, state_hash: str) -&gt; Any:\n    \"\"\"\n    Get a valid (unused, non-expired) state token.\n\n    Args:\n        state_hash: Hashed state token to look up\n\n    Returns:\n        OAuth state record if found and not used, None otherwise\n    \"\"\"\n    ...\n</code></pre>"},{"location":"reference/adapters/base/oauth_states/#fastauth.adapters.base.oauth_states.OAuthStateAdapter.mark_used","title":"mark_used  <code>abstractmethod</code>","text":"<pre><code>mark_used(*, state_hash: str) -&gt; None\n</code></pre> <p>Mark a state token as used (one-time use).</p> <p>Parameters:</p> Name Type Description Default <code>state_hash</code> <code>str</code> <p>Hashed state token to mark as used</p> required Source code in <code>fastauth/adapters/base/oauth_states.py</code> <pre><code>@abstractmethod\ndef mark_used(self, *, state_hash: str) -&gt; None:\n    \"\"\"\n    Mark a state token as used (one-time use).\n\n    Args:\n        state_hash: Hashed state token to mark as used\n    \"\"\"\n    ...\n</code></pre>"},{"location":"reference/adapters/base/oauth_states/#fastauth.adapters.base.oauth_states.OAuthStateAdapter.cleanup_expired","title":"cleanup_expired  <code>abstractmethod</code>","text":"<pre><code>cleanup_expired() -&gt; None\n</code></pre> <p>Remove expired state tokens from database.</p> <p>This can be called periodically to clean up old state tokens.</p> Source code in <code>fastauth/adapters/base/oauth_states.py</code> <pre><code>@abstractmethod\ndef cleanup_expired(self) -&gt; None:\n    \"\"\"\n    Remove expired state tokens from database.\n\n    This can be called periodically to clean up old state tokens.\n    \"\"\"\n    ...\n</code></pre>"},{"location":"reference/adapters/base/password_reset/","title":"Password Reset","text":""},{"location":"reference/adapters/base/password_reset/#fastauth.adapters.base.password_reset","title":"password_reset","text":""},{"location":"reference/adapters/base/refresh_tokens/","title":"Refresh Tokens","text":""},{"location":"reference/adapters/base/refresh_tokens/#fastauth.adapters.base.refresh_tokens","title":"refresh_tokens","text":""},{"location":"reference/adapters/base/roles/","title":"Roles","text":""},{"location":"reference/adapters/base/roles/#fastauth.adapters.base.roles","title":"roles","text":""},{"location":"reference/adapters/base/roles/#fastauth.adapters.base.roles-classes","title":"Classes","text":""},{"location":"reference/adapters/base/roles/#fastauth.adapters.base.roles.RoleAdapter","title":"RoleAdapter","text":"<p>             Bases: <code>ABC</code></p> <p>Abstract base class for role and permission database operations.</p> <p>Implementations must provide database-specific logic for RBAC. The core business logic remains database-agnostic.</p>"},{"location":"reference/adapters/base/roles/#fastauth.adapters.base.roles.RoleAdapter-functions","title":"Functions","text":""},{"location":"reference/adapters/base/roles/#fastauth.adapters.base.roles.RoleAdapter.create_role","title":"create_role  <code>abstractmethod</code>","text":"<pre><code>create_role(*, name: str, description: str | None = None) -&gt; Any\n</code></pre> <p>Create a new role.</p> <p>Parameters:</p> Name Type Description Default <code>name</code> <code>str</code> <p>Unique role name</p> required <code>description</code> <code>str | None</code> <p>Optional role description</p> <code>None</code> <p>Returns:</p> Type Description <code>Any</code> <p>Created role object</p> Source code in <code>fastauth/adapters/base/roles.py</code> <pre><code>@abstractmethod\ndef create_role(self, *, name: str, description: str | None = None) -&gt; Any:\n    \"\"\"\n    Create a new role.\n\n    Args:\n        name: Unique role name\n        description: Optional role description\n\n    Returns:\n        Created role object\n    \"\"\"\n    ...\n</code></pre>"},{"location":"reference/adapters/base/roles/#fastauth.adapters.base.roles.RoleAdapter.get_role_by_name","title":"get_role_by_name  <code>abstractmethod</code>","text":"<pre><code>get_role_by_name(name: str) -&gt; Any\n</code></pre> <p>Retrieve a role by name.</p> <p>Parameters:</p> Name Type Description Default <code>name</code> <code>str</code> <p>Role name</p> required <p>Returns:</p> Type Description <code>Any</code> <p>Role object if found, None otherwise</p> Source code in <code>fastauth/adapters/base/roles.py</code> <pre><code>@abstractmethod\ndef get_role_by_name(self, name: str) -&gt; Any:\n    \"\"\"\n    Retrieve a role by name.\n\n    Args:\n        name: Role name\n\n    Returns:\n        Role object if found, None otherwise\n    \"\"\"\n    ...\n</code></pre>"},{"location":"reference/adapters/base/roles/#fastauth.adapters.base.roles.RoleAdapter.create_permission","title":"create_permission  <code>abstractmethod</code>","text":"<pre><code>create_permission(*, name: str, description: str | None = None) -&gt; Any\n</code></pre> <p>Create a new permission.</p> <p>Parameters:</p> Name Type Description Default <code>name</code> <code>str</code> <p>Unique permission name</p> required <code>description</code> <code>str | None</code> <p>Optional permission description</p> <code>None</code> <p>Returns:</p> Type Description <code>Any</code> <p>Created permission object</p> Source code in <code>fastauth/adapters/base/roles.py</code> <pre><code>@abstractmethod\ndef create_permission(self, *, name: str, description: str | None = None) -&gt; Any:\n    \"\"\"\n    Create a new permission.\n\n    Args:\n        name: Unique permission name\n        description: Optional permission description\n\n    Returns:\n        Created permission object\n    \"\"\"\n    ...\n</code></pre>"},{"location":"reference/adapters/base/roles/#fastauth.adapters.base.roles.RoleAdapter.get_permission_by_name","title":"get_permission_by_name  <code>abstractmethod</code>","text":"<pre><code>get_permission_by_name(name: str) -&gt; Any\n</code></pre> <p>Retrieve a permission by name.</p> <p>Parameters:</p> Name Type Description Default <code>name</code> <code>str</code> <p>Permission name</p> required <p>Returns:</p> Type Description <code>Any</code> <p>Permission object if found, None otherwise</p> Source code in <code>fastauth/adapters/base/roles.py</code> <pre><code>@abstractmethod\ndef get_permission_by_name(self, name: str) -&gt; Any:\n    \"\"\"\n    Retrieve a permission by name.\n\n    Args:\n        name: Permission name\n\n    Returns:\n        Permission object if found, None otherwise\n    \"\"\"\n    ...\n</code></pre>"},{"location":"reference/adapters/base/roles/#fastauth.adapters.base.roles.RoleAdapter.assign_role_to_user","title":"assign_role_to_user  <code>abstractmethod</code>","text":"<pre><code>assign_role_to_user(*, user_id: UUID, role_id: UUID) -&gt; None\n</code></pre> <p>Assign a role to a user.</p> <p>Parameters:</p> Name Type Description Default <code>user_id</code> <code>UUID</code> <p>User's unique identifier</p> required <code>role_id</code> <code>UUID</code> <p>Role's unique identifier</p> required Source code in <code>fastauth/adapters/base/roles.py</code> <pre><code>@abstractmethod\ndef assign_role_to_user(self, *, user_id: uuid.UUID, role_id: uuid.UUID) -&gt; None:\n    \"\"\"\n    Assign a role to a user.\n\n    Args:\n        user_id: User's unique identifier\n        role_id: Role's unique identifier\n    \"\"\"\n    ...\n</code></pre>"},{"location":"reference/adapters/base/roles/#fastauth.adapters.base.roles.RoleAdapter.remove_role_from_user","title":"remove_role_from_user  <code>abstractmethod</code>","text":"<pre><code>remove_role_from_user(*, user_id: UUID, role_id: UUID) -&gt; None\n</code></pre> <p>Remove a role from a user.</p> <p>Parameters:</p> Name Type Description Default <code>user_id</code> <code>UUID</code> <p>User's unique identifier</p> required <code>role_id</code> <code>UUID</code> <p>Role's unique identifier</p> required Source code in <code>fastauth/adapters/base/roles.py</code> <pre><code>@abstractmethod\ndef remove_role_from_user(self, *, user_id: uuid.UUID, role_id: uuid.UUID) -&gt; None:\n    \"\"\"\n    Remove a role from a user.\n\n    Args:\n        user_id: User's unique identifier\n        role_id: Role's unique identifier\n    \"\"\"\n    ...\n</code></pre>"},{"location":"reference/adapters/base/roles/#fastauth.adapters.base.roles.RoleAdapter.get_user_roles","title":"get_user_roles  <code>abstractmethod</code>","text":"<pre><code>get_user_roles(user_id: UUID) -&gt; list[Any]\n</code></pre> <p>Get all roles assigned to a user.</p> <p>Parameters:</p> Name Type Description Default <code>user_id</code> <code>UUID</code> <p>User's unique identifier</p> required <p>Returns:</p> Type Description <code>list[Any]</code> <p>List of role objects</p> Source code in <code>fastauth/adapters/base/roles.py</code> <pre><code>@abstractmethod\ndef get_user_roles(self, user_id: uuid.UUID) -&gt; list[Any]:\n    \"\"\"\n    Get all roles assigned to a user.\n\n    Args:\n        user_id: User's unique identifier\n\n    Returns:\n        List of role objects\n    \"\"\"\n    ...\n</code></pre>"},{"location":"reference/adapters/base/roles/#fastauth.adapters.base.roles.RoleAdapter.assign_permission_to_role","title":"assign_permission_to_role  <code>abstractmethod</code>","text":"<pre><code>assign_permission_to_role(*, role_id: UUID, permission_id: UUID) -&gt; None\n</code></pre> <p>Assign a permission to a role.</p> <p>Parameters:</p> Name Type Description Default <code>role_id</code> <code>UUID</code> <p>Role's unique identifier</p> required <code>permission_id</code> <code>UUID</code> <p>Permission's unique identifier</p> required Source code in <code>fastauth/adapters/base/roles.py</code> <pre><code>@abstractmethod\ndef assign_permission_to_role(\n    self, *, role_id: uuid.UUID, permission_id: uuid.UUID\n) -&gt; None:\n    \"\"\"\n    Assign a permission to a role.\n\n    Args:\n        role_id: Role's unique identifier\n        permission_id: Permission's unique identifier\n    \"\"\"\n    ...\n</code></pre>"},{"location":"reference/adapters/base/roles/#fastauth.adapters.base.roles.RoleAdapter.get_role_permissions","title":"get_role_permissions  <code>abstractmethod</code>","text":"<pre><code>get_role_permissions(role_id: UUID) -&gt; list[Any]\n</code></pre> <p>Get all permissions assigned to a role.</p> <p>Parameters:</p> Name Type Description Default <code>role_id</code> <code>UUID</code> <p>Role's unique identifier</p> required <p>Returns:</p> Type Description <code>list[Any]</code> <p>List of permission objects</p> Source code in <code>fastauth/adapters/base/roles.py</code> <pre><code>@abstractmethod\ndef get_role_permissions(self, role_id: uuid.UUID) -&gt; list[Any]:\n    \"\"\"\n    Get all permissions assigned to a role.\n\n    Args:\n        role_id: Role's unique identifier\n\n    Returns:\n        List of permission objects\n    \"\"\"\n    ...\n</code></pre>"},{"location":"reference/adapters/base/roles/#fastauth.adapters.base.roles.RoleAdapter.get_user_permissions","title":"get_user_permissions  <code>abstractmethod</code>","text":"<pre><code>get_user_permissions(user_id: UUID) -&gt; list[Any]\n</code></pre> <p>Get all permissions for a user (from all their roles).</p> <p>Parameters:</p> Name Type Description Default <code>user_id</code> <code>UUID</code> <p>User's unique identifier</p> required <p>Returns:</p> Type Description <code>list[Any]</code> <p>List of permission objects</p> Source code in <code>fastauth/adapters/base/roles.py</code> <pre><code>@abstractmethod\ndef get_user_permissions(self, user_id: uuid.UUID) -&gt; list[Any]:\n    \"\"\"\n    Get all permissions for a user (from all their roles).\n\n    Args:\n        user_id: User's unique identifier\n\n    Returns:\n        List of permission objects\n    \"\"\"\n    ...\n</code></pre>"},{"location":"reference/adapters/base/sessions/","title":"Sessions","text":""},{"location":"reference/adapters/base/sessions/#fastauth.adapters.base.sessions","title":"sessions","text":""},{"location":"reference/adapters/base/users/","title":"Users","text":""},{"location":"reference/adapters/base/users/#fastauth.adapters.base.users","title":"users","text":""},{"location":"reference/adapters/base/users/#fastauth.adapters.base.users-classes","title":"Classes","text":""},{"location":"reference/adapters/base/users/#fastauth.adapters.base.users.UserAdapter","title":"UserAdapter","text":"<p>             Bases: <code>ABC</code></p> <p>Abstract base class for user database operations.</p> <p>Implementations must provide database-specific logic for user management. The core business logic remains database-agnostic.</p>"},{"location":"reference/adapters/base/users/#fastauth.adapters.base.users.UserAdapter-functions","title":"Functions","text":""},{"location":"reference/adapters/base/users/#fastauth.adapters.base.users.UserAdapter.get_by_email","title":"get_by_email  <code>abstractmethod</code>","text":"<pre><code>get_by_email(email: str) -&gt; Any\n</code></pre> <p>Retrieve a user by email address.</p> <p>Parameters:</p> Name Type Description Default <code>email</code> <code>str</code> <p>User's email address</p> required <p>Returns:</p> Type Description <code>Any</code> <p>User object if found, None otherwise</p> Source code in <code>fastauth/adapters/base/users.py</code> <pre><code>@abstractmethod\ndef get_by_email(self, email: str) -&gt; Any:\n    \"\"\"\n    Retrieve a user by email address.\n\n    Args:\n        email: User's email address\n\n    Returns:\n        User object if found, None otherwise\n    \"\"\"\n    ...\n</code></pre>"},{"location":"reference/adapters/base/users/#fastauth.adapters.base.users.UserAdapter.get_by_id","title":"get_by_id  <code>abstractmethod</code>","text":"<pre><code>get_by_id(user_id: UUID) -&gt; Any\n</code></pre> <p>Retrieve a user by ID.</p> <p>Parameters:</p> Name Type Description Default <code>user_id</code> <code>UUID</code> <p>User's unique identifier</p> required <p>Returns:</p> Type Description <code>Any</code> <p>User object if found, None otherwise</p> Source code in <code>fastauth/adapters/base/users.py</code> <pre><code>@abstractmethod\ndef get_by_id(self, user_id: uuid.UUID) -&gt; Any:\n    \"\"\"\n    Retrieve a user by ID.\n\n    Args:\n        user_id: User's unique identifier\n\n    Returns:\n        User object if found, None otherwise\n    \"\"\"\n    ...\n</code></pre>"},{"location":"reference/adapters/base/users/#fastauth.adapters.base.users.UserAdapter.create_user","title":"create_user  <code>abstractmethod</code>","text":"<pre><code>create_user(*, email: str, hashed_password: str) -&gt; Any\n</code></pre> <p>Create a new user.</p> <p>Parameters:</p> Name Type Description Default <code>email</code> <code>str</code> <p>User's email address</p> required <code>hashed_password</code> <code>str</code> <p>Already hashed password</p> required <p>Returns:</p> Type Description <code>Any</code> <p>Created user object</p> Source code in <code>fastauth/adapters/base/users.py</code> <pre><code>@abstractmethod\ndef create_user(self, *, email: str, hashed_password: str) -&gt; Any:\n    \"\"\"\n    Create a new user.\n\n    Args:\n        email: User's email address\n        hashed_password: Already hashed password\n\n    Returns:\n        Created user object\n    \"\"\"\n    ...\n</code></pre>"},{"location":"reference/adapters/base/users/#fastauth.adapters.base.users.UserAdapter.mark_verified","title":"mark_verified  <code>abstractmethod</code>","text":"<pre><code>mark_verified(user_id: UUID) -&gt; None\n</code></pre> <p>Mark a user's email as verified.</p> <p>Parameters:</p> Name Type Description Default <code>user_id</code> <code>UUID</code> <p>User's unique identifier</p> required Source code in <code>fastauth/adapters/base/users.py</code> <pre><code>@abstractmethod\ndef mark_verified(self, user_id: uuid.UUID) -&gt; None:\n    \"\"\"\n    Mark a user's email as verified.\n\n    Args:\n        user_id: User's unique identifier\n    \"\"\"\n    ...\n</code></pre>"},{"location":"reference/adapters/base/users/#fastauth.adapters.base.users.UserAdapter.set_password","title":"set_password  <code>abstractmethod</code>","text":"<pre><code>set_password(*, user_id: UUID, hashed_password: str) -&gt; None\n</code></pre> <p>Update user's password.</p> <p>Parameters:</p> Name Type Description Default <code>user_id</code> <code>UUID</code> <p>User's unique identifier</p> required <code>hashed_password</code> <code>str</code> <p>Already hashed password</p> required Source code in <code>fastauth/adapters/base/users.py</code> <pre><code>@abstractmethod\ndef set_password(self, *, user_id: uuid.UUID, hashed_password: str) -&gt; None:\n    \"\"\"\n    Update user's password.\n\n    Args:\n        user_id: User's unique identifier\n        hashed_password: Already hashed password\n    \"\"\"\n    ...\n</code></pre>"},{"location":"reference/adapters/base/users/#fastauth.adapters.base.users.UserAdapter.update_last_login","title":"update_last_login  <code>abstractmethod</code>","text":"<pre><code>update_last_login(user_id: UUID) -&gt; None\n</code></pre> <p>Update user's last login timestamp.</p> <p>Parameters:</p> Name Type Description Default <code>user_id</code> <code>UUID</code> <p>User's unique identifier</p> required Source code in <code>fastauth/adapters/base/users.py</code> <pre><code>@abstractmethod\ndef update_last_login(self, user_id: uuid.UUID) -&gt; None:\n    \"\"\"\n    Update user's last login timestamp.\n\n    Args:\n        user_id: User's unique identifier\n    \"\"\"\n    ...\n</code></pre>"},{"location":"reference/adapters/base/users/#fastauth.adapters.base.users.UserAdapter.update_email","title":"update_email  <code>abstractmethod</code>","text":"<pre><code>update_email(*, user_id: UUID, new_email: str) -&gt; None\n</code></pre> <p>Update user's email address.</p> <p>Parameters:</p> Name Type Description Default <code>user_id</code> <code>UUID</code> <p>User's unique identifier</p> required <code>new_email</code> <code>str</code> <p>New email address</p> required Source code in <code>fastauth/adapters/base/users.py</code> <pre><code>@abstractmethod\ndef update_email(self, *, user_id: uuid.UUID, new_email: str) -&gt; None:\n    \"\"\"\n    Update user's email address.\n\n    Args:\n        user_id: User's unique identifier\n        new_email: New email address\n    \"\"\"\n    ...\n</code></pre>"},{"location":"reference/adapters/base/users/#fastauth.adapters.base.users.UserAdapter.soft_delete_user","title":"soft_delete_user  <code>abstractmethod</code>","text":"<pre><code>soft_delete_user(*, user_id: UUID) -&gt; None\n</code></pre> <p>Soft delete a user by setting deleted_at timestamp.</p> <p>Parameters:</p> Name Type Description Default <code>user_id</code> <code>UUID</code> <p>User's unique identifier</p> required Source code in <code>fastauth/adapters/base/users.py</code> <pre><code>@abstractmethod\ndef soft_delete_user(self, *, user_id: uuid.UUID) -&gt; None:\n    \"\"\"\n    Soft delete a user by setting deleted_at timestamp.\n\n    Args:\n        user_id: User's unique identifier\n    \"\"\"\n    ...\n</code></pre>"},{"location":"reference/adapters/base/users/#fastauth.adapters.base.users.UserAdapter.hard_delete_user","title":"hard_delete_user  <code>abstractmethod</code>","text":"<pre><code>hard_delete_user(*, user_id: UUID) -&gt; None\n</code></pre> <p>Permanently delete a user from the database.</p> <p>Parameters:</p> Name Type Description Default <code>user_id</code> <code>UUID</code> <p>User's unique identifier</p> required Source code in <code>fastauth/adapters/base/users.py</code> <pre><code>@abstractmethod\ndef hard_delete_user(self, *, user_id: uuid.UUID) -&gt; None:\n    \"\"\"\n    Permanently delete a user from the database.\n\n    Args:\n        user_id: User's unique identifier\n    \"\"\"\n    ...\n</code></pre>"},{"location":"reference/adapters/sqlalchemy/email_change/","title":"Email Change","text":""},{"location":"reference/adapters/sqlalchemy/email_change/#fastauth.adapters.sqlalchemy.email_change","title":"email_change","text":""},{"location":"reference/adapters/sqlalchemy/email_change/#fastauth.adapters.sqlalchemy.email_change-classes","title":"Classes","text":""},{"location":"reference/adapters/sqlalchemy/email_verification/","title":"Email Verification","text":""},{"location":"reference/adapters/sqlalchemy/email_verification/#fastauth.adapters.sqlalchemy.email_verification","title":"email_verification","text":""},{"location":"reference/adapters/sqlalchemy/models/","title":"Models","text":""},{"location":"reference/adapters/sqlalchemy/models/#fastauth.adapters.sqlalchemy.models","title":"models","text":""},{"location":"reference/adapters/sqlalchemy/oauth_accounts/","title":"Oauth Accounts","text":""},{"location":"reference/adapters/sqlalchemy/oauth_accounts/#fastauth.adapters.sqlalchemy.oauth_accounts","title":"oauth_accounts","text":""},{"location":"reference/adapters/sqlalchemy/oauth_accounts/#fastauth.adapters.sqlalchemy.oauth_accounts-classes","title":"Classes","text":""},{"location":"reference/adapters/sqlalchemy/oauth_states/","title":"Oauth States","text":""},{"location":"reference/adapters/sqlalchemy/oauth_states/#fastauth.adapters.sqlalchemy.oauth_states","title":"oauth_states","text":""},{"location":"reference/adapters/sqlalchemy/oauth_states/#fastauth.adapters.sqlalchemy.oauth_states-classes","title":"Classes","text":""},{"location":"reference/adapters/sqlalchemy/password_reset/","title":"Password Reset","text":""},{"location":"reference/adapters/sqlalchemy/password_reset/#fastauth.adapters.sqlalchemy.password_reset","title":"password_reset","text":""},{"location":"reference/adapters/sqlalchemy/refresh_tokens/","title":"Refresh Tokens","text":""},{"location":"reference/adapters/sqlalchemy/refresh_tokens/#fastauth.adapters.sqlalchemy.refresh_tokens","title":"refresh_tokens","text":""},{"location":"reference/adapters/sqlalchemy/roles/","title":"Roles","text":""},{"location":"reference/adapters/sqlalchemy/roles/#fastauth.adapters.sqlalchemy.roles","title":"roles","text":""},{"location":"reference/adapters/sqlalchemy/roles/#fastauth.adapters.sqlalchemy.roles-classes","title":"Classes","text":""},{"location":"reference/adapters/sqlalchemy/sessions/","title":"Sessions","text":""},{"location":"reference/adapters/sqlalchemy/sessions/#fastauth.adapters.sqlalchemy.sessions","title":"sessions","text":""},{"location":"reference/adapters/sqlalchemy/users/","title":"Users","text":""},{"location":"reference/adapters/sqlalchemy/users/#fastauth.adapters.sqlalchemy.users","title":"users","text":""},{"location":"reference/adapters/sqlalchemy/users/#fastauth.adapters.sqlalchemy.users-classes","title":"Classes","text":""},{"location":"reference/api/account/","title":"Account","text":""},{"location":"reference/api/account/#fastauth.api.account","title":"account","text":""},{"location":"reference/api/account/#fastauth.api.account-classes","title":"Classes","text":""},{"location":"reference/api/account/#fastauth.api.account-functions","title":"Functions","text":""},{"location":"reference/api/account/#fastauth.api.account.change_user_password","title":"change_user_password","text":"<pre><code>change_user_password(\n    request: ChangePasswordRequest,\n    session: Session = Depends(get_session),\n    current_user: User = Depends(get_current_user),\n)\n</code></pre> <p>Change the current user's password.</p> <p>Requires the current password for verification. Invalidates all other sessions after password change for security.</p> Source code in <code>fastauth/api/account.py</code> <pre><code>@router.post(\"/change-password\", response_model=MessageResponse)\ndef change_user_password(\n    request: ChangePasswordRequest,\n    session: Session = Depends(get_session),\n    current_user: User = Depends(get_current_user),\n):\n    \"\"\"\n    Change the current user's password.\n\n    Requires the current password for verification.\n    Invalidates all other sessions after password change for security.\n    \"\"\"\n    users_adapter = SQLAlchemyUserAdapter(session=session)\n    sessions_adapter = SQLAlchemySessionAdapter(session=session)\n\n    try:\n        change_password(\n            users=users_adapter,\n            sessions=sessions_adapter,\n            user_id=current_user.id,\n            current_password=request.current_password,\n            new_password=request.new_password,\n            current_session_id=None,\n        )\n    except InvalidPasswordError:\n        raise HTTPException(\n            status_code=status.HTTP_400_BAD_REQUEST,\n            detail=\"Current password is incorrect\",\n        )\n    except UserNotFoundError:\n        raise HTTPException(\n            status_code=status.HTTP_404_NOT_FOUND,\n            detail=\"User not found\",\n        )\n\n    return MessageResponse(message=\"Password changed successfully\")\n</code></pre>"},{"location":"reference/api/account/#fastauth.api.account.delete_user_account","title":"delete_user_account","text":"<pre><code>delete_user_account(\n    request: DeleteAccountRequest,\n    session: Session = Depends(get_session),\n    current_user: User = Depends(get_current_user),\n)\n</code></pre> <p>Delete the current user's account.</p> <p>Requires password for verification. Supports both soft delete (default) and hard delete. Soft delete sets deleted_at timestamp and deactivates the account. Hard delete permanently removes the user from the database.</p> Source code in <code>fastauth/api/account.py</code> <pre><code>@router.delete(\"/delete\", response_model=MessageResponse)\ndef delete_user_account(\n    request: DeleteAccountRequest,\n    session: Session = Depends(get_session),\n    current_user: User = Depends(get_current_user),\n):\n    \"\"\"\n    Delete the current user's account.\n\n    Requires password for verification.\n    Supports both soft delete (default) and hard delete.\n    Soft delete sets deleted_at timestamp and deactivates the account.\n    Hard delete permanently removes the user from the database.\n    \"\"\"\n    users_adapter = SQLAlchemyUserAdapter(session=session)\n    sessions_adapter = SQLAlchemySessionAdapter(session=session)\n\n    try:\n        delete_account(\n            users=users_adapter,\n            sessions=sessions_adapter,\n            user_id=current_user.id,\n            password=request.password,\n            hard_delete=request.hard_delete,\n        )\n    except InvalidPasswordError:\n        raise HTTPException(\n            status_code=status.HTTP_400_BAD_REQUEST,\n            detail=\"Password is incorrect\",\n        )\n    except UserNotFoundError:\n        raise HTTPException(\n            status_code=status.HTTP_404_NOT_FOUND,\n            detail=\"User not found\",\n        )\n\n    delete_type = \"permanently deleted\" if request.hard_delete else \"deactivated\"\n    return MessageResponse(message=f\"Account {delete_type} successfully\")\n</code></pre>"},{"location":"reference/api/account/#fastauth.api.account.request_user_email_change","title":"request_user_email_change","text":"<pre><code>request_user_email_change(\n    request: RequestEmailChangeRequest,\n    session: Session = Depends(get_session),\n    current_user: User = Depends(get_current_user),\n)\n</code></pre> <p>Request an email change for the current user.</p> <p>Generates a verification token that must be confirmed to complete the email change. The token expires in 60 minutes by default.</p> Source code in <code>fastauth/api/account.py</code> <pre><code>@router.post(\"/request-email-change\", response_model=EmailChangeTokenResponse)\ndef request_user_email_change(\n    request: RequestEmailChangeRequest,\n    session: Session = Depends(get_session),\n    current_user: User = Depends(get_current_user),\n):\n    \"\"\"\n    Request an email change for the current user.\n\n    Generates a verification token that must be confirmed to complete the email change.\n    The token expires in 60 minutes by default.\n    \"\"\"\n    users_adapter = SQLAlchemyUserAdapter(session=session)\n    email_changes_adapter = SQLAlchemyEmailChangeAdapter(session=session)\n\n    try:\n        token = request_email_change(\n            users=users_adapter,\n            email_changes=email_changes_adapter,\n            user_id=current_user.id,\n            new_email=request.new_email,\n            expires_in_minutes=60,\n        )\n    except EmailAlreadyExistsError:\n        raise HTTPException(\n            status_code=status.HTTP_400_BAD_REQUEST,\n            detail=\"Email already exists\",\n        )\n\n    if not token:\n        raise HTTPException(\n            status_code=status.HTTP_404_NOT_FOUND,\n            detail=\"User not found\",\n        )\n\n    return EmailChangeTokenResponse(\n        message=\"Email change requested. \\\n            Please verify the token to complete the change.\",\n        token=token,\n    )\n</code></pre>"},{"location":"reference/api/account/#fastauth.api.account.confirm_user_email_change","title":"confirm_user_email_change","text":"<pre><code>confirm_user_email_change(\n    request: ConfirmEmailChangeRequest, session: Session = Depends(get_session)\n)\n</code></pre> <p>Confirm an email change with a verification token.</p> <p>Completes the email change process started with request-email-change.</p> Source code in <code>fastauth/api/account.py</code> <pre><code>@router.post(\"/confirm-email-change\", response_model=MessageResponse)\ndef confirm_user_email_change(\n    request: ConfirmEmailChangeRequest,\n    session: Session = Depends(get_session),\n):\n    \"\"\"\n    Confirm an email change with a verification token.\n\n    Completes the email change process started with request-email-change.\n    \"\"\"\n    users_adapter = SQLAlchemyUserAdapter(session=session)\n    email_changes_adapter = SQLAlchemyEmailChangeAdapter(session=session)\n\n    try:\n        confirm_email_change(\n            users=users_adapter,\n            email_changes=email_changes_adapter,\n            token=request.token,\n        )\n    except EmailChangeError as e:\n        raise HTTPException(\n            status_code=status.HTTP_400_BAD_REQUEST,\n            detail=str(e),\n        )\n    except EmailAlreadyExistsError as e:\n        raise HTTPException(\n            status_code=status.HTTP_400_BAD_REQUEST,\n            detail=str(e),\n        )\n\n    return MessageResponse(message=\"Email changed successfully\")\n</code></pre>"},{"location":"reference/api/auth/","title":"Auth","text":""},{"location":"reference/api/auth/#fastauth.api.auth","title":"auth","text":""},{"location":"reference/api/auth/#fastauth.api.auth-classes","title":"Classes","text":""},{"location":"reference/api/auth/#fastauth.api.auth-functions","title":"Functions","text":""},{"location":"reference/api/dependencies/","title":"Dependencies","text":""},{"location":"reference/api/dependencies/#fastauth.api.dependencies","title":"dependencies","text":""},{"location":"reference/api/dependencies/#fastauth.api.dependencies-classes","title":"Classes","text":""},{"location":"reference/api/dependencies/#fastauth.api.dependencies-functions","title":"Functions","text":""},{"location":"reference/api/dependencies/#fastauth.api.dependencies.require_role","title":"require_role","text":"<pre><code>require_role(role_name: str) -&gt; Callable\n</code></pre> <p>Create a dependency that requires a user to have a specific role.</p> <p>Parameters:</p> Name Type Description Default <code>role_name</code> <code>str</code> <p>Name of the required role</p> required <p>Returns:</p> Type Description <code>Callable</code> <p>Dependency function that can be used with FastAPI Depends</p> Example <p>@app.get(\"/admin\", dependencies=[Depends(require_role(\"admin\"))]) def admin_endpoint():     return {\"message\": \"Admin access granted\"}</p> Source code in <code>fastauth/api/dependencies.py</code> <pre><code>def require_role(role_name: str) -&gt; Callable:\n    \"\"\"\n    Create a dependency that requires a user to have a specific role.\n\n    Args:\n        role_name: Name of the required role\n\n    Returns:\n        Dependency function that can be used with FastAPI Depends\n\n    Example:\n        @app.get(\"/admin\", dependencies=[Depends(require_role(\"admin\"))])\n        def admin_endpoint():\n            return {\"message\": \"Admin access granted\"}\n    \"\"\"\n\n    def role_checker(\n        current_user: User = Depends(get_current_user),\n        roles: SQLAlchemyRoleAdapter = Depends(get_role_adapter),\n    ):\n        user_roles = roles.get_user_roles(user_id=current_user.id)\n        user_role_names = [role.name for role in user_roles]\n\n        if role_name not in user_role_names:\n            raise HTTPException(\n                status_code=status.HTTP_403_FORBIDDEN,\n                detail=f\"Role '{role_name}' required\",\n            )\n\n        return current_user\n\n    return role_checker\n</code></pre>"},{"location":"reference/api/dependencies/#fastauth.api.dependencies.require_permission","title":"require_permission","text":"<pre><code>require_permission(permission_name: str) -&gt; Callable\n</code></pre> <p>Create a dependency that requires a user to have a specific permission.</p> <p>Parameters:</p> Name Type Description Default <code>permission_name</code> <code>str</code> <p>Name of the required permission</p> required <p>Returns:</p> Type Description <code>Callable</code> <p>Dependency function that can be used with FastAPI Depends</p> Example <p>@app.delete(     \"/users/{id}\",     dependencies=[Depends(require_permission(\"delete:users\"))] ) def delete_user(id: str):     return {\"message\": \"User deleted\"}</p> Source code in <code>fastauth/api/dependencies.py</code> <pre><code>def require_permission(permission_name: str) -&gt; Callable:\n    \"\"\"\n    Create a dependency that requires a user to have a specific permission.\n\n    Args:\n        permission_name: Name of the required permission\n\n    Returns:\n        Dependency function that can be used with FastAPI Depends\n\n    Example:\n        @app.delete(\n            \"/users/{id}\",\n            dependencies=[Depends(require_permission(\"delete:users\"))]\n        )\n        def delete_user(id: str):\n            return {\"message\": \"User deleted\"}\n    \"\"\"\n\n    def permission_checker(\n        current_user: User = Depends(get_current_user),\n        roles: SQLAlchemyRoleAdapter = Depends(get_role_adapter),\n    ):\n        has_permission = check_permission(\n            roles=roles,\n            user_id=current_user.id,\n            permission_name=permission_name,\n        )\n\n        if not has_permission:\n            raise HTTPException(\n                status_code=status.HTTP_403_FORBIDDEN,\n                detail=f\"Permission '{permission_name}' required\",\n            )\n\n        return current_user\n\n    return permission_checker\n</code></pre>"},{"location":"reference/api/oauth/","title":"Oauth","text":""},{"location":"reference/api/oauth/#fastauth.api.oauth","title":"oauth","text":""},{"location":"reference/api/oauth/#fastauth.api.oauth-classes","title":"Classes","text":""},{"location":"reference/api/oauth/#fastauth.api.oauth-functions","title":"Functions","text":""},{"location":"reference/api/oauth/#fastauth.api.oauth.authorize","title":"authorize","text":"<pre><code>authorize(\n    provider_name: str,\n    request: Request,\n    session: Session = Depends(get_session),\n    current_user: User | None = None,\n) -&gt; OAuthAuthorizationResponse\n</code></pre> <p>Initiate OAuth authorization flow.</p> <p>This endpoint generates a state token and authorization URL. If the user is logged in, this will be a linking flow. If not logged in, this will be a login/registration flow.</p> <p>The code_verifier for PKCE is stored in the session.</p> <p>Parameters:</p> Name Type Description Default <code>provider_name</code> <code>str</code> <p>OAuth provider (e.g., 'google', 'github')</p> required <code>request</code> <code>Request</code> <p>FastAPI request object</p> required <code>session</code> <code>Session</code> <p>Database session</p> <code>Depends(get_session)</code> <code>current_user</code> <code>User | None</code> <p>Optional current user (if authenticated)</p> <code>None</code> <p>Returns:</p> Type Description <code>OAuthAuthorizationResponse</code> <p>OAuthAuthorizationResponse with authorization_url</p> Source code in <code>fastauth/api/oauth.py</code> <pre><code>@router.get(\"/{provider}/authorize\", response_model=OAuthAuthorizationResponse)\ndef authorize(\n    provider_name: str,\n    request: Request,\n    session: Session = Depends(get_session),\n    current_user: User | None = None,\n) -&gt; OAuthAuthorizationResponse:\n    \"\"\"\n    Initiate OAuth authorization flow.\n\n    This endpoint generates a state token and authorization URL.\n    If the user is logged in, this will be a linking flow.\n    If not logged in, this will be a login/registration flow.\n\n    The code_verifier for PKCE is stored in the session.\n\n    Args:\n        provider_name: OAuth provider (e.g., 'google', 'github')\n        request: FastAPI request object\n        session: Database session\n        current_user: Optional current user (if authenticated)\n\n    Returns:\n        OAuthAuthorizationResponse with authorization_url\n    \"\"\"\n    provider = _get_or_register_provider(provider_name)\n\n    states = SQLAlchemyOAuthStateAdapter(session=session)\n\n    redirect_uri = str(request.url_for(\"oauth_callback\", provider=provider_name))\n\n    user_id = current_user.id if current_user else None\n\n    authorization_url, state_token, code_verifier = initiate_oauth_flow(\n        states=states,\n        provider=provider,\n        redirect_uri=redirect_uri,\n        user_id=user_id,\n        use_pkce=True,\n    )\n\n    # NOTE: This requires SessionMiddleware to be configured\n    if code_verifier:\n        if not hasattr(request, \"session\"):\n            raise HTTPException(\n                status_code=status.HTTP_500_INTERNAL_SERVER_ERROR,\n                detail=\"Session middleware not configured.\\\n                    Please add SessionMiddleware to your app.\",\n            )\n        request.session[\"oauth_code_verifier\"] = code_verifier\n        request.session[\"oauth_state\"] = state_token\n\n    return OAuthAuthorizationResponse(authorization_url=authorization_url)\n</code></pre>"},{"location":"reference/api/oauth/#fastauth.api.oauth.oauth_callback","title":"oauth_callback  <code>async</code>","text":"<pre><code>oauth_callback(\n    provider_name: str,\n    payload: OAuthCallbackRequest,\n    request: Request,\n    session: Session = Depends(get_session),\n) -&gt; TokenResponse\n</code></pre> <p>Handle OAuth callback after user authorization.</p> <p>This endpoint: 1. Validates the state token (CSRF protection) 2. Exchanges authorization code for tokens 3. Fetches user info from provider 4. Creates or links user account 5. Issues FastAuth tokens (JWT + refresh token)</p> <p>Parameters:</p> Name Type Description Default <code>provider_name</code> <code>str</code> <p>OAuth provider (e.g., 'google', 'github')</p> required <code>payload</code> <code>OAuthCallbackRequest</code> <p>Callback request with code and state</p> required <code>request</code> <code>Request</code> <p>FastAPI request object</p> required <code>session</code> <code>Session</code> <p>Database session</p> <code>Depends(get_session)</code> <p>Returns:</p> Type Description <code>TokenResponse</code> <p>TokenResponse with access_token and refresh_token</p> Source code in <code>fastauth/api/oauth.py</code> <pre><code>@router.post(\"/{provider}/callback\", response_model=TokenResponse)\nasync def oauth_callback(\n    provider_name: str,\n    payload: OAuthCallbackRequest,\n    request: Request,\n    session: Session = Depends(get_session),\n) -&gt; TokenResponse:\n    \"\"\"\n    Handle OAuth callback after user authorization.\n\n    This endpoint:\n    1. Validates the state token (CSRF protection)\n    2. Exchanges authorization code for tokens\n    3. Fetches user info from provider\n    4. Creates or links user account\n    5. Issues FastAuth tokens (JWT + refresh token)\n\n    Args:\n        provider_name: OAuth provider (e.g., 'google', 'github')\n        payload: Callback request with code and state\n        request: FastAPI request object\n        session: Database session\n\n    Returns:\n        TokenResponse with access_token and refresh_token\n    \"\"\"\n    provider = _get_or_register_provider(provider_name)\n\n    code_verifier = None\n    if hasattr(request, \"session\"):\n        code_verifier = request.session.get(\"oauth_code_verifier\")\n        stored_state = request.session.get(\"oauth_state\")\n\n        if stored_state != payload.state:\n            raise HTTPException(\n                status_code=status.HTTP_400_BAD_REQUEST,\n                detail=\"State mismatch - possible CSRF attack\",\n            )\n\n        request.session.pop(\"oauth_code_verifier\", None)\n        request.session.pop(\"oauth_state\", None)\n\n    states = SQLAlchemyOAuthStateAdapter(session=session)\n    oauth_accounts = SQLAlchemyOAuthAccountAdapter(session=session)\n    users = SQLAlchemyUserAdapter(session=session)\n\n    try:\n        user, _ = await complete_oauth_flow(\n            states=states,\n            oauth_accounts=oauth_accounts,\n            users=users,\n            provider=provider,\n            code=payload.code,\n            state=payload.state,\n            code_verifier=code_verifier,\n        )\n\n    except OAuthStateError as e:\n        raise HTTPException(\n            status_code=status.HTTP_400_BAD_REQUEST,\n            detail=str(e),\n        )\n    except OAuthAccountAlreadyLinkedError as e:\n        raise HTTPException(\n            status_code=status.HTTP_409_CONFLICT,\n            detail=str(e),\n        )\n    except OAuthError as e:\n        raise HTTPException(\n            status_code=status.HTTP_400_BAD_REQUEST,\n            detail=str(e),\n        )\n\n    refresh_tokens = SQLAlchemyRefreshTokenAdapter(session=session)\n    sessions = SQLAlchemySessionAdapter(session=session)\n\n    access_token = create_access_token(subject=str(user.id))\n    refresh_token = create_refresh_token(\n        refresh_tokens=refresh_tokens,\n        user_id=user.id,\n    )\n\n    create_session(\n        sessions=sessions,\n        users=users,\n        user_id=user.id,\n        ip_address=request.client.host if request.client else None,\n        user_agent=request.headers.get(\"user-agent\"),\n    )\n\n    return TokenResponse(\n        access_token=access_token,\n        refresh_token=refresh_token,\n    )\n</code></pre>"},{"location":"reference/api/oauth/#fastauth.api.oauth.list_linked_accounts","title":"list_linked_accounts","text":"<pre><code>list_linked_accounts(\n    session: Session = Depends(get_session),\n    current_user: User = Depends(get_current_user),\n) -&gt; list[OAuthLinkResponse]\n</code></pre> <p>List all OAuth accounts linked to the current user.</p> <p>Requires authentication.</p> <p>Parameters:</p> Name Type Description Default <code>session</code> <code>Session</code> <p>Database session</p> <code>Depends(get_session)</code> <code>current_user</code> <code>User</code> <p>Current authenticated user</p> <code>Depends(get_current_user)</code> <p>Returns:</p> Type Description <code>list[OAuthLinkResponse]</code> <p>List of linked OAuth accounts</p> Source code in <code>fastauth/api/oauth.py</code> <pre><code>@router.get(\"/linked\", response_model=list[OAuthLinkResponse])\ndef list_linked_accounts(\n    session: Session = Depends(get_session),\n    current_user: User = Depends(get_current_user),\n) -&gt; list[OAuthLinkResponse]:\n    \"\"\"\n    List all OAuth accounts linked to the current user.\n\n    Requires authentication.\n\n    Args:\n        session: Database session\n        current_user: Current authenticated user\n\n    Returns:\n        List of linked OAuth accounts\n    \"\"\"\n    oauth_accounts = SQLAlchemyOAuthAccountAdapter(session=session)\n\n    accounts = get_linked_accounts(\n        oauth_accounts=oauth_accounts,\n        user_id=current_user.id,\n    )\n\n    return [\n        OAuthLinkResponse(\n            provider=account.provider,\n            email=account.email,\n            name=account.name,\n            linked_at=account.created_at,\n        )\n        for account in accounts\n    ]\n</code></pre>"},{"location":"reference/api/oauth/#fastauth.api.oauth.unlink_provider","title":"unlink_provider","text":"<pre><code>unlink_provider(\n    provider_name: str,\n    session: Session = Depends(get_session),\n    current_user: User = Depends(get_current_user),\n) -&gt; None\n</code></pre> <p>Unlink an OAuth provider from the current user's account.</p> <p>Requires authentication.</p> <p>Parameters:</p> Name Type Description Default <code>provider_name</code> <code>str</code> <p>OAuth provider to unlink (e.g., 'google', 'github')</p> required <code>session</code> <code>Session</code> <p>Database session</p> <code>Depends(get_session)</code> <code>current_user</code> <code>User</code> <p>Current authenticated user</p> <code>Depends(get_current_user)</code> <p>Returns:</p> Type Description <code>None</code> <p>204 No Content on success</p> Source code in <code>fastauth/api/oauth.py</code> <pre><code>@router.delete(\"/{provider}/unlink\", status_code=status.HTTP_204_NO_CONTENT)\ndef unlink_provider(\n    provider_name: str,\n    session: Session = Depends(get_session),\n    current_user: User = Depends(get_current_user),\n) -&gt; None:\n    \"\"\"\n    Unlink an OAuth provider from the current user's account.\n\n    Requires authentication.\n\n    Args:\n        provider_name: OAuth provider to unlink (e.g., 'google', 'github')\n        session: Database session\n        current_user: Current authenticated user\n\n    Returns:\n        204 No Content on success\n    \"\"\"\n    oauth_accounts = SQLAlchemyOAuthAccountAdapter(session=session)\n\n    try:\n        unlink_oauth_account(\n            oauth_accounts=oauth_accounts,\n            user_id=current_user.id,\n            provider=provider_name,\n        )\n    except OAuthError as e:\n        raise HTTPException(\n            status_code=status.HTTP_404_NOT_FOUND,\n            detail=str(e),\n        )\n\n    return None\n</code></pre>"},{"location":"reference/api/schemas/","title":"Schemas","text":""},{"location":"reference/api/schemas/#fastauth.api.schemas","title":"schemas","text":""},{"location":"reference/api/sessions/","title":"Sessions","text":""},{"location":"reference/api/sessions/#fastauth.api.sessions","title":"sessions","text":""},{"location":"reference/api/sessions/#fastauth.api.sessions-classes","title":"Classes","text":""},{"location":"reference/api/sessions/#fastauth.api.sessions-functions","title":"Functions","text":""},{"location":"reference/api/sessions/#fastauth.api.sessions.list_sessions","title":"list_sessions","text":"<pre><code>list_sessions(\n    session: Session = Depends(get_session),\n    current_user: User = Depends(get_current_user),\n)\n</code></pre> <p>List all active sessions for the current user.</p> Source code in <code>fastauth/api/sessions.py</code> <pre><code>@router.get(\"\", response_model=SessionListResponse)\ndef list_sessions(\n    session: Session = Depends(get_session),\n    current_user: User = Depends(get_current_user),\n):\n    \"\"\"\n    List all active sessions for the current user.\n    \"\"\"\n    sessions_adapter = SQLAlchemySessionAdapter(session=session)\n\n    user_sessions = get_user_sessions(\n        sessions=sessions_adapter,\n        user_id=current_user.id,\n    )\n\n    return SessionListResponse(\n        sessions=[\n            SessionResponse(\n                id=s.id,\n                device=s.device,\n                ip_address=s.ip_address,\n                user_agent=s.user_agent,\n                last_active=s.last_active.isoformat(),\n                created_at=s.created_at.isoformat(),\n            )\n            for s in user_sessions\n        ]\n    )\n</code></pre>"},{"location":"reference/api/sessions/#fastauth.api.sessions.delete_all_sessions","title":"delete_all_sessions","text":"<pre><code>delete_all_sessions(\n    session: Session = Depends(get_session),\n    current_user: User = Depends(get_current_user),\n)\n</code></pre> <p>Delete all sessions for the current user except the current one. Note: This will log out the user from all other devices.</p> Source code in <code>fastauth/api/sessions.py</code> <pre><code>@router.delete(\"/all\", response_model=MessageResponse)\ndef delete_all_sessions(\n    session: Session = Depends(get_session),\n    current_user: User = Depends(get_current_user),\n):\n    \"\"\"\n    Delete all sessions for the current user except the current one.\n    Note: This will log out the user from all other devices.\n    \"\"\"\n    sessions_adapter = SQLAlchemySessionAdapter(session=session)\n\n    delete_all_user_sessions(\n        sessions=sessions_adapter,\n        user_id=current_user.id,\n        except_session_id=None,\n    )\n\n    return MessageResponse(message=\"All sessions deleted successfully\")\n</code></pre>"},{"location":"reference/api/sessions/#fastauth.api.sessions.delete_user_session","title":"delete_user_session","text":"<pre><code>delete_user_session(\n    session_id: UUID,\n    session: Session = Depends(get_session),\n    current_user: User = Depends(get_current_user),\n)\n</code></pre> <p>Delete a specific session. Users can only delete their own sessions.</p> Source code in <code>fastauth/api/sessions.py</code> <pre><code>@router.delete(\"/{session_id}\", response_model=MessageResponse)\ndef delete_user_session(\n    session_id: uuid.UUID,\n    session: Session = Depends(get_session),\n    current_user: User = Depends(get_current_user),\n):\n    \"\"\"\n    Delete a specific session. Users can only delete their own sessions.\n    \"\"\"\n    sessions_adapter = SQLAlchemySessionAdapter(session=session)\n\n    try:\n        delete_session(\n            sessions=sessions_adapter,\n            session_id=session_id,\n            user_id=current_user.id,\n        )\n    except SessionNotFoundError:\n        raise HTTPException(\n            status_code=status.HTTP_404_NOT_FOUND,\n            detail=\"Session not found\",\n        )\n\n    return MessageResponse(message=\"Session deleted successfully\")\n</code></pre>"},{"location":"reference/core/account/","title":"Account","text":""},{"location":"reference/core/account/#fastauth.core.account","title":"account","text":""},{"location":"reference/core/account/#fastauth.core.account-classes","title":"Classes","text":""},{"location":"reference/core/account/#fastauth.core.account.InvalidPasswordError","title":"InvalidPasswordError","text":"<p>             Bases: <code>Exception</code></p> <p>Raised when the current password is incorrect.</p>"},{"location":"reference/core/account/#fastauth.core.account.UserNotFoundError","title":"UserNotFoundError","text":"<p>             Bases: <code>Exception</code></p> <p>Raised when the user is not found.</p>"},{"location":"reference/core/account/#fastauth.core.account.EmailChangeError","title":"EmailChangeError","text":"<p>             Bases: <code>Exception</code></p> <p>Raised when there's an error with email change.</p>"},{"location":"reference/core/account/#fastauth.core.account.EmailAlreadyExistsError","title":"EmailAlreadyExistsError","text":"<p>             Bases: <code>Exception</code></p> <p>Raised when the new email already exists.</p>"},{"location":"reference/core/account/#fastauth.core.account-functions","title":"Functions","text":""},{"location":"reference/core/account/#fastauth.core.account.change_password","title":"change_password","text":"<pre><code>change_password(\n    *,\n    users: UserAdapter,\n    sessions: SessionAdapter,\n    user_id: UUID,\n    current_password: str,\n    new_password: str,\n    current_session_id: UUID | None = None\n) -&gt; None\n</code></pre> <p>Change a user's password.</p> <p>Parameters:</p> Name Type Description Default <code>users</code> <code>UserAdapter</code> <p>User adapter for database operations</p> required <code>sessions</code> <code>SessionAdapter</code> <p>Session adapter for database operations</p> required <code>user_id</code> <code>UUID</code> <p>ID of the user changing their password</p> required <code>current_password</code> <code>str</code> <p>Current password for verification</p> required <code>new_password</code> <code>str</code> <p>New password to set</p> required <code>current_session_id</code> <code>UUID | None</code> <p>Optional session ID to preserve during logout</p> <code>None</code> <p>Raises:</p> Type Description <code>UserNotFoundError</code> <p>If the user doesn't exist</p> <code>InvalidPasswordError</code> <p>If the current password is incorrect</p> Source code in <code>fastauth/core/account.py</code> <pre><code>def change_password(\n    *,\n    users: UserAdapter,\n    sessions: SessionAdapter,\n    user_id: uuid.UUID,\n    current_password: str,\n    new_password: str,\n    current_session_id: uuid.UUID | None = None,\n) -&gt; None:\n    \"\"\"\n    Change a user's password.\n\n    Args:\n        users: User adapter for database operations\n        sessions: Session adapter for database operations\n        user_id: ID of the user changing their password\n        current_password: Current password for verification\n        new_password: New password to set\n        current_session_id: Optional session ID to preserve during logout\n\n    Raises:\n        UserNotFoundError: If the user doesn't exist\n        InvalidPasswordError: If the current password is incorrect\n    \"\"\"\n    user = users.get_by_id(user_id)\n    if not user:\n        raise UserNotFoundError(\"User not found\")\n\n    if not verify_password(user.hashed_password, current_password):\n        raise InvalidPasswordError(\"Current password is incorrect\")\n\n    hashed_new_password = hash_password(new_password)\n    users.set_password(user_id=user_id, hashed_password=hashed_new_password)\n\n    sessions.delete_user_sessions(\n        user_id=user_id,\n        except_session_id=current_session_id,\n    )\n</code></pre>"},{"location":"reference/core/account/#fastauth.core.account.request_email_change","title":"request_email_change","text":"<pre><code>request_email_change(\n    *,\n    users: UserAdapter,\n    email_changes: EmailChangeAdapter,\n    user_id: UUID,\n    new_email: str,\n    expires_in_minutes: int = 60\n) -&gt; str | None\n</code></pre> <p>Request an email change for a user.</p> <p>Parameters:</p> Name Type Description Default <code>users</code> <code>UserAdapter</code> <p>User adapter for database operations</p> required <code>email_changes</code> <code>EmailChangeAdapter</code> <p>Email change adapter for database operations</p> required <code>user_id</code> <code>UUID</code> <p>ID of the user requesting email change</p> required <code>new_email</code> <code>str</code> <p>New email address</p> required <code>expires_in_minutes</code> <code>int</code> <p>Token expiration time in minutes</p> <code>60</code> <p>Returns:</p> Type Description <code>str | None</code> <p>Verification token if successful, None if user not found</p> <p>Raises:</p> Type Description <code>EmailAlreadyExistsError</code> <p>If the new email already exists</p> Source code in <code>fastauth/core/account.py</code> <pre><code>def request_email_change(\n    *,\n    users: UserAdapter,\n    email_changes: EmailChangeAdapter,\n    user_id: uuid.UUID,\n    new_email: str,\n    expires_in_minutes: int = 60,\n) -&gt; str | None:\n    \"\"\"\n    Request an email change for a user.\n\n    Args:\n        users: User adapter for database operations\n        email_changes: Email change adapter for database operations\n        user_id: ID of the user requesting email change\n        new_email: New email address\n        expires_in_minutes: Token expiration time in minutes\n\n    Returns:\n        Verification token if successful, None if user not found\n\n    Raises:\n        EmailAlreadyExistsError: If the new email already exists\n    \"\"\"\n    user = users.get_by_id(user_id)\n    if not user:\n        return None\n\n    existing_user = users.get_by_email(new_email)\n    if existing_user:\n        raise EmailAlreadyExistsError(f\"Email {new_email} already exists\")\n\n    raw_token = generate_refresh_token()\n    token_hash = hash_refresh_token(raw_token)\n\n    expires_at = datetime.now(UTC) + timedelta(minutes=expires_in_minutes)\n\n    email_changes.create(\n        user_id=user_id,\n        new_email=new_email,\n        token_hash=token_hash,\n        expires_at=expires_at,\n    )\n\n    return raw_token\n</code></pre>"},{"location":"reference/core/account/#fastauth.core.account.confirm_email_change","title":"confirm_email_change","text":"<pre><code>confirm_email_change(\n    *, users: UserAdapter, email_changes: EmailChangeAdapter, token: str\n) -&gt; None\n</code></pre> <p>Confirm an email change with a verification token.</p> <p>Parameters:</p> Name Type Description Default <code>users</code> <code>UserAdapter</code> <p>User adapter for database operations</p> required <code>email_changes</code> <code>EmailChangeAdapter</code> <p>Email change adapter for database operations</p> required <code>token</code> <code>str</code> <p>Verification token</p> required <p>Raises:</p> Type Description <code>EmailChangeError</code> <p>If token is invalid or expired</p> <code>EmailAlreadyExistsError</code> <p>If the new email already exists</p> Source code in <code>fastauth/core/account.py</code> <pre><code>def confirm_email_change(\n    *,\n    users: UserAdapter,\n    email_changes: EmailChangeAdapter,\n    token: str,\n) -&gt; None:\n    \"\"\"\n    Confirm an email change with a verification token.\n\n    Args:\n        users: User adapter for database operations\n        email_changes: Email change adapter for database operations\n        token: Verification token\n\n    Raises:\n        EmailChangeError: If token is invalid or expired\n        EmailAlreadyExistsError: If the new email already exists\n    \"\"\"\n    token_hash = hash_refresh_token(token)\n\n    record = email_changes.get_valid(token_hash=token_hash)\n    if not record:\n        raise EmailChangeError(\"Invalid or expired email change token\")\n\n    expires_at = record.expires_at\n    if expires_at.tzinfo is None:\n        expires_at = expires_at.replace(tzinfo=UTC)\n\n    if expires_at &lt; datetime.now(UTC):\n        raise EmailChangeError(\"Expired email change token\")\n\n    # Check if email is still available\n    existing_user = users.get_by_email(record.new_email)\n    if existing_user:\n        raise EmailAlreadyExistsError(\n            f\"Email {record.new_email} is no longer available\"\n        )\n\n    users.update_email(user_id=record.user_id, new_email=record.new_email)\n    email_changes.mark_used(token_hash=token_hash)\n</code></pre>"},{"location":"reference/core/account/#fastauth.core.account.delete_account","title":"delete_account","text":"<pre><code>delete_account(\n    *,\n    users: UserAdapter,\n    sessions: SessionAdapter,\n    user_id: UUID,\n    password: str,\n    hard_delete: bool = False\n) -&gt; None\n</code></pre> <p>Delete a user account (soft or hard delete).</p> <p>Parameters:</p> Name Type Description Default <code>users</code> <code>UserAdapter</code> <p>User adapter for database operations</p> required <code>sessions</code> <code>SessionAdapter</code> <p>Session adapter for database operations</p> required <code>user_id</code> <code>UUID</code> <p>ID of the user to delete</p> required <code>password</code> <code>str</code> <p>Password for verification</p> required <code>hard_delete</code> <code>bool</code> <p>If True, permanently delete the user; if False, soft delete</p> <code>False</code> <p>Raises:</p> Type Description <code>UserNotFoundError</code> <p>If the user doesn't exist</p> <code>InvalidPasswordError</code> <p>If the password is incorrect</p> Source code in <code>fastauth/core/account.py</code> <pre><code>def delete_account(\n    *,\n    users: UserAdapter,\n    sessions: SessionAdapter,\n    user_id: uuid.UUID,\n    password: str,\n    hard_delete: bool = False,\n) -&gt; None:\n    \"\"\"\n    Delete a user account (soft or hard delete).\n\n    Args:\n        users: User adapter for database operations\n        sessions: Session adapter for database operations\n        user_id: ID of the user to delete\n        password: Password for verification\n        hard_delete: If True, permanently delete the user; if False, soft delete\n\n    Raises:\n        UserNotFoundError: If the user doesn't exist\n        InvalidPasswordError: If the password is incorrect\n    \"\"\"\n    user = users.get_by_id(user_id)\n    if not user:\n        raise UserNotFoundError(\"User not found\")\n\n    if not verify_password(user.hashed_password, password):\n        raise InvalidPasswordError(\"Password is incorrect\")\n\n    # Delete all user sessions\n    sessions.delete_user_sessions(user_id=user_id)\n\n    # Delete the user\n    if hard_delete:\n        users.hard_delete_user(user_id=user_id)\n    else:\n        users.soft_delete_user(user_id=user_id)\n</code></pre>"},{"location":"reference/core/email_verification/","title":"Email Verification","text":""},{"location":"reference/core/email_verification/#fastauth.core.email_verification","title":"email_verification","text":""},{"location":"reference/core/email_verification/#fastauth.core.email_verification-classes","title":"Classes","text":""},{"location":"reference/core/hashing/","title":"Hashing","text":""},{"location":"reference/core/hashing/#fastauth.core.hashing","title":"hashing","text":""},{"location":"reference/core/hashing/#fastauth.core.hashing-functions","title":"Functions","text":""},{"location":"reference/core/hashing/#fastauth.core.hashing.hash_password","title":"hash_password","text":"<pre><code>hash_password(password: str) -&gt; str\n</code></pre> <p>Hash a plaintext password using Argon2.</p> Source code in <code>fastauth/core/hashing.py</code> <pre><code>def hash_password(password: str) -&gt; str:\n    \"\"\"\n    Hash a plaintext password using Argon2.\n    \"\"\"\n    return _password_hasher.hash(password)\n</code></pre>"},{"location":"reference/core/hashing/#fastauth.core.hashing.verify_password","title":"verify_password","text":"<pre><code>verify_password(hashed_password: str, plain_password: str) -&gt; bool\n</code></pre> <p>Verify a plaintext password against a stored hash.</p> Source code in <code>fastauth/core/hashing.py</code> <pre><code>def verify_password(hashed_password: str, plain_password: str) -&gt; bool:\n    \"\"\"\n    Verify a plaintext password against a stored hash.\n    \"\"\"\n    try:\n        return _password_hasher.verify(hashed_password, plain_password)\n    except VerifyMismatchError:\n        return False\n</code></pre>"},{"location":"reference/core/oauth/","title":"Oauth","text":""},{"location":"reference/core/oauth/#fastauth.core.oauth","title":"oauth","text":""},{"location":"reference/core/oauth/#fastauth.core.oauth-classes","title":"Classes","text":""},{"location":"reference/core/oauth/#fastauth.core.oauth.OAuthError","title":"OAuthError","text":"<p>             Bases: <code>Exception</code></p> <p>Base exception for OAuth errors.</p>"},{"location":"reference/core/oauth/#fastauth.core.oauth.OAuthStateError","title":"OAuthStateError","text":"<p>             Bases: <code>Exception</code></p> <p>Raised when OAuth state token is invalid or expired.</p>"},{"location":"reference/core/oauth/#fastauth.core.oauth.OAuthAccountAlreadyLinkedError","title":"OAuthAccountAlreadyLinkedError","text":"<p>             Bases: <code>Exception</code></p> <p>Raised when OAuth account is already linked to a different user.</p>"},{"location":"reference/core/oauth/#fastauth.core.oauth.OAuthProviderNotFoundError","title":"OAuthProviderNotFoundError","text":"<p>             Bases: <code>Exception</code></p> <p>Raised when OAuth provider is not found.</p>"},{"location":"reference/core/oauth/#fastauth.core.oauth-functions","title":"Functions","text":""},{"location":"reference/core/oauth/#fastauth.core.oauth.initiate_oauth_flow","title":"initiate_oauth_flow","text":"<pre><code>initiate_oauth_flow(\n    *,\n    states: OAuthStateAdapter,\n    provider: OAuthProvider,\n    redirect_uri: str,\n    user_id: UUID | None = None,\n    use_pkce: bool = True,\n    state_ttl_minutes: int = 10\n) -&gt; tuple[str, str, str | None]\n</code></pre> <p>Initiate OAuth authorization flow.</p> <p>Generates state token for CSRF protection and optional PKCE challenge. Stores state in database and builds authorization URL.</p> <p>Parameters:</p> Name Type Description Default <code>states</code> <code>OAuthStateAdapter</code> <p>OAuth state adapter for database operations</p> required <code>provider</code> <code>OAuthProvider</code> <p>OAuth provider instance</p> required <code>redirect_uri</code> <code>str</code> <p>Callback URL after authorization</p> required <code>user_id</code> <code>UUID | None</code> <p>Optional user ID for linking mode (logged-in user)</p> <code>None</code> <code>use_pkce</code> <code>bool</code> <p>Whether to use PKCE for enhanced security (default: True)</p> <code>True</code> <code>state_ttl_minutes</code> <code>int</code> <p>State token time-to-live in minutes (default: 10)</p> <code>10</code> <p>Returns:</p> Type Description <code>str</code> <p>Tuple of (authorization_url, state_token, code_verifier)</p> <code>str</code> <p>code_verifier is None if PKCE is disabled</p> Example <p>auth_url, state, verifier = initiate_oauth_flow( ...     states=state_adapter, ...     provider=google_provider, ...     redirect_uri=\"https://example.com/oauth/callback\", ...     use_pkce=True, ... )</p> Source code in <code>fastauth/core/oauth.py</code> <pre><code>def initiate_oauth_flow(\n    *,\n    states: OAuthStateAdapter,\n    provider: OAuthProvider,\n    redirect_uri: str,\n    user_id: uuid.UUID | None = None,\n    use_pkce: bool = True,\n    state_ttl_minutes: int = 10,\n) -&gt; tuple[str, str, str | None]:\n    \"\"\"\n    Initiate OAuth authorization flow.\n\n    Generates state token for CSRF protection and optional PKCE challenge.\n    Stores state in database and builds authorization URL.\n\n    Args:\n        states: OAuth state adapter for database operations\n        provider: OAuth provider instance\n        redirect_uri: Callback URL after authorization\n        user_id: Optional user ID for linking mode (logged-in user)\n        use_pkce: Whether to use PKCE for enhanced security (default: True)\n        state_ttl_minutes: State token time-to-live in minutes (default: 10)\n\n    Returns:\n        Tuple of (authorization_url, state_token, code_verifier)\n        code_verifier is None if PKCE is disabled\n\n    Example:\n        &gt;&gt;&gt; auth_url, state, verifier = initiate_oauth_flow(\n        ...     states=state_adapter,\n        ...     provider=google_provider,\n        ...     redirect_uri=\"https://example.com/oauth/callback\",\n        ...     use_pkce=True,\n        ... )\n    \"\"\"\n    state_token = generate_state_token()\n    state_hash = hash_state_token(state_token)\n\n    code_verifier = None\n    code_challenge = None\n    code_challenge_method = None\n\n    if use_pkce:\n        code_verifier = generate_code_verifier()\n        code_challenge = generate_code_challenge(code_verifier)\n        code_challenge_method = \"S256\"\n\n    expires_at = datetime.now(UTC) + timedelta(minutes=state_ttl_minutes)\n\n    states.create(\n        state_hash=state_hash,\n        provider=provider.name,\n        redirect_uri=redirect_uri,\n        code_challenge=code_challenge,\n        code_challenge_method=code_challenge_method,\n        user_id=user_id,\n        expires_at=expires_at,\n    )\n\n    authorization_url = build_authorization_url(\n        auth_endpoint=provider.authorization_endpoint,\n        client_id=provider.client_id,\n        redirect_uri=redirect_uri,\n        state=state_token,\n        scope=provider.default_scopes,\n        code_challenge=code_challenge,\n    )\n\n    return authorization_url, state_token, code_verifier\n</code></pre>"},{"location":"reference/core/oauth/#fastauth.core.oauth.complete_oauth_flow","title":"complete_oauth_flow  <code>async</code>","text":"<pre><code>complete_oauth_flow(\n    *,\n    states: OAuthStateAdapter,\n    oauth_accounts: OAuthAccountAdapter,\n    users: UserAdapter,\n    provider: OAuthProvider,\n    code: str,\n    state: str,\n    code_verifier: str | None = None\n) -&gt; tuple[object, bool]\n</code></pre> <p>Complete OAuth authorization flow.</p> <p>Validates state token, exchanges code for tokens, fetches user info, and handles account linking logic.</p> <p>Account Linking Strategy: 1. If OAuth account exists \u2192 update tokens, return existing user 2. If user_id in state (linking mode) \u2192 link OAuth to that user 3. If user exists by email (verified) \u2192 auto-link OAuth account 4. If new user \u2192 create user with random password, mark verified, link OAuth</p> <p>Parameters:</p> Name Type Description Default <code>states</code> <code>OAuthStateAdapter</code> <p>OAuth state adapter</p> required <code>oauth_accounts</code> <code>OAuthAccountAdapter</code> <p>OAuth account adapter</p> required <code>users</code> <code>UserAdapter</code> <p>User adapter</p> required <code>provider</code> <code>OAuthProvider</code> <p>OAuth provider instance</p> required <code>code</code> <code>str</code> <p>Authorization code from OAuth callback</p> required <code>state</code> <code>str</code> <p>State token from OAuth callback</p> required <code>code_verifier</code> <code>str | None</code> <p>Optional PKCE code verifier</p> <code>None</code> <p>Returns:</p> Type Description <code>tuple[object, bool]</code> <p>Tuple of (user, is_new_user)</p> <p>Raises:</p> Type Description <code>OAuthStateError</code> <p>If state token is invalid or expired</p> <code>OAuthAccountAlreadyLinkedError</code> <p>If OAuth account is linked to different user</p> <code>OAuthError</code> <p>If OAuth flow fails for any reason</p> Source code in <code>fastauth/core/oauth.py</code> <pre><code>async def complete_oauth_flow(\n    *,\n    states: OAuthStateAdapter,\n    oauth_accounts: OAuthAccountAdapter,\n    users: UserAdapter,\n    provider: OAuthProvider,\n    code: str,\n    state: str,\n    code_verifier: str | None = None,\n) -&gt; tuple[object, bool]:\n    \"\"\"\n    Complete OAuth authorization flow.\n\n    Validates state token, exchanges code for tokens, fetches user info,\n    and handles account linking logic.\n\n    Account Linking Strategy:\n    1. If OAuth account exists \u2192 update tokens, return existing user\n    2. If user_id in state (linking mode) \u2192 link OAuth to that user\n    3. If user exists by email (verified) \u2192 auto-link OAuth account\n    4. If new user \u2192 create user with random password, mark verified, link OAuth\n\n    Args:\n        states: OAuth state adapter\n        oauth_accounts: OAuth account adapter\n        users: User adapter\n        provider: OAuth provider instance\n        code: Authorization code from OAuth callback\n        state: State token from OAuth callback\n        code_verifier: Optional PKCE code verifier\n\n    Returns:\n        Tuple of (user, is_new_user)\n\n    Raises:\n        OAuthStateError: If state token is invalid or expired\n        OAuthAccountAlreadyLinkedError: If OAuth account is linked to different user\n        OAuthError: If OAuth flow fails for any reason\n    \"\"\"\n    state_hash = hash_state_token(state)\n    state_record = states.get_valid(state_hash=state_hash)\n\n    if not state_record:\n        raise OAuthStateError(\"Invalid or expired state token\")\n\n    expires_at = state_record.expires_at\n    if expires_at.tzinfo is None:\n        expires_at = expires_at.replace(tzinfo=UTC)\n\n    if expires_at &lt; datetime.now(UTC):\n        raise OAuthStateError(\"State token has expired\")\n\n    states.mark_used(state_hash=state_hash)\n\n    try:\n        oauth_tokens = await provider.exchange_code_for_tokens(\n            code=code,\n            redirect_uri=state_record.redirect_uri,\n            code_verifier=code_verifier,\n        )\n\n        user_info = await provider.get_user_info(access_token=oauth_tokens.access_token)\n\n    except Exception as e:\n        raise OAuthError(f\"Failed to complete OAuth flow: {e!s}\") from e\n\n    access_token_hash = hash_oauth_token(oauth_tokens.access_token)\n    refresh_token_hash = (\n        hash_oauth_token(oauth_tokens.refresh_token)\n        if oauth_tokens.refresh_token\n        else None\n    )\n\n    token_expires_at = None\n    if oauth_tokens.expires_in:\n        token_expires_at = datetime.now(UTC) + timedelta(\n            seconds=oauth_tokens.expires_in\n        )\n\n    existing_oauth_account = oauth_accounts.get_by_provider_user_id(\n        provider=provider.name,\n        provider_user_id=user_info.provider_user_id,\n    )\n\n    if existing_oauth_account:\n        oauth_accounts.update_tokens(\n            account_id=existing_oauth_account.id,\n            access_token_hash=access_token_hash,\n            refresh_token_hash=refresh_token_hash,\n            expires_at=token_expires_at,\n        )\n\n        user = users.get_by_id(user_id=existing_oauth_account.user_id)\n        if not user:\n            raise OAuthError(\"User not found for existing OAuth account\")\n\n        return user, False\n\n    if state_record.user_id:\n        user = users.get_by_id(user_id=state_record.user_id)\n        if not user:\n            raise OAuthError(\"User not found for linking\")\n\n        oauth_accounts.create(\n            user_id=user.id,\n            provider=provider.name,\n            provider_user_id=user_info.provider_user_id,\n            access_token_hash=access_token_hash,\n            refresh_token_hash=refresh_token_hash,\n            expires_at=token_expires_at,\n            email=user_info.email,\n            name=user_info.name,\n            avatar_url=user_info.avatar_url,\n        )\n\n        return user, False\n\n    existing_user = users.get_by_email(email=user_info.email)\n\n    if existing_user:\n        if not existing_user.is_verified:\n            raise OAuthError(\n                f\"Cannot auto-link OAuth account. User with email {user_info.email} \"\n                \"exists but email is not verified. Please verify email first or \"\n                \"login and manually link the OAuth account.\"\n            )\n\n        if not user_info.email_verified:\n            raise OAuthError(\n                f\"Cannot auto-link OAuth account. Email {user_info.email} is not \"\n                \"verified by the OAuth provider.\"\n            )\n\n        oauth_accounts.create(\n            user_id=existing_user.id,\n            provider=provider.name,\n            provider_user_id=user_info.provider_user_id,\n            access_token_hash=access_token_hash,\n            refresh_token_hash=refresh_token_hash,\n            expires_at=token_expires_at,\n            email=user_info.email,\n            name=user_info.name,\n            avatar_url=user_info.avatar_url,\n        )\n\n        return existing_user, False\n\n    random_password = secrets.token_urlsafe(32)\n    hashed_password = hash_password(random_password)\n\n    user = users.create_user(\n        email=user_info.email,\n        hashed_password=hashed_password,\n    )\n\n    if user_info.email_verified:\n        users.mark_verified(user.id)\n\n    oauth_accounts.create(\n        user_id=user.id,\n        provider=provider.name,\n        provider_user_id=user_info.provider_user_id,\n        access_token_hash=access_token_hash,\n        refresh_token_hash=refresh_token_hash,\n        expires_at=token_expires_at,\n        email=user_info.email,\n        name=user_info.name,\n        avatar_url=user_info.avatar_url,\n    )\n\n    return user, True\n</code></pre>"},{"location":"reference/core/oauth/#fastauth.core.oauth.unlink_oauth_account","title":"unlink_oauth_account","text":"<pre><code>unlink_oauth_account(\n    *, oauth_accounts: OAuthAccountAdapter, user_id: UUID, provider: str\n) -&gt; None\n</code></pre> <p>Unlink an OAuth provider from a user's account.</p> <p>Parameters:</p> Name Type Description Default <code>oauth_accounts</code> <code>OAuthAccountAdapter</code> <p>OAuth account adapter</p> required <code>user_id</code> <code>UUID</code> <p>User ID to unlink from</p> required <code>provider</code> <code>str</code> <p>Provider name (e.g., 'google', 'github')</p> required <p>Raises:</p> Type Description <code>OAuthError</code> <p>If OAuth account not found</p> Source code in <code>fastauth/core/oauth.py</code> <pre><code>def unlink_oauth_account(\n    *,\n    oauth_accounts: OAuthAccountAdapter,\n    user_id: uuid.UUID,\n    provider: str,\n) -&gt; None:\n    \"\"\"\n    Unlink an OAuth provider from a user's account.\n\n    Args:\n        oauth_accounts: OAuth account adapter\n        user_id: User ID to unlink from\n        provider: Provider name (e.g., 'google', 'github')\n\n    Raises:\n        OAuthError: If OAuth account not found\n    \"\"\"\n    accounts = oauth_accounts.get_by_user_id(user_id=user_id, provider=provider)\n\n    if not accounts:\n        raise OAuthError(f\"No {provider} account linked to this user\")\n\n    for account in accounts:\n        oauth_accounts.delete(account_id=account.id)\n</code></pre>"},{"location":"reference/core/oauth/#fastauth.core.oauth.get_linked_accounts","title":"get_linked_accounts","text":"<pre><code>get_linked_accounts(\n    *, oauth_accounts: OAuthAccountAdapter, user_id: UUID\n) -&gt; list\n</code></pre> <p>Get all OAuth accounts linked to a user.</p> <p>Parameters:</p> Name Type Description Default <code>oauth_accounts</code> <code>OAuthAccountAdapter</code> <p>OAuth account adapter</p> required <code>user_id</code> <code>UUID</code> <p>User ID to get linked accounts for</p> required <p>Returns:</p> Type Description <code>list</code> <p>List of OAuth account records</p> Source code in <code>fastauth/core/oauth.py</code> <pre><code>def get_linked_accounts(\n    *,\n    oauth_accounts: OAuthAccountAdapter,\n    user_id: uuid.UUID,\n) -&gt; list:\n    \"\"\"\n    Get all OAuth accounts linked to a user.\n\n    Args:\n        oauth_accounts: OAuth account adapter\n        user_id: User ID to get linked accounts for\n\n    Returns:\n        List of OAuth account records\n    \"\"\"\n    return oauth_accounts.get_by_user_id(user_id=user_id)\n</code></pre>"},{"location":"reference/core/password_reset/","title":"Password Reset","text":""},{"location":"reference/core/password_reset/#fastauth.core.password_reset","title":"password_reset","text":""},{"location":"reference/core/password_reset/#fastauth.core.password_reset-classes","title":"Classes","text":""},{"location":"reference/core/password_reset/#fastauth.core.password_reset-functions","title":"Functions","text":""},{"location":"reference/core/refresh_tokens/","title":"Refresh Tokens","text":""},{"location":"reference/core/refresh_tokens/#fastauth.core.refresh_tokens","title":"refresh_tokens","text":""},{"location":"reference/core/refresh_tokens/#fastauth.core.refresh_tokens-functions","title":"Functions","text":""},{"location":"reference/core/roles/","title":"Roles","text":""},{"location":"reference/core/roles/#fastauth.core.roles","title":"roles","text":""},{"location":"reference/core/roles/#fastauth.core.roles-classes","title":"Classes","text":""},{"location":"reference/core/roles/#fastauth.core.roles.RoleNotFoundError","title":"RoleNotFoundError","text":"<p>             Bases: <code>Exception</code></p> <p>Raised when a role is not found.</p>"},{"location":"reference/core/roles/#fastauth.core.roles.PermissionNotFoundError","title":"PermissionNotFoundError","text":"<p>             Bases: <code>Exception</code></p> <p>Raised when a permission is not found.</p>"},{"location":"reference/core/roles/#fastauth.core.roles.RoleAlreadyExistsError","title":"RoleAlreadyExistsError","text":"<p>             Bases: <code>Exception</code></p> <p>Raised when trying to create a role that already exists.</p>"},{"location":"reference/core/roles/#fastauth.core.roles.PermissionAlreadyExistsError","title":"PermissionAlreadyExistsError","text":"<p>             Bases: <code>Exception</code></p> <p>Raised when trying to create a permission that already exists.</p>"},{"location":"reference/core/roles/#fastauth.core.roles-functions","title":"Functions","text":""},{"location":"reference/core/roles/#fastauth.core.roles.create_role","title":"create_role","text":"<pre><code>create_role(\n    *, roles: RoleAdapter, name: str, description: str | None = None\n) -&gt; Any\n</code></pre> <p>Create a new role.</p> <p>Parameters:</p> Name Type Description Default <code>roles</code> <code>RoleAdapter</code> <p>Role adapter for database operations</p> required <code>name</code> <code>str</code> <p>Unique role name</p> required <code>description</code> <code>str | None</code> <p>Optional role description</p> <code>None</code> <p>Returns:</p> Type Description <code>Any</code> <p>Created role object</p> <p>Raises:</p> Type Description <code>RoleAlreadyExistsError</code> <p>If a role with the name already exists</p> Source code in <code>fastauth/core/roles.py</code> <pre><code>def create_role(\n    *,\n    roles: RoleAdapter,\n    name: str,\n    description: str | None = None,\n) -&gt; Any:\n    \"\"\"\n    Create a new role.\n\n    Args:\n        roles: Role adapter for database operations\n        name: Unique role name\n        description: Optional role description\n\n    Returns:\n        Created role object\n\n    Raises:\n        RoleAlreadyExistsError: If a role with the name already exists\n    \"\"\"\n    existing_role = roles.get_role_by_name(name=name)\n\n    if existing_role:\n        raise RoleAlreadyExistsError(f\"Role with name {name} already exists\")\n\n    role = roles.create_role(name=name, description=description)\n\n    return role\n</code></pre>"},{"location":"reference/core/roles/#fastauth.core.roles.create_permission","title":"create_permission","text":"<pre><code>create_permission(\n    *, roles: RoleAdapter, name: str, description: str | None = None\n) -&gt; Any\n</code></pre> <p>Create a new permission.</p> <p>Parameters:</p> Name Type Description Default <code>roles</code> <code>RoleAdapter</code> <p>Role adapter for database operations</p> required <code>name</code> <code>str</code> <p>Unique permission name</p> required <code>description</code> <code>str | None</code> <p>Optional permission description</p> <code>None</code> <p>Returns:</p> Type Description <code>Any</code> <p>Created permission object</p> <p>Raises:</p> Type Description <code>PermissionAlreadyExistsError</code> <p>If a permission with the name already exists</p> Source code in <code>fastauth/core/roles.py</code> <pre><code>def create_permission(\n    *,\n    roles: RoleAdapter,\n    name: str,\n    description: str | None = None,\n) -&gt; Any:\n    \"\"\"\n    Create a new permission.\n\n    Args:\n        roles: Role adapter for database operations\n        name: Unique permission name\n        description: Optional permission description\n\n    Returns:\n        Created permission object\n\n    Raises:\n        PermissionAlreadyExistsError: If a permission with the name already exists\n    \"\"\"\n    existing_permission = roles.get_permission_by_name(name=name)\n\n    if existing_permission:\n        raise PermissionAlreadyExistsError(\n            f\"Permission with name {name} already exists\"\n        )\n\n    permission = roles.create_permission(name=name, description=description)\n\n    return permission\n</code></pre>"},{"location":"reference/core/roles/#fastauth.core.roles.assign_role","title":"assign_role","text":"<pre><code>assign_role(*, roles: RoleAdapter, user_id: UUID, role_name: str) -&gt; None\n</code></pre> <p>Assign a role to a user by role name.</p> <p>Parameters:</p> Name Type Description Default <code>roles</code> <code>RoleAdapter</code> <p>Role adapter for database operations</p> required <code>user_id</code> <code>UUID</code> <p>User's unique identifier</p> required <code>role_name</code> <code>str</code> <p>Name of the role to assign</p> required <p>Raises:</p> Type Description <code>RoleNotFoundError</code> <p>If the role does not exist</p> Source code in <code>fastauth/core/roles.py</code> <pre><code>def assign_role(\n    *,\n    roles: RoleAdapter,\n    user_id: uuid.UUID,\n    role_name: str,\n) -&gt; None:\n    \"\"\"\n    Assign a role to a user by role name.\n\n    Args:\n        roles: Role adapter for database operations\n        user_id: User's unique identifier\n        role_name: Name of the role to assign\n\n    Raises:\n        RoleNotFoundError: If the role does not exist\n    \"\"\"\n    role = roles.get_role_by_name(name=role_name)\n\n    if not role:\n        raise RoleNotFoundError(f\"Role {role_name} not found\")\n\n    roles.assign_role_to_user(user_id=user_id, role_id=role.id)\n</code></pre>"},{"location":"reference/core/roles/#fastauth.core.roles.remove_role","title":"remove_role","text":"<pre><code>remove_role(*, roles: RoleAdapter, user_id: UUID, role_name: str) -&gt; None\n</code></pre> <p>Remove a role from a user by role name.</p> <p>Parameters:</p> Name Type Description Default <code>roles</code> <code>RoleAdapter</code> <p>Role adapter for database operations</p> required <code>user_id</code> <code>UUID</code> <p>User's unique identifier</p> required <code>role_name</code> <code>str</code> <p>Name of the role to remove</p> required <p>Raises:</p> Type Description <code>RoleNotFoundError</code> <p>If the role does not exist</p> Source code in <code>fastauth/core/roles.py</code> <pre><code>def remove_role(\n    *,\n    roles: RoleAdapter,\n    user_id: uuid.UUID,\n    role_name: str,\n) -&gt; None:\n    \"\"\"\n    Remove a role from a user by role name.\n\n    Args:\n        roles: Role adapter for database operations\n        user_id: User's unique identifier\n        role_name: Name of the role to remove\n\n    Raises:\n        RoleNotFoundError: If the role does not exist\n    \"\"\"\n    role = roles.get_role_by_name(name=role_name)\n\n    if not role:\n        raise RoleNotFoundError(f\"Role {role_name} not found\")\n\n    roles.remove_role_from_user(user_id=user_id, role_id=role.id)\n</code></pre>"},{"location":"reference/core/roles/#fastauth.core.roles.assign_permission_to_role","title":"assign_permission_to_role","text":"<pre><code>assign_permission_to_role(\n    *, roles: RoleAdapter, role_name: str, permission_name: str\n) -&gt; None\n</code></pre> <p>Assign a permission to a role by names.</p> <p>Parameters:</p> Name Type Description Default <code>roles</code> <code>RoleAdapter</code> <p>Role adapter for database operations</p> required <code>role_name</code> <code>str</code> <p>Name of the role</p> required <code>permission_name</code> <code>str</code> <p>Name of the permission to assign</p> required <p>Raises:</p> Type Description <code>RoleNotFoundError</code> <p>If the role does not exist</p> <code>PermissionNotFoundError</code> <p>If the permission does not exist</p> Source code in <code>fastauth/core/roles.py</code> <pre><code>def assign_permission_to_role(\n    *,\n    roles: RoleAdapter,\n    role_name: str,\n    permission_name: str,\n) -&gt; None:\n    \"\"\"\n    Assign a permission to a role by names.\n\n    Args:\n        roles: Role adapter for database operations\n        role_name: Name of the role\n        permission_name: Name of the permission to assign\n\n    Raises:\n        RoleNotFoundError: If the role does not exist\n        PermissionNotFoundError: If the permission does not exist\n    \"\"\"\n    role = roles.get_role_by_name(name=role_name)\n    if not role:\n        raise RoleNotFoundError(f\"Role {role_name} not found\")\n\n    permission = roles.get_permission_by_name(name=permission_name)\n    if not permission:\n        raise PermissionNotFoundError(f\"Permission {permission_name} not found\")\n\n    roles.assign_permission_to_role(role_id=role.id, permission_id=permission.id)\n</code></pre>"},{"location":"reference/core/roles/#fastauth.core.roles.check_permission","title":"check_permission","text":"<pre><code>check_permission(\n    *, roles: RoleAdapter, user_id: UUID, permission_name: str\n) -&gt; bool\n</code></pre> <p>Check if a user has a specific permission through any of their roles.</p> <p>Parameters:</p> Name Type Description Default <code>roles</code> <code>RoleAdapter</code> <p>Role adapter for database operations</p> required <code>user_id</code> <code>UUID</code> <p>User's unique identifier</p> required <code>permission_name</code> <code>str</code> <p>Name of the permission to check</p> required <p>Returns:</p> Type Description <code>bool</code> <p>True if user has the permission, False otherwise</p> Source code in <code>fastauth/core/roles.py</code> <pre><code>def check_permission(\n    *,\n    roles: RoleAdapter,\n    user_id: uuid.UUID,\n    permission_name: str,\n) -&gt; bool:\n    \"\"\"\n    Check if a user has a specific permission through any of their roles.\n\n    Args:\n        roles: Role adapter for database operations\n        user_id: User's unique identifier\n        permission_name: Name of the permission to check\n\n    Returns:\n        True if user has the permission, False otherwise\n    \"\"\"\n    user_permissions = roles.get_user_permissions(user_id=user_id)\n\n    return any(perm.name == permission_name for perm in user_permissions)\n</code></pre>"},{"location":"reference/core/roles/#fastauth.core.roles.get_user_roles","title":"get_user_roles","text":"<pre><code>get_user_roles(*, roles: RoleAdapter, user_id: UUID) -&gt; list[Any]\n</code></pre> <p>Get all roles assigned to a user.</p> <p>Parameters:</p> Name Type Description Default <code>roles</code> <code>RoleAdapter</code> <p>Role adapter for database operations</p> required <code>user_id</code> <code>UUID</code> <p>User's unique identifier</p> required <p>Returns:</p> Type Description <code>list[Any]</code> <p>List of role objects</p> Source code in <code>fastauth/core/roles.py</code> <pre><code>def get_user_roles(\n    *,\n    roles: RoleAdapter,\n    user_id: uuid.UUID,\n) -&gt; list[Any]:\n    \"\"\"\n    Get all roles assigned to a user.\n\n    Args:\n        roles: Role adapter for database operations\n        user_id: User's unique identifier\n\n    Returns:\n        List of role objects\n    \"\"\"\n    return roles.get_user_roles(user_id=user_id)\n</code></pre>"},{"location":"reference/core/roles/#fastauth.core.roles.get_user_permissions","title":"get_user_permissions","text":"<pre><code>get_user_permissions(*, roles: RoleAdapter, user_id: UUID) -&gt; list[Any]\n</code></pre> <p>Get all permissions for a user across all their roles.</p> <p>Parameters:</p> Name Type Description Default <code>roles</code> <code>RoleAdapter</code> <p>Role adapter for database operations</p> required <code>user_id</code> <code>UUID</code> <p>User's unique identifier</p> required <p>Returns:</p> Type Description <code>list[Any]</code> <p>List of permission objects</p> Source code in <code>fastauth/core/roles.py</code> <pre><code>def get_user_permissions(\n    *,\n    roles: RoleAdapter,\n    user_id: uuid.UUID,\n) -&gt; list[Any]:\n    \"\"\"\n    Get all permissions for a user across all their roles.\n\n    Args:\n        roles: Role adapter for database operations\n        user_id: User's unique identifier\n\n    Returns:\n        List of permission objects\n    \"\"\"\n    return roles.get_user_permissions(user_id=user_id)\n</code></pre>"},{"location":"reference/core/roles/#fastauth.core.roles.get_role_permissions","title":"get_role_permissions","text":"<pre><code>get_role_permissions(*, roles: RoleAdapter, role_name: str) -&gt; list[Any]\n</code></pre> <p>Get all permissions assigned to a role.</p> <p>Parameters:</p> Name Type Description Default <code>roles</code> <code>RoleAdapter</code> <p>Role adapter for database operations</p> required <code>role_name</code> <code>str</code> <p>Name of the role</p> required <p>Returns:</p> Type Description <code>list[Any]</code> <p>List of permission objects</p> <p>Raises:</p> Type Description <code>RoleNotFoundError</code> <p>If the role does not exist</p> Source code in <code>fastauth/core/roles.py</code> <pre><code>def get_role_permissions(\n    *,\n    roles: RoleAdapter,\n    role_name: str,\n) -&gt; list[Any]:\n    \"\"\"\n    Get all permissions assigned to a role.\n\n    Args:\n        roles: Role adapter for database operations\n        role_name: Name of the role\n\n    Returns:\n        List of permission objects\n\n    Raises:\n        RoleNotFoundError: If the role does not exist\n    \"\"\"\n    role = roles.get_role_by_name(name=role_name)\n\n    if not role:\n        raise RoleNotFoundError(f\"Role {role_name} not found\")\n\n    return roles.get_role_permissions(role_id=role.id)\n</code></pre>"},{"location":"reference/core/sessions/","title":"Sessions","text":""},{"location":"reference/core/sessions/#fastauth.core.sessions","title":"sessions","text":""},{"location":"reference/core/sessions/#fastauth.core.sessions-classes","title":"Classes","text":""},{"location":"reference/core/sessions/#fastauth.core.sessions.SessionNotFoundError","title":"SessionNotFoundError","text":"<p>             Bases: <code>Exception</code></p> <p>Raised when a session is not found.</p>"},{"location":"reference/core/sessions/#fastauth.core.sessions-functions","title":"Functions","text":""},{"location":"reference/core/sessions/#fastauth.core.sessions.create_session","title":"create_session","text":"<pre><code>create_session(\n    *,\n    sessions: SessionAdapter,\n    users: UserAdapter,\n    user_id: UUID,\n    device: str | None = None,\n    ip_address: str | None = None,\n    user_agent: str | None = None\n) -&gt; Any\n</code></pre> <p>Create a new session for a user.</p> <p>Parameters:</p> Name Type Description Default <code>sessions</code> <code>SessionAdapter</code> <p>Session adapter for database operations</p> required <code>users</code> <code>UserAdapter</code> <p>User adapter for database operations</p> required <code>user_id</code> <code>UUID</code> <p>User's unique identifier</p> required <code>device</code> <code>str | None</code> <p>Device information</p> <code>None</code> <code>ip_address</code> <code>str | None</code> <p>IP address of the client</p> <code>None</code> <code>user_agent</code> <code>str | None</code> <p>User agent string</p> <code>None</code> <p>Returns:</p> Type Description <code>Any</code> <p>Created session object</p> Source code in <code>fastauth/core/sessions.py</code> <pre><code>def create_session(\n    *,\n    sessions: SessionAdapter,\n    users: UserAdapter,\n    user_id: uuid.UUID,\n    device: str | None = None,\n    ip_address: str | None = None,\n    user_agent: str | None = None,\n) -&gt; Any:\n    \"\"\"\n    Create a new session for a user.\n\n    Args:\n        sessions: Session adapter for database operations\n        users: User adapter for database operations\n        user_id: User's unique identifier\n        device: Device information\n        ip_address: IP address of the client\n        user_agent: User agent string\n\n    Returns:\n        Created session object\n    \"\"\"\n    session = sessions.create_session(\n        user_id=user_id,\n        device=device,\n        ip_address=ip_address,\n        user_agent=user_agent,\n    )\n\n    users.update_last_login(user_id=user_id)\n\n    return session\n</code></pre>"},{"location":"reference/core/sessions/#fastauth.core.sessions.get_user_sessions","title":"get_user_sessions","text":"<pre><code>get_user_sessions(*, sessions: SessionAdapter, user_id: UUID) -&gt; List[Any]\n</code></pre> <p>Get all active sessions for a user.</p> <p>Parameters:</p> Name Type Description Default <code>sessions</code> <code>SessionAdapter</code> <p>Session adapter for database operations</p> required <code>user_id</code> <code>UUID</code> <p>User's unique identifier</p> required <p>Returns:</p> Type Description <code>List[Any]</code> <p>List of session objects</p> Source code in <code>fastauth/core/sessions.py</code> <pre><code>def get_user_sessions(\n    *,\n    sessions: SessionAdapter,\n    user_id: uuid.UUID,\n) -&gt; List[Any]:\n    \"\"\"\n    Get all active sessions for a user.\n\n    Args:\n        sessions: Session adapter for database operations\n        user_id: User's unique identifier\n\n    Returns:\n        List of session objects\n    \"\"\"\n    return sessions.get_user_sessions(user_id)\n</code></pre>"},{"location":"reference/core/sessions/#fastauth.core.sessions.delete_session","title":"delete_session","text":"<pre><code>delete_session(\n    *, sessions: SessionAdapter, session_id: UUID, user_id: UUID\n) -&gt; None\n</code></pre> <p>Delete a specific session.</p> <p>Parameters:</p> Name Type Description Default <code>sessions</code> <code>SessionAdapter</code> <p>Session adapter for database operations</p> required <code>session_id</code> <code>UUID</code> <p>Session's unique identifier</p> required <code>user_id</code> <code>UUID</code> <p>User's unique identifier (for authorization)</p> required <p>Raises:</p> Type Description <code>SessionNotFoundError</code> <p>If session doesn't exist or doesn't belong to user</p> Source code in <code>fastauth/core/sessions.py</code> <pre><code>def delete_session(\n    *,\n    sessions: SessionAdapter,\n    session_id: uuid.UUID,\n    user_id: uuid.UUID,\n) -&gt; None:\n    \"\"\"\n    Delete a specific session.\n\n    Args:\n        sessions: Session adapter for database operations\n        session_id: Session's unique identifier\n        user_id: User's unique identifier (for authorization)\n\n    Raises:\n        SessionNotFoundError: If session doesn't exist or doesn't belong to user\n    \"\"\"\n    session = sessions.get_session_by_id(session_id)\n\n    if not session or session.user_id != user_id:\n        raise SessionNotFoundError(\"Session not found\")\n\n    sessions.delete_session(session_id)\n</code></pre>"},{"location":"reference/core/sessions/#fastauth.core.sessions.delete_all_user_sessions","title":"delete_all_user_sessions","text":"<pre><code>delete_all_user_sessions(\n    *,\n    sessions: SessionAdapter,\n    user_id: UUID,\n    except_session_id: UUID | None = None\n) -&gt; None\n</code></pre> <p>Delete all sessions for a user, optionally excluding the current session.</p> <p>Parameters:</p> Name Type Description Default <code>sessions</code> <code>SessionAdapter</code> <p>Session adapter for database operations</p> required <code>user_id</code> <code>UUID</code> <p>User's unique identifier</p> required <code>except_session_id</code> <code>UUID | None</code> <p>Optional session ID to keep (current session)</p> <code>None</code> Source code in <code>fastauth/core/sessions.py</code> <pre><code>def delete_all_user_sessions(\n    *,\n    sessions: SessionAdapter,\n    user_id: uuid.UUID,\n    except_session_id: uuid.UUID | None = None,\n) -&gt; None:\n    \"\"\"\n    Delete all sessions for a user, optionally excluding the current session.\n\n    Args:\n        sessions: Session adapter for database operations\n        user_id: User's unique identifier\n        except_session_id: Optional session ID to keep (current session)\n    \"\"\"\n    sessions.delete_user_sessions(\n        user_id=user_id,\n        except_session_id=except_session_id,\n    )\n</code></pre>"},{"location":"reference/core/sessions/#fastauth.core.sessions.update_session_activity","title":"update_session_activity","text":"<pre><code>update_session_activity(*, sessions: SessionAdapter, session_id: UUID) -&gt; None\n</code></pre> <p>Update the last active timestamp for a session.</p> <p>Parameters:</p> Name Type Description Default <code>sessions</code> <code>SessionAdapter</code> <p>Session adapter for database operations</p> required <code>session_id</code> <code>UUID</code> <p>Session's unique identifier</p> required Source code in <code>fastauth/core/sessions.py</code> <pre><code>def update_session_activity(\n    *,\n    sessions: SessionAdapter,\n    session_id: uuid.UUID,\n) -&gt; None:\n    \"\"\"\n    Update the last active timestamp for a session.\n\n    Args:\n        sessions: Session adapter for database operations\n        session_id: Session's unique identifier\n    \"\"\"\n    sessions.update_last_active(session_id)\n</code></pre>"},{"location":"reference/core/sessions/#fastauth.core.sessions.cleanup_inactive_sessions","title":"cleanup_inactive_sessions","text":"<pre><code>cleanup_inactive_sessions(\n    *, sessions: SessionAdapter, inactive_days: int = 30\n) -&gt; None\n</code></pre> <p>Remove sessions that haven't been active for a specified number of days.</p> <p>Parameters:</p> Name Type Description Default <code>sessions</code> <code>SessionAdapter</code> <p>Session adapter for database operations</p> required <code>inactive_days</code> <code>int</code> <p>Number of days of inactivity before cleanup (default: 30)</p> <code>30</code> Source code in <code>fastauth/core/sessions.py</code> <pre><code>def cleanup_inactive_sessions(\n    *,\n    sessions: SessionAdapter,\n    inactive_days: int = 30,\n) -&gt; None:\n    \"\"\"\n    Remove sessions that haven't been active for a specified number of days.\n\n    Args:\n        sessions: Session adapter for database operations\n        inactive_days: Number of days of inactivity before cleanup (default: 30)\n    \"\"\"\n    sessions.cleanup_inactive_sessions(inactive_days)\n</code></pre>"},{"location":"reference/core/users/","title":"Users","text":""},{"location":"reference/core/users/#fastauth.core.users","title":"users","text":""},{"location":"reference/core/users/#fastauth.core.users-classes","title":"Classes","text":""},{"location":"reference/core/users/#fastauth.core.users.UserAlreadyExistsError","title":"UserAlreadyExistsError","text":"<p>             Bases: <code>Exception</code></p> <p>Raised when trying to create a user with an existing email.</p>"},{"location":"reference/core/users/#fastauth.core.users.InvalidCredentialsError","title":"InvalidCredentialsError","text":"<p>             Bases: <code>Exception</code></p> <p>Raised when login credentials are invalid.</p>"},{"location":"reference/core/users/#fastauth.core.users.EmailNotVerifiedError","title":"EmailNotVerifiedError","text":"<p>             Bases: <code>Exception</code></p> <p>Raised when email is not verified</p>"},{"location":"reference/core/users/#fastauth.core.users-functions","title":"Functions","text":""},{"location":"reference/core/users/#fastauth.core.users.create_user","title":"create_user","text":"<pre><code>create_user(*, users: UserAdapter, email: str, password: str) -&gt; Any\n</code></pre> <p>Create a new user with a hashed password.</p> <p>Parameters:</p> Name Type Description Default <code>users</code> <code>UserAdapter</code> <p>User adapter for database operations</p> required <code>email</code> <code>str</code> <p>User's email address</p> required <code>password</code> <code>str</code> <p>Plain text password (will be hashed)</p> required <p>Returns:</p> Type Description <code>Any</code> <p>Created user object</p> <p>Raises:</p> Type Description <code>UserAlreadyExistsError</code> <p>If a user with the email already exists</p> Source code in <code>fastauth/core/users.py</code> <pre><code>def create_user(\n    *,\n    users: UserAdapter,\n    email: str,\n    password: str,\n) -&gt; Any:\n    \"\"\"\n    Create a new user with a hashed password.\n\n    Args:\n        users: User adapter for database operations\n        email: User's email address\n        password: Plain text password (will be hashed)\n\n    Returns:\n        Created user object\n\n    Raises:\n        UserAlreadyExistsError: If a user with the email already exists\n    \"\"\"\n\n    existing_user = users.get_by_email(email=email)\n\n    if existing_user:\n        raise UserAlreadyExistsError(f\"User with email {email} already exists\")\n\n    user = users.create_user(email=email, hashed_password=hash_password(password))\n\n    return user\n</code></pre>"},{"location":"reference/core/users/#fastauth.core.users.authenticate_user","title":"authenticate_user","text":"<pre><code>authenticate_user(*, users: UserAdapter, email: str, password: str) -&gt; Any\n</code></pre> <p>Authenticate a user by email and password.</p> <p>Parameters:</p> Name Type Description Default <code>users</code> <code>UserAdapter</code> <p>User adapter for database operations</p> required <code>email</code> <code>str</code> <p>User's email address</p> required <code>password</code> <code>str</code> <p>Plain text password to verify</p> required <p>Returns:</p> Type Description <code>Any</code> <p>Authenticated user object</p> <p>Raises:</p> Type Description <code>InvalidCredentialsError</code> <p>If email doesn't exist, password is wrong,             or user is inactive</p> <code>EmailNotVerifiedError</code> <p>If email verification is required but not completed</p> Source code in <code>fastauth/core/users.py</code> <pre><code>def authenticate_user(\n    *,\n    users: UserAdapter,\n    email: str,\n    password: str,\n) -&gt; Any:\n    \"\"\"\n    Authenticate a user by email and password.\n\n    Args:\n        users: User adapter for database operations\n        email: User's email address\n        password: Plain text password to verify\n\n    Returns:\n        Authenticated user object\n\n    Raises:\n        InvalidCredentialsError: If email doesn't exist, password is wrong, \\\n            or user is inactive\n        EmailNotVerifiedError: If email verification is required but not completed\n    \"\"\"\n\n    user = users.get_by_email(email=email)\n\n    if not user:\n        raise InvalidCredentialsError(\"Invalid email or password\")\n\n    if not verify_password(user.hashed_password, password):\n        raise InvalidCredentialsError\n\n    if settings.require_email_verification and not user.is_verified:\n        raise EmailNotVerifiedError\n\n    if not user.is_active:\n        raise InvalidCredentialsError(\"User is inactive\")\n\n    return user\n</code></pre>"},{"location":"reference/email/base/","title":"Base","text":""},{"location":"reference/email/base/#fastauth.email.base","title":"base","text":""},{"location":"reference/email/console/","title":"Console","text":""},{"location":"reference/email/console/#fastauth.email.console","title":"console","text":""},{"location":"reference/email/factory/","title":"Factory","text":""},{"location":"reference/email/factory/#fastauth.email.factory","title":"factory","text":""},{"location":"reference/email/smtp/","title":"Smtp","text":""},{"location":"reference/email/smtp/#fastauth.email.smtp","title":"smtp","text":""},{"location":"reference/providers/base/","title":"Base","text":""},{"location":"reference/providers/base/#fastauth.providers.base","title":"base","text":""},{"location":"reference/providers/base/#fastauth.providers.base-classes","title":"Classes","text":""},{"location":"reference/providers/base/#fastauth.providers.base.OAuthUserInfo","title":"OAuthUserInfo  <code>dataclass</code>","text":"<pre><code>OAuthUserInfo(\n    provider_user_id: str,\n    email: str,\n    email_verified: bool,\n    name: str | None = None,\n    avatar_url: str | None = None,\n)\n</code></pre> <p>User information returned from OAuth provider.</p>"},{"location":"reference/providers/base/#fastauth.providers.base.OAuthTokens","title":"OAuthTokens  <code>dataclass</code>","text":"<pre><code>OAuthTokens(\n    access_token: str,\n    refresh_token: str | None = None,\n    expires_in: int | None = None,\n    token_type: str = \"Bearer\",\n)\n</code></pre> <p>Tokens returned from OAuth provider.</p>"},{"location":"reference/providers/base/#fastauth.providers.base.OAuthProvider","title":"OAuthProvider","text":"<p>             Bases: <code>ABC</code></p> <p>Abstract base class for OAuth providers.</p> <p>Each provider (Google, GitHub, etc.) implements this interface.</p>"},{"location":"reference/providers/base/#fastauth.providers.base.OAuthProvider-attributes","title":"Attributes","text":""},{"location":"reference/providers/base/#fastauth.providers.base.OAuthProvider.name","title":"name  <code>abstractmethod</code> <code>property</code>","text":"<pre><code>name: str\n</code></pre> <p>Provider name (e.g., 'google', 'github').</p>"},{"location":"reference/providers/base/#fastauth.providers.base.OAuthProvider.authorization_endpoint","title":"authorization_endpoint  <code>abstractmethod</code> <code>property</code>","text":"<pre><code>authorization_endpoint: str\n</code></pre> <p>OAuth authorization URL.</p>"},{"location":"reference/providers/base/#fastauth.providers.base.OAuthProvider.token_endpoint","title":"token_endpoint  <code>abstractmethod</code> <code>property</code>","text":"<pre><code>token_endpoint: str\n</code></pre> <p>OAuth token exchange URL.</p>"},{"location":"reference/providers/base/#fastauth.providers.base.OAuthProvider.user_info_endpoint","title":"user_info_endpoint  <code>abstractmethod</code> <code>property</code>","text":"<pre><code>user_info_endpoint: str\n</code></pre> <p>User info API endpoint.</p>"},{"location":"reference/providers/base/#fastauth.providers.base.OAuthProvider.default_scopes","title":"default_scopes  <code>abstractmethod</code> <code>property</code>","text":"<pre><code>default_scopes: str\n</code></pre> <p>Default OAuth scopes (space-separated).</p>"},{"location":"reference/providers/base/#fastauth.providers.base.OAuthProvider-functions","title":"Functions","text":""},{"location":"reference/providers/base/#fastauth.providers.base.OAuthProvider.exchange_code_for_tokens","title":"exchange_code_for_tokens  <code>abstractmethod</code> <code>async</code>","text":"<pre><code>exchange_code_for_tokens(\n    *, code: str, redirect_uri: str, code_verifier: str | None = None\n) -&gt; OAuthTokens\n</code></pre> <p>Exchange authorization code for access/refresh tokens.</p> <p>Parameters:</p> Name Type Description Default <code>code</code> <code>str</code> <p>Authorization code from callback</p> required <code>redirect_uri</code> <code>str</code> <p>Redirect URI used in authorization</p> required <code>code_verifier</code> <code>str | None</code> <p>Optional PKCE code verifier</p> <code>None</code> <p>Returns:</p> Type Description <code>OAuthTokens</code> <p>OAuthTokens with access token and optional refresh token</p> Source code in <code>fastauth/providers/base.py</code> <pre><code>@abstractmethod\nasync def exchange_code_for_tokens(\n    self,\n    *,\n    code: str,\n    redirect_uri: str,\n    code_verifier: str | None = None,\n) -&gt; OAuthTokens:\n    \"\"\"\n    Exchange authorization code for access/refresh tokens.\n\n    Args:\n        code: Authorization code from callback\n        redirect_uri: Redirect URI used in authorization\n        code_verifier: Optional PKCE code verifier\n\n    Returns:\n        OAuthTokens with access token and optional refresh token\n    \"\"\"\n    ...\n</code></pre>"},{"location":"reference/providers/base/#fastauth.providers.base.OAuthProvider.get_user_info","title":"get_user_info  <code>abstractmethod</code> <code>async</code>","text":"<pre><code>get_user_info(*, access_token: str) -&gt; OAuthUserInfo\n</code></pre> <p>Fetch user information using access token.</p> <p>Parameters:</p> Name Type Description Default <code>access_token</code> <code>str</code> <p>OAuth access token</p> required <p>Returns:</p> Type Description <code>OAuthUserInfo</code> <p>OAuthUserInfo with user profile data</p> Source code in <code>fastauth/providers/base.py</code> <pre><code>@abstractmethod\nasync def get_user_info(self, *, access_token: str) -&gt; OAuthUserInfo:\n    \"\"\"\n    Fetch user information using access token.\n\n    Args:\n        access_token: OAuth access token\n\n    Returns:\n        OAuthUserInfo with user profile data\n    \"\"\"\n    ...\n</code></pre>"},{"location":"reference/providers/base/#fastauth.providers.base.OAuthProvider.refresh_access_token","title":"refresh_access_token  <code>abstractmethod</code> <code>async</code>","text":"<pre><code>refresh_access_token(*, refresh_token: str) -&gt; OAuthTokens\n</code></pre> <p>Refresh access token using refresh token.</p> <p>Parameters:</p> Name Type Description Default <code>refresh_token</code> <code>str</code> <p>OAuth refresh token</p> required <p>Returns:</p> Type Description <code>OAuthTokens</code> <p>OAuthTokens with new access token</p> Source code in <code>fastauth/providers/base.py</code> <pre><code>@abstractmethod\nasync def refresh_access_token(self, *, refresh_token: str) -&gt; OAuthTokens:\n    \"\"\"\n    Refresh access token using refresh token.\n\n    Args:\n        refresh_token: OAuth refresh token\n\n    Returns:\n        OAuthTokens with new access token\n    \"\"\"\n    ...\n</code></pre>"},{"location":"reference/providers/google/","title":"Google","text":""},{"location":"reference/providers/google/#fastauth.providers.google","title":"google","text":""},{"location":"reference/providers/google/#fastauth.providers.google-classes","title":"Classes","text":""},{"location":"reference/providers/google/#fastauth.providers.google.GoogleOAuthProvider","title":"GoogleOAuthProvider","text":"<pre><code>GoogleOAuthProvider(*, client_id: str, client_secret: str)\n</code></pre> <p>             Bases: <code>OAuthProvider</code></p> <p>Google OAuth 2.0 provider implementation.</p> <p>Uses Google's OAuth 2.0 endpoints for authorization code flow. Supports PKCE and refresh tokens.</p> <p>Initialize Google OAuth provider.</p> <p>Parameters:</p> Name Type Description Default <code>client_id</code> <code>str</code> <p>Google OAuth client ID</p> required <code>client_secret</code> <code>str</code> <p>Google OAuth client secret</p> required Source code in <code>fastauth/providers/google.py</code> <pre><code>def __init__(self, *, client_id: str, client_secret: str):\n    \"\"\"\n    Initialize Google OAuth provider.\n\n    Args:\n        client_id: Google OAuth client ID\n        client_secret: Google OAuth client secret\n    \"\"\"\n    self.client_id = client_id\n    self.client_secret = client_secret\n</code></pre>"},{"location":"reference/providers/google/#fastauth.providers.google.GoogleOAuthProvider-attributes","title":"Attributes","text":""},{"location":"reference/providers/google/#fastauth.providers.google.GoogleOAuthProvider.name","title":"name  <code>property</code>","text":"<pre><code>name: str\n</code></pre> <p>Provider name.</p>"},{"location":"reference/providers/google/#fastauth.providers.google.GoogleOAuthProvider.authorization_endpoint","title":"authorization_endpoint  <code>property</code>","text":"<pre><code>authorization_endpoint: str\n</code></pre> <p>Google OAuth authorization URL.</p>"},{"location":"reference/providers/google/#fastauth.providers.google.GoogleOAuthProvider.token_endpoint","title":"token_endpoint  <code>property</code>","text":"<pre><code>token_endpoint: str\n</code></pre> <p>Google OAuth token exchange URL.</p>"},{"location":"reference/providers/google/#fastauth.providers.google.GoogleOAuthProvider.user_info_endpoint","title":"user_info_endpoint  <code>property</code>","text":"<pre><code>user_info_endpoint: str\n</code></pre> <p>Google user info API endpoint.</p>"},{"location":"reference/providers/google/#fastauth.providers.google.GoogleOAuthProvider.default_scopes","title":"default_scopes  <code>property</code>","text":"<pre><code>default_scopes: str\n</code></pre> <p>Default OAuth scopes for Google (space-separated).</p>"},{"location":"reference/providers/google/#fastauth.providers.google.GoogleOAuthProvider-functions","title":"Functions","text":""},{"location":"reference/providers/google/#fastauth.providers.google.GoogleOAuthProvider.exchange_code_for_tokens","title":"exchange_code_for_tokens  <code>async</code>","text":"<pre><code>exchange_code_for_tokens(\n    *, code: str, redirect_uri: str, code_verifier: str | None = None\n) -&gt; OAuthTokens\n</code></pre> <p>Exchange authorization code for access/refresh tokens.</p> <p>Parameters:</p> Name Type Description Default <code>code</code> <code>str</code> <p>Authorization code from callback</p> required <code>redirect_uri</code> <code>str</code> <p>Redirect URI used in authorization</p> required <code>code_verifier</code> <code>str | None</code> <p>Optional PKCE code verifier</p> <code>None</code> <p>Returns:</p> Type Description <code>OAuthTokens</code> <p>OAuthTokens with access token and optional refresh token</p> <p>Raises:</p> Type Description <code>HTTPError</code> <p>If token exchange fails</p> Source code in <code>fastauth/providers/google.py</code> <pre><code>async def exchange_code_for_tokens(\n    self,\n    *,\n    code: str,\n    redirect_uri: str,\n    code_verifier: str | None = None,\n) -&gt; OAuthTokens:\n    \"\"\"\n    Exchange authorization code for access/refresh tokens.\n\n    Args:\n        code: Authorization code from callback\n        redirect_uri: Redirect URI used in authorization\n        code_verifier: Optional PKCE code verifier\n\n    Returns:\n        OAuthTokens with access token and optional refresh token\n\n    Raises:\n        httpx.HTTPError: If token exchange fails\n    \"\"\"\n    data = {\n        \"code\": code,\n        \"client_id\": self.client_id,\n        \"client_secret\": self.client_secret,\n        \"redirect_uri\": redirect_uri,\n        \"grant_type\": \"authorization_code\",\n    }\n\n    if code_verifier:\n        data[\"code_verifier\"] = code_verifier\n\n    async with httpx.AsyncClient() as client:\n        response = await client.post(self.token_endpoint, data=data)\n        response.raise_for_status()\n        token_data = response.json()\n\n    return OAuthTokens(\n        access_token=token_data[\"access_token\"],\n        refresh_token=token_data.get(\"refresh_token\"),\n        expires_in=token_data.get(\"expires_in\"),\n        token_type=token_data.get(\"token_type\", \"Bearer\"),\n    )\n</code></pre>"},{"location":"reference/providers/google/#fastauth.providers.google.GoogleOAuthProvider.get_user_info","title":"get_user_info  <code>async</code>","text":"<pre><code>get_user_info(*, access_token: str) -&gt; OAuthUserInfo\n</code></pre> <p>Fetch user information using access token.</p> <p>Parameters:</p> Name Type Description Default <code>access_token</code> <code>str</code> <p>OAuth access token</p> required <p>Returns:</p> Type Description <code>OAuthUserInfo</code> <p>OAuthUserInfo with user profile data</p> <p>Raises:</p> Type Description <code>HTTPError</code> <p>If user info fetch fails</p> Source code in <code>fastauth/providers/google.py</code> <pre><code>async def get_user_info(self, *, access_token: str) -&gt; OAuthUserInfo:\n    \"\"\"\n    Fetch user information using access token.\n\n    Args:\n        access_token: OAuth access token\n\n    Returns:\n        OAuthUserInfo with user profile data\n\n    Raises:\n        httpx.HTTPError: If user info fetch fails\n    \"\"\"\n    headers = {\"Authorization\": f\"Bearer {access_token}\"}\n\n    async with httpx.AsyncClient() as client:\n        response = await client.get(self.user_info_endpoint, headers=headers)\n        response.raise_for_status()\n        user_data = response.json()\n\n    return OAuthUserInfo(\n        provider_user_id=user_data[\"id\"],\n        email=user_data[\"email\"],\n        email_verified=user_data.get(\"verified_email\", False),\n        name=user_data.get(\"name\"),\n        avatar_url=user_data.get(\"picture\"),\n    )\n</code></pre>"},{"location":"reference/providers/google/#fastauth.providers.google.GoogleOAuthProvider.refresh_access_token","title":"refresh_access_token  <code>async</code>","text":"<pre><code>refresh_access_token(*, refresh_token: str) -&gt; OAuthTokens\n</code></pre> <p>Refresh access token using refresh token.</p> <p>Parameters:</p> Name Type Description Default <code>refresh_token</code> <code>str</code> <p>OAuth refresh token</p> required <p>Returns:</p> Type Description <code>OAuthTokens</code> <p>OAuthTokens with new access token</p> <p>Raises:</p> Type Description <code>HTTPError</code> <p>If token refresh fails</p> Source code in <code>fastauth/providers/google.py</code> <pre><code>async def refresh_access_token(self, *, refresh_token: str) -&gt; OAuthTokens:\n    \"\"\"\n    Refresh access token using refresh token.\n\n    Args:\n        refresh_token: OAuth refresh token\n\n    Returns:\n        OAuthTokens with new access token\n\n    Raises:\n        httpx.HTTPError: If token refresh fails\n    \"\"\"\n    data = {\n        \"refresh_token\": refresh_token,\n        \"client_id\": self.client_id,\n        \"client_secret\": self.client_secret,\n        \"grant_type\": \"refresh_token\",\n    }\n\n    async with httpx.AsyncClient() as client:\n        response = await client.post(self.token_endpoint, data=data)\n        response.raise_for_status()\n        token_data = response.json()\n\n    return OAuthTokens(\n        access_token=token_data[\"access_token\"],\n        refresh_token=token_data.get(\"refresh_token\"),\n        expires_in=token_data.get(\"expires_in\"),\n        token_type=token_data.get(\"token_type\", \"Bearer\"),\n    )\n</code></pre>"},{"location":"reference/security/email_verification/","title":"Email Verification","text":""},{"location":"reference/security/email_verification/#fastauth.security.email_verification","title":"email_verification","text":""},{"location":"reference/security/jwt/","title":"Jwt","text":""},{"location":"reference/security/jwt/#fastauth.security.jwt","title":"jwt","text":""},{"location":"reference/security/jwt/#fastauth.security.jwt-classes","title":"Classes","text":""},{"location":"reference/security/jwt/#fastauth.security.jwt.TokenError","title":"TokenError","text":"<p>             Bases: <code>Exception</code></p> <p>Raised when a token is invalid or expired.</p>"},{"location":"reference/security/jwt/#fastauth.security.jwt-functions","title":"Functions","text":""},{"location":"reference/security/jwt/#fastauth.security.jwt.create_access_token","title":"create_access_token","text":"<pre><code>create_access_token(\n    *,\n    subject: str,\n    expires_delta: timedelta | None = None,\n    extra_claims: dict[str, Any] | None = None\n) -&gt; str\n</code></pre> <p>Create a JWT access token.</p> <p>subject: usually user.id</p> Source code in <code>fastauth/security/jwt.py</code> <pre><code>def create_access_token(\n    *,\n    subject: str,\n    expires_delta: timedelta | None = None,\n    extra_claims: dict[str, Any] | None = None,\n) -&gt; str:\n    \"\"\"\n    Create a JWT access token.\n\n    subject: usually user.id\n    \"\"\"\n    expire = datetime.now(UTC) + (\n        expires_delta\n        if expires_delta\n        else timedelta(minutes=settings.access_token_expire_minutes)\n    )\n\n    payload: dict[str, Any] = {\n        \"sub\": subject,\n        \"exp\": expire,\n        \"iat\": datetime.now(UTC),\n    }\n\n    if extra_claims:\n        payload.update(extra_claims)\n\n    encoded_jwt = jwt.encode(\n        payload,\n        settings.jwt_secret_key,\n        algorithm=settings.jwt_algorithm,\n    )\n\n    return encoded_jwt\n</code></pre>"},{"location":"reference/security/jwt/#fastauth.security.jwt.decode_access_token","title":"decode_access_token","text":"<pre><code>decode_access_token(token: str) -&gt; dict[str, Any]\n</code></pre> <p>Decode and validate a JWT access token.</p> Source code in <code>fastauth/security/jwt.py</code> <pre><code>def decode_access_token(token: str) -&gt; dict[str, Any]:\n    \"\"\"\n    Decode and validate a JWT access token.\n    \"\"\"\n    try:\n        payload = jwt.decode(\n            token,\n            settings.jwt_secret_key,\n            algorithms=[settings.jwt_algorithm],\n        )\n        return payload\n    except JWTError as exc:\n        raise TokenError(\"Invalid or expired token\") from exc\n</code></pre>"},{"location":"reference/security/limits/","title":"Limits","text":""},{"location":"reference/security/limits/#fastauth.security.limits","title":"limits","text":""},{"location":"reference/security/limits/#fastauth.security.limits-classes","title":"Classes","text":""},{"location":"reference/security/oauth/","title":"Oauth","text":""},{"location":"reference/security/oauth/#fastauth.security.oauth","title":"oauth","text":""},{"location":"reference/security/oauth/#fastauth.security.oauth-functions","title":"Functions","text":""},{"location":"reference/security/oauth/#fastauth.security.oauth.generate_state_token","title":"generate_state_token","text":"<pre><code>generate_state_token() -&gt; str\n</code></pre> <p>Generate a cryptographically secure state token for CSRF protection.</p> <p>Uses same pattern as refresh tokens.</p> <p>Returns:</p> Type Description <code>str</code> <p>URL-safe random token string</p> Source code in <code>fastauth/security/oauth.py</code> <pre><code>def generate_state_token() -&gt; str:\n    \"\"\"\n    Generate a cryptographically secure state token for CSRF protection.\n\n    Uses same pattern as refresh tokens.\n\n    Returns:\n        URL-safe random token string\n    \"\"\"\n    return secrets.token_urlsafe(48)\n</code></pre>"},{"location":"reference/security/oauth/#fastauth.security.oauth.hash_state_token","title":"hash_state_token","text":"<pre><code>hash_state_token(token: str) -&gt; str\n</code></pre> <p>Hash state token before storing.</p> <p>Uses SHA-256 hashing like other tokens.</p> <p>Parameters:</p> Name Type Description Default <code>token</code> <code>str</code> <p>Raw state token</p> required <p>Returns:</p> Type Description <code>str</code> <p>Hexadecimal hash of the token</p> Source code in <code>fastauth/security/oauth.py</code> <pre><code>def hash_state_token(token: str) -&gt; str:\n    \"\"\"\n    Hash state token before storing.\n\n    Uses SHA-256 hashing like other tokens.\n\n    Args:\n        token: Raw state token\n\n    Returns:\n        Hexadecimal hash of the token\n    \"\"\"\n    return hashlib.sha256(token.encode()).hexdigest()\n</code></pre>"},{"location":"reference/security/oauth/#fastauth.security.oauth.hash_oauth_token","title":"hash_oauth_token","text":"<pre><code>hash_oauth_token(token: str) -&gt; str\n</code></pre> <p>Hash OAuth provider tokens before storing.</p> <p>We store provider access/refresh tokens hashed for security.</p> <p>Parameters:</p> Name Type Description Default <code>token</code> <code>str</code> <p>Raw OAuth token from provider</p> required <p>Returns:</p> Type Description <code>str</code> <p>Hexadecimal hash of the token</p> Source code in <code>fastauth/security/oauth.py</code> <pre><code>def hash_oauth_token(token: str) -&gt; str:\n    \"\"\"\n    Hash OAuth provider tokens before storing.\n\n    We store provider access/refresh tokens hashed for security.\n\n    Args:\n        token: Raw OAuth token from provider\n\n    Returns:\n        Hexadecimal hash of the token\n    \"\"\"\n    return hashlib.sha256(token.encode()).hexdigest()\n</code></pre>"},{"location":"reference/security/oauth/#fastauth.security.oauth.generate_code_verifier","title":"generate_code_verifier","text":"<pre><code>generate_code_verifier() -&gt; str\n</code></pre> <p>Generate a cryptographically random code verifier for PKCE.</p> <p>Per RFC 7636, the code verifier should be 43-128 characters. We use 64 bytes for good entropy (~86 characters base64url encoded).</p> <p>Returns:</p> Type Description <code>str</code> <p>URL-safe random string for PKCE code verifier</p> Source code in <code>fastauth/security/oauth.py</code> <pre><code>def generate_code_verifier() -&gt; str:\n    \"\"\"\n    Generate a cryptographically random code verifier for PKCE.\n\n    Per RFC 7636, the code verifier should be 43-128 characters.\n    We use 64 bytes for good entropy (~86 characters base64url encoded).\n\n    Returns:\n        URL-safe random string for PKCE code verifier\n    \"\"\"\n    return secrets.token_urlsafe(64)\n</code></pre>"},{"location":"reference/security/oauth/#fastauth.security.oauth.generate_code_challenge","title":"generate_code_challenge","text":"<pre><code>generate_code_challenge(verifier: str) -&gt; str\n</code></pre> <p>Generate S256 code challenge from verifier.</p> <p>Challenge = BASE64URL(SHA256(verifier))</p> <p>Parameters:</p> Name Type Description Default <code>verifier</code> <code>str</code> <p>Code verifier string</p> required <p>Returns:</p> Type Description <code>str</code> <p>Base64url-encoded SHA-256 hash of the verifier (without padding)</p> Source code in <code>fastauth/security/oauth.py</code> <pre><code>def generate_code_challenge(verifier: str) -&gt; str:\n    \"\"\"\n    Generate S256 code challenge from verifier.\n\n    Challenge = BASE64URL(SHA256(verifier))\n\n    Args:\n        verifier: Code verifier string\n\n    Returns:\n        Base64url-encoded SHA-256 hash of the verifier (without padding)\n    \"\"\"\n    digest = hashlib.sha256(verifier.encode()).digest()\n    challenge = base64.urlsafe_b64encode(digest).decode().rstrip(\"=\")\n    return challenge\n</code></pre>"},{"location":"reference/security/oauth/#fastauth.security.oauth.build_authorization_url","title":"build_authorization_url","text":"<pre><code>build_authorization_url(\n    *,\n    auth_endpoint: str,\n    client_id: str,\n    redirect_uri: str,\n    state: str,\n    scope: str,\n    code_challenge: str | None = None\n) -&gt; str\n</code></pre> <p>Build OAuth authorization URL with PKCE support.</p> <p>Parameters:</p> Name Type Description Default <code>auth_endpoint</code> <code>str</code> <p>Provider's authorization endpoint URL</p> required <code>client_id</code> <code>str</code> <p>OAuth client ID</p> required <code>redirect_uri</code> <code>str</code> <p>Callback URL after authorization</p> required <code>state</code> <code>str</code> <p>State token for CSRF protection</p> required <code>scope</code> <code>str</code> <p>Space-separated list of OAuth scopes</p> required <code>code_challenge</code> <code>str | None</code> <p>Optional PKCE code challenge</p> <code>None</code> <p>Returns:</p> Type Description <code>str</code> <p>Complete authorization URL with query parameters</p> Source code in <code>fastauth/security/oauth.py</code> <pre><code>def build_authorization_url(\n    *,\n    auth_endpoint: str,\n    client_id: str,\n    redirect_uri: str,\n    state: str,\n    scope: str,\n    code_challenge: str | None = None,\n) -&gt; str:\n    \"\"\"\n    Build OAuth authorization URL with PKCE support.\n\n    Args:\n        auth_endpoint: Provider's authorization endpoint URL\n        client_id: OAuth client ID\n        redirect_uri: Callback URL after authorization\n        state: State token for CSRF protection\n        scope: Space-separated list of OAuth scopes\n        code_challenge: Optional PKCE code challenge\n\n    Returns:\n        Complete authorization URL with query parameters\n    \"\"\"\n    params = {\n        \"client_id\": client_id,\n        \"redirect_uri\": redirect_uri,\n        \"response_type\": \"code\",\n        \"scope\": scope,\n        \"state\": state,\n        \"access_type\": \"offline\",  # Request refresh token\n    }\n\n    if code_challenge:\n        params[\"code_challenge\"] = code_challenge\n        params[\"code_challenge_method\"] = \"S256\"\n\n    return f\"{auth_endpoint}?{urlencode(params)}\"\n</code></pre>"},{"location":"reference/security/password_reset/","title":"Password Reset","text":""},{"location":"reference/security/password_reset/#fastauth.security.password_reset","title":"password_reset","text":""},{"location":"reference/security/rate_limit/","title":"Rate Limit","text":""},{"location":"reference/security/rate_limit/#fastauth.security.rate_limit","title":"rate_limit","text":""},{"location":"reference/security/rate_limit/#fastauth.security.rate_limit-classes","title":"Classes","text":""},{"location":"reference/security/rate_limit/#fastauth.security.rate_limit.RateLimiter","title":"RateLimiter","text":"<pre><code>RateLimiter(*, max_attempts: int, window_seconds: int)\n</code></pre> Source code in <code>fastauth/security/rate_limit.py</code> <pre><code>def __init__(\n    self,\n    *,\n    max_attempts: int,\n    window_seconds: int,\n):\n    self.max_attempts = max_attempts\n    self.window_seconds = window_seconds\n    self._store: dict[str, deque[float]] = defaultdict(deque)\n</code></pre>"},{"location":"reference/security/rate_limit/#fastauth.security.rate_limit.RateLimiter-functions","title":"Functions","text":""},{"location":"reference/security/rate_limit/#fastauth.security.rate_limit.RateLimiter.hit","title":"hit","text":"<pre><code>hit(key: str) -&gt; None\n</code></pre> <p>Register an attempt for a given key. Raises RateLimitExceeded if limit is exceeded.</p> Source code in <code>fastauth/security/rate_limit.py</code> <pre><code>def hit(self, key: str) -&gt; None:\n    \"\"\"\n    Register an attempt for a given key.\n    Raises RateLimitExceeded if limit is exceeded.\n    \"\"\"\n    now = time.time()\n    window_start = now - self.window_seconds\n\n    attempts = self._store[key]\n\n    while attempts and attempts[0] &lt; window_start:\n        attempts.popleft()\n\n    if len(attempts) &gt;= self.max_attempts:\n        raise RateLimitExceeded(\"Too many attempts\")\n\n    attempts.append(now)\n</code></pre>"},{"location":"reference/security/rate_limit/#fastauth.security.rate_limit.RateLimiter.reset","title":"reset","text":"<pre><code>reset(key: str) -&gt; None\n</code></pre> <p>Clear attempts after successful auth.</p> Source code in <code>fastauth/security/rate_limit.py</code> <pre><code>def reset(self, key: str) -&gt; None:\n    \"\"\"\n    Clear attempts after successful auth.\n    \"\"\"\n    self._store.pop(key, None)\n</code></pre>"},{"location":"reference/security/refresh/","title":"Refresh","text":""},{"location":"reference/security/refresh/#fastauth.security.refresh","title":"refresh","text":""},{"location":"reference/security/refresh/#fastauth.security.refresh-functions","title":"Functions","text":""},{"location":"reference/security/refresh/#fastauth.security.refresh.generate_refresh_token","title":"generate_refresh_token","text":"<pre><code>generate_refresh_token() -&gt; str\n</code></pre> <p>Generate a cryptographically secure refresh token.</p> Source code in <code>fastauth/security/refresh.py</code> <pre><code>def generate_refresh_token() -&gt; str:\n    \"\"\"\n    Generate a cryptographically secure refresh token.\n    \"\"\"\n    return secrets.token_urlsafe(48)\n</code></pre>"},{"location":"reference/security/refresh/#fastauth.security.refresh.hash_refresh_token","title":"hash_refresh_token","text":"<pre><code>hash_refresh_token(token: str) -&gt; str\n</code></pre> <p>Hash refresh token before storing.</p> Source code in <code>fastauth/security/refresh.py</code> <pre><code>def hash_refresh_token(token: str) -&gt; str:\n    \"\"\"\n    Hash refresh token before storing.\n    \"\"\"\n    return hashlib.sha256(token.encode()).hexdigest()\n</code></pre>"}]}